import{r as i,j as e}from"./shadcn-BW0HktFr.js";import{u as A,d as T,e as F,t as b,k as M,n as S,L as D,B as g,o as K}from"./index-BWn9U0qn.js";import{C as q,a as E}from"./card-DCPMsoQV.js";import{F as f,S as Q}from"./SelectField-CME5RjN4.js";import{D as H,b as P,c as V,d as $,f as I}from"./dialog-DSMzxNGf.js";import{T as U,a as z,b as y,c as w,d as O,e as N}from"./table-DPxS8hfM.js";import{F as W}from"./FieldWrapper-EgKMkGRF.js";import"./react-RGnvvjkK.js";import"./lucide-D2dOsrR-.js";import"./index-CVVkWozz.js";import"./index-CJjGIk76.js";function G(s){const o=A(),d=["admin-brukere",s],n=T(d,`/klubb/${s}/bruker/admin/bruker`,{enabled:!!s,requireAuth:!0,staleTime:3e4}),t=F("put",({brukerId:a})=>`/klubb/${s}/bruker/admin/bruker/${a}`,{onSuccess:async()=>{b.success("Bruker oppdatert"),await o.invalidateQueries({queryKey:d})},onError:a=>b.error(a.message??"Kunne ikke oppdatere bruker"),retry:!1}),p=async(a,l)=>{s&&await t.mutateAsync({brukerId:a,rolle:l.rolle,visningsnavn:l.visningsnavn})};return{brukere:n.data??[],laster:n.isLoading,oppdaterLaster:t.isPending,oppdater:p,hentBrukere:n.refetch,error:n.error?.message??null}}function le(){const{slug:s}=M(),{bruker:o,laster:d}=S(s),{brukere:n,laster:t,oppdater:p,oppdaterLaster:a}=G(s),[l,C]=i.useState(""),[u,c]=i.useState(null),[h,v]=i.useState("Medlem"),[k,j]=i.useState(""),B=o?.roller.includes("KlubbAdmin"),x=i.useMemo(()=>{const r=l.toLowerCase().trim();return n.filter(m=>m.epost?.toLowerCase().includes(r)||m.visningsnavn?.toLowerCase().includes(r))},[n,l]),L=r=>{c(r),v(r.roller[0]??"Medlem"),j(r.visningsnavn??"")},R=async()=>{!s||!u||(await p(u.id,{rolle:h,visningsnavn:k}),c(null))};return d?e.jsx(D,{}):B?e.jsxs("div",{className:"max-w-screen-sm mx-auto px-2 py-2 space-y-4",children:[e.jsx(q,{children:e.jsxs(E,{className:"p-4 space-y-4",children:[e.jsx(f,{id:"sok",label:"SÃ¸k etter bruker",value:l,onChange:r=>C(r.target.value),helpText:"F.eks. navn eller e-post"}),t&&e.jsx("p",{children:"Laster brukere..."}),!t&&x.length===0&&e.jsx("p",{className:"text-muted-foreground",children:"Ingen brukere funnet"}),!t&&x.length>0&&e.jsx("div",{className:"max-w-full overflow-x-auto border rounded-md",children:e.jsxs(U,{className:"text-sm w-full",children:[e.jsx(z,{children:e.jsxs(y,{children:[e.jsx(w,{className:"w-[140px]",children:"Bruker"}),e.jsx(w,{className:"w-2/6",children:"Rolle"})]})}),e.jsx(O,{children:x.map(r=>{const m=r.id===o?.id;return e.jsxs(y,{children:[e.jsx(N,{className:"whitespace-nowrap max-w-[180px]",children:e.jsxs("div",{className:"flex justify-between items-start gap-2 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx("div",{className:"font-medium truncate",title:r.epost,children:r.epost}),r.visningsnavn&&e.jsx("div",{className:"text-muted-foreground text-xs truncate",title:r.visningsnavn,children:r.visningsnavn})]}),!m&&e.jsxs(g,{variant:"ghost",size:"icon",onClick:()=>L(r),title:"Rediger",className:"text-muted-foreground hover:text-primary",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Rediger"})]})]})}),e.jsx(N,{className:"whitespace-nowrap",children:r.roller[0]??"Medlem"})]},r.id)})})]})})]})}),u&&e.jsx(H,{open:!0,onOpenChange:r=>{r||c(null)},children:e.jsxs(P,{children:[e.jsx(V,{children:e.jsx($,{children:"Rediger bruker"})}),e.jsx(W,{id:"epost",label:"Brukernavn / ID",children:e.jsx("p",{className:"text-sm text-foreground",children:u.epost})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(f,{id:"visningsnavn",label:"Visningsnavn",value:k,onChange:r=>j(r.target.value)}),e.jsx(Q,{id:"rolle",label:"Rolle",value:h,onChange:r=>v(r),options:[{label:"Medlem",value:"Medlem"},{label:"Utvidet",value:"Utvidet"},{label:"KlubbAdmin",value:"KlubbAdmin"}]})]}),e.jsxs(I,{children:[e.jsx(g,{variant:"ghost",onClick:()=>c(null),disabled:a,children:"Avbryt"}),e.jsx(g,{onClick:R,disabled:a,children:a?"Lagrer...":"Lagre"})]})]})})]}):e.jsx("p",{className:"text-sm text-destructive px-2 py-2 text-center",children:"Du har ikke tilgang til denne siden."})}export{le as default};
