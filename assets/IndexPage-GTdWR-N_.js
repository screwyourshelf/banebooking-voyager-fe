import{j as t,r as u}from"./shadcn-BfUXmlP3.js";import{T as B,a as w,b as N,u as S}from"./useBaner-BRpSQ6Fy.js";import{C as T,f as C,D as E}from"./checkbox-CuQzlf-o.js";import{F as $,B as j,a as L,b as A,c as D,L as y,t as b,u as F,S as P}from"./index-CZ7yxNIj.js";import{h as I,a as z,o as _}from"./booking-BzyimBsT.js";import"./react-D5d5vywP.js";import"./lucide-CZTSiasK.js";import"./index-36j8ZHWB.js";function K({baner:e,valgtBaneId:n,onVelgBane:s}){return t.jsx(B,{value:n,onValueChange:s,children:t.jsx(w,{className:"flex flex-wrap gap-2 mb-2",children:e.map(r=>t.jsx(N,{value:r.id,children:r.navn},r.id))})})}function M(){const[e,n]=u.useState(!1);return{erBekreftet:e,setErBekreftet:n,reset:()=>n(!1)}}function V({slot:e,isOpen:n,erInteraktiv:s,currentUser:r}){const a=`${e.startTid.slice(0,2)}-${e.sluttTid.slice(0,2)}`,d=!!e.arrangementTittel,[i,m]=u.useState(!1);u.useEffect(()=>{const g=()=>m(window.innerWidth<640);return g(),window.addEventListener("resize",g),()=>window.removeEventListener("resize",g)},[]);const o=40,c=e.arrangementBeskrivelse&&i&&e.arrangementBeskrivelse.length>o?e.arrangementBeskrivelse.slice(0,o)+"...":e.arrangementBeskrivelse;return t.jsx("div",{className:"flex items-center",children:t.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[t.jsx("div",{className:"whitespace-nowrap font-semibold text-sm text-right pr-1",children:a}),t.jsx("div",{className:"w-[18px] h-[18px] flex items-center justify-center",children:e.værSymbol?t.jsx("img",{src:`/banebooking-voyager-fe/weather-symbols/svg/${e.værSymbol}.svg`,alt:e.værSymbol,width:18,height:18,className:"select-none",draggable:!1}):t.jsx("span",{className:"invisible"})}),t.jsx("div",{className:"flex-grow text-sm p-1",children:d?t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.arrangementTittel}),c&&t.jsx("div",{className:"text-xs text-gray-600",children:c})]}):t.jsx("div",{children:e.booketAv?r?e.booketAv:H(e.booketAv):"Ledig"})}),s&&t.jsx("div",{className:"p-1",children:t.jsx($,{size:12,style:{transform:n?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},"aria-hidden":"true"})})]})})}function H(e){const[n,s]=e.split("@");return!n||!s?e:`${n[0]}***@${s}`}function J({slot:e,onBook:n=()=>{},onCancel:s=()=>{},onDelete:r=()=>{},time:a,erBekreftet:d,setErBekreftet:i,reset:m=()=>{}}){return t.jsxs("div",{className:"flex flex-col items-end w-full",children:[e.kanBookes&&d!==void 0&&i&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center space-x-1 mb-2 text-sm",children:[t.jsx(T,{id:`book-${a}`,checked:d,onCheckedChange:o=>i(!!o)}),t.jsxs("label",{htmlFor:`book-${a}`,className:"cursor-pointer select-none",children:["Jeg (og de jeg spiller sammen med) har betalt medlemskap for ",new Date().getFullYear()]})]}),t.jsxs(j,{variant:"outline",size:"sm",disabled:!d,onClick:()=>{n(e),m()},className:"flex items-center gap-2 text-sm",children:[t.jsx(L,{}),"Book"]})]}),e.kanAvbestille&&t.jsxs(j,{variant:"outline",size:"sm",onClick:()=>{s(e),m()},className:"flex items-center gap-2 text-sm",children:[t.jsx(A,{}),"Avbestill"]}),e.kanSlette&&t.jsxs(j,{variant:"destructive",size:"sm",onClick:()=>{r(e),m()},className:"flex items-center gap-2 text-sm",children:[t.jsx(D,{}),"Slett"]})]})}function O({slot:e,time:n,erBekreftet:s,setErBekreftet:r,onBook:a,onCancel:d,onDelete:i,reset:m}){return t.jsx("div",{className:"mt-1",children:t.jsx("div",{className:"bg-inherit",children:t.jsx(J,{slot:e,time:n,erBekreftet:s,setErBekreftet:r,onBook:a,onCancel:d,onDelete:i,reset:m})})})}function R({slot:e,currentUser:n,isOpen:s=!1,onToggle:r,onBook:a=()=>{},onCancel:d=()=>{},onDelete:i=()=>{}}){const{erBekreftet:m,setErBekreftet:o,reset:c}=M(),g=`${e.startTid.slice(0,2)}-${e.sluttTid.slice(0,2)}`,f=e.kanBookes||e.kanAvbestille||e.kanSlette,l=!!n&&f&&!e.erPassert,x=!!e.arrangementTittel,v=e.erEier===!0,h=["border rounded shadow-sm p-2 mb-2","transition-colors duration-300 ease-in-out",e.erPassert?"bg-gray-100 text-gray-400":"",!e.erPassert&&x?"bg-gradient-to-r from-blue-0 via-blue-50 to-blue-200 border-blue-200":"",!e.erPassert&&!x?"bg-white text-gray-900":"",v&&!x?"animate__animated animate__headShake animate__slow":""].join(" "),p=()=>{l&&r&&(r(),o(!1))};return t.jsxs("div",{className:h,style:{cursor:l?"pointer":"default",opacity:e.erPassert?.5:1},onClick:k=>{k.target.closest("button, input, label")||p()},role:l?"button":void 0,tabIndex:l?0:void 0,onKeyDown:k=>{(k.key==="Enter"||k.key===" ")&&(k.preventDefault(),p())},children:[t.jsx(V,{slot:e,isOpen:s,erInteraktiv:l,currentUser:n}),s&&!e.erPassert&&t.jsx(O,{slot:e,time:g,erBekreftet:m,setErBekreftet:o,onBook:a,onCancel:d,onDelete:i,reset:c})]})}function U({slots:e,currentUser:n,onBook:s,onCancel:r,onDelete:a,apenSlotTid:d,setApenSlotTid:i,isLoading:m=!1}){return m?t.jsx(y,{}):e.length===0?t.jsx("div",{className:"text-muted text-sm italic py-4 text-center",children:"Ingen bookinger eller slots � vise."}):t.jsx("div",{className:"space-y-2",children:e.map(o=>{const c=`${o.dato}-${o.startTid}-${o.baneId}`;return t.jsx(R,{slot:o,currentUser:n,onBook:s,onCancel:r,onDelete:a,isOpen:d===c,onToggle:()=>i==null?void 0:i(d===c?null:c)},c)})})}function W(e,n,s){const[r,a]=u.useState([]),[d,i]=u.useState(null),[m,o]=u.useState(!0),c=u.useCallback(async()=>{if(!(!e||!s)){o(!0);try{const l=await I(e,s,n);a(l)}catch{a([]),b.error("Kunne ikke hente bookinger.")}finally{o(!1)}}},[e,n,s]);return u.useEffect(()=>{c()},[c]),{slots:r,apenSlotTid:d,setApenSlotTid:i,onBook:async l=>{if(!(!e||!s))try{await _(e,s,n,l.startTid,l.sluttTid);const x=`${l.startTid.slice(0,2)}-${l.sluttTid.slice(0,2)}`;b.success(`Booket ${x}`),await c()}catch(x){b.error(x instanceof Error?x.message:"Kunne ikke booke slot.")}},onCancel:async l=>{if(!(!e||!s))try{await z(e,s,n,l.startTid,l.sluttTid),b.info("Bookingen er avbestilt."),await c()}catch(x){b.error(x instanceof Error?x.message:"Kunne ikke avbestille slot.")}},hentBookinger:c,isLoading:m}}function ne(){const{baner:e,isLoading:n}=S(),[s,r]=u.useState(""),[a,d]=u.useState(new Date),{currentUser:i}=F(),m=u.useContext(P),o=a?C(a,"yyyy-MM-dd"):"",{slots:c,apenSlotTid:g,setApenSlotTid:f,onBook:l,onCancel:x,isLoading:v}=W(m,o,s);return u.useEffect(()=>{!s&&e.length>0&&r(e[0].id)},[e,s]),u.useEffect(()=>{f(null)},[a,s,f]),u.useEffect(()=>{i||f(null)},[i,f]),u.useEffect(()=>{a&&localStorage.setItem("valgtDato",a.toISOString())},[a]),n||!s?t.jsx(y,{}):t.jsxs("div",{className:"max-w-screen-sm mx-auto px-1 py-1",children:[t.jsx("div",{className:"mb-2",children:t.jsx(E,{value:a,onChange:h=>d(h??null),visNavigering:!0})}),t.jsx("div",{className:"mb-0",children:t.jsx(K,{baner:e,valgtBaneId:s,onVelgBane:r})}),t.jsx(U,{slots:c,currentUser:i?{epost:i.email??""}:null,apenSlotTid:g,setApenSlotTid:f,onBook:l,onCancel:x,onDelete:h=>console.log("Slett",h),isLoading:v})]})}export{ne as default};
