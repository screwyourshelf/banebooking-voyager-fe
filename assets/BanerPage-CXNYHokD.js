import{r as c,j as a}from"./shadcn-V64FgQuT.js";import{u as L}from"./useBaner-BfEnVHyB.js";import{B as u,t as r}from"./index-BUl1sceL.js";import{C as b,a as h}from"./card-DJrtFHge.js";import{T as z,a as R,b as j,c as y}from"./tabs-CZTDlSF2.js";import{F as d}from"./FormField-pJlN5988.js";import{S as O}from"./SelectField-PU4N1MeW.js";import"./react-D5d5vywP.js";import"./lucide-VYBZz5NY.js";import"./FieldWrapper-CnVp9v9G.js";import"./index-uoXEFuNP.js";const B="rediger.valgtBaneId";function U(){const{baner:i,isLoading:C,oppdaterBane:N,opprettBane:E,deaktiverBane:S,aktiverBane:T}=L(!0),[f,p]=c.useState({}),[v,g]=c.useState({navn:"",beskrivelse:""}),[s,m]=c.useState(()=>{const e=sessionStorage.getItem(B);return e&&e!=="null"?e:null}),n=i.find(e=>e.id===s)??null,t=s?f[s]??null:null;c.useEffect(()=>{sessionStorage.setItem(B,s??"null")},[s]),c.useEffect(()=>{s&&!i.some(e=>e.id===s)&&m(null)},[i,s]),c.useEffect(()=>{!s&&i.length>0&&m(i[0].id)},[i,s]);function x(e,l,k){p(o=>({...o,[e]:{...o[e]??i.find(K=>K.id===e),[l]:k}}))}async function w(e){const l=f[e];if(l)try{await N(e,l),r.success("Endringer lagret"),p(k=>{const o={...k};return delete o[e],o})}catch{r.error("Kunne ikke lagre bane")}}async function F(){if(!v.navn.trim()){r.error("Navn er pÃ¥krevd");return}try{await E(v),r.success("Bane lagt til"),g({navn:"",beskrivelse:""})}catch{r.error("Kunne ikke legge til bane")}}async function D(e){try{await S(e),r.success("Bane deaktivert")}catch{r.error("Kunne ikke deaktivere bane")}}async function I(e){try{await T(e),r.success("Bane aktivert")}catch{r.error("Kunne ikke aktivere bane")}}return a.jsx("div",{className:"max-w-screen-sm mx-auto px-2 py-2",children:a.jsxs(z,{defaultValue:"rediger",className:"space-y-4",children:[a.jsxs(R,{className:"mb-2",children:[a.jsx(j,{value:"rediger",children:"Rediger bane"}),a.jsx(j,{value:"ny",children:"Ny bane"})]}),a.jsx(y,{value:"rediger",children:C?a.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Laster..."}):a.jsx(b,{children:a.jsxs(h,{className:"p-4 space-y-4",children:[a.jsx(O,{id:"velg-bane",label:"Velg bane",value:s??"",onChange:e=>m(e||null),options:i.map(e=>({label:`${e.navn} ${e.aktiv?"":"(inaktiv)"}`,value:e.id}))}),n&&a.jsxs(a.Fragment,{children:[a.jsx(d,{id:"navn",label:"Navn",value:(t==null?void 0:t.navn)??n.navn,onChange:e=>x(n.id,"navn",e.target.value),readOnly:!n.aktiv}),a.jsx(d,{id:"beskrivelse",label:"Beskrivelse",value:(t==null?void 0:t.beskrivelse)??n.beskrivelse,onChange:e=>x(n.id,"beskrivelse",e.target.value),readOnly:!n.aktiv}),a.jsx("div",{className:"flex justify-between",children:n.aktiv?a.jsxs(a.Fragment,{children:[a.jsx(u,{size:"sm",onClick:e=>{e.preventDefault(),w(n.id)},disabled:!t||t.navn===n.navn&&t.beskrivelse===n.beskrivelse,children:"Lagre"}),a.jsx(u,{variant:"destructive",size:"sm",onClick:e=>{e.preventDefault(),D(n.id)},children:"Deaktiver"})]}):a.jsx(u,{variant:"outline",size:"sm",onClick:e=>{e.preventDefault(),I(n.id)},children:"Aktiver"})})]})]})})}),a.jsx(y,{value:"ny",children:a.jsx(b,{children:a.jsxs(h,{className:"p-4 space-y-3",children:[a.jsx(d,{id:"ny-navn",label:"Navn",value:v.navn,onChange:e=>g(l=>({...l,navn:e.target.value}))}),a.jsx(d,{id:"ny-beskrivelse",label:"Beskrivelse",value:v.beskrivelse,onChange:e=>g(l=>({...l,beskrivelse:e.target.value}))}),a.jsx(u,{size:"sm",onClick:e=>{e.preventDefault(),F()},children:"Legg til"})]})})})]})})}export{U as default};
