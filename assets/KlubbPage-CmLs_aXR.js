import{j as e,r as u}from"./shadcn-BWI-zYLE.js";import{P as V}from"./Page-DY0prbA9.js";import{T as H}from"./Tabs-Cjp-IngN.js";import{F as P,i as m,I as x,j as F,l as R,m as C,d as K,L as w}from"./index-BatLQ3bG.js";import{P as y,a as E,b as M,R as c}from"./Row-C7JbVcvj.js";import{S as $,a as G,b as W,c as X,d as S}from"./select-DhYZMZCe.js";import"./react-RGnvvjkK.js";import"./tabs-BdADKua0.js";import"./lucide-CrbeDRip.js";import"./index-BsNugM_4.js";function _({form:t,onChange:r,canSubmit:l,isSaving:n,onSubmit:o,touched:g,errors:d,onBlurField:p}){const k=g.navn?d.navn:null,a=g.kontaktEpost?d.kontaktEpost:null;return e.jsxs(P,{onSubmit:i=>{i.preventDefault(),o()},children:[e.jsx(y,{title:"Grunninfo",description:"Informasjon som vises utad i Banebooking.",children:e.jsx(E,{children:e.jsxs(M,{children:[e.jsx(c,{title:"Klubbnavn",description:"Navnet på klubben slik det vises utad i Banebooking.",children:e.jsxs(m,{"data-invalid":!!k,children:[e.jsx(x,{id:"klubbnavn",value:t.navn,onChange:i=>r("navn",i.target.value),placeholder:"Ås tennisklubb",autoComplete:"organization",maxLength:60,onBlur:()=>p("navn"),"aria-invalid":!!k}),k?e.jsx(F,{children:k}):null]})}),e.jsx(c,{title:"Kontakt-e-post",description:"Vises på klubbens infoside. Brukes til henvendelser fra medlemmer og gjester.",children:e.jsxs(m,{"data-invalid":!!a,children:[e.jsx(x,{id:"kontaktEpost",value:t.kontaktEpost,onChange:i=>r("kontaktEpost",i.target.value),placeholder:"post@klubb.no",type:"email",inputMode:"email",autoComplete:"email",onBlur:()=>p("kontaktEpost"),"aria-invalid":!!a}),a?e.jsx(F,{children:a}):null]})})]})})}),e.jsx(y,{title:"Kart",description:"Valgfrie innstillinger for innhenting av værinformasjon.",children:e.jsx(E,{children:e.jsxs(M,{children:[e.jsx(c,{title:"Latitude (breddegrad)",children:e.jsx(m,{children:e.jsx(x,{id:"latitude",value:t.latitude,onChange:i=>r("latitude",i.target.value),placeholder:"f.eks. 59.6552",inputMode:"decimal"})})}),e.jsx(c,{title:"Longitude (lengdegrad)",children:e.jsx(m,{children:e.jsx(x,{id:"longitude",value:t.longitude,onChange:i=>r("longitude",i.target.value),placeholder:"f.eks. 10.7769",inputMode:"decimal"})})})]})})}),e.jsx(y,{title:"Feed",description:"Valgfrie innstillinger for innhenting av nyheter fra klubbens RSS-feed.",children:e.jsx(E,{children:e.jsxs(M,{children:[e.jsx(c,{title:"RSS-feed",description:"URL til klubbens RSS-feed. Hvis satt, hentes og vises de nyeste innleggene i appen.",children:e.jsx(m,{children:e.jsx(x,{id:"feedUrl",value:t.feedUrl,onChange:i=>r("feedUrl",i.target.value),placeholder:"https://www.aastk.no/?feed=rss2",inputMode:"url",type:"url"})})}),e.jsx(c,{title:"Aldergrense for feedinnslag (dager)",description:"Hvor mange dager gamle innslag som vises. Sett til 0 for å inkludere alle.",children:e.jsx(m,{children:e.jsx(x,{id:"feedSynligAntallDager",value:t.feedSynligAntallDager,onChange:i=>r("feedSynligAntallDager",i.target.value),type:"number",inputMode:"numeric",min:0,step:1})})})]})})}),e.jsx(R,{variant:"sticky",align:"left",spaced:!1,className:"w-full",children:e.jsx(C,{isLoading:n,disabled:!l,loadingText:"Lagrer...",fullWidth:!0,children:"Lagre endringer"})})]})}const I=60,z=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;function O(t){const r=t.trim();return r?r.length<2?"Klubbnavn må være minst 2 tegn.":r.length>I?`Klubbnavn kan ikke være lengre enn ${I} tegn.`:null:"Klubbnavn kan ikke være tomt."}function q(t){const r=t.trim();return r?z.test(r)?null:"Skriv inn en gyldig e-postadresse.":"Kontakt-e-post kan ikke være tom."}function L(t){const r=t.trim();if(!r)return;const l=Number(r.replace(",","."));return Number.isFinite(l)?l:void 0}function J(){const{data:t,isLoading:r,oppdaterKlubb:l}=K(),[n,o]=u.useState({navn:"",kontaktEpost:"",banereglement:"",latitude:"",longitude:"",feedUrl:"",feedSynligAntallDager:""}),[g,d]=u.useState({navn:!1,kontaktEpost:!1});u.useEffect(()=>{t&&(o({navn:t.navn??"",kontaktEpost:t.kontaktEpost??"",banereglement:t.banereglement??"",latitude:t.latitude?.toString()??"",longitude:t.longitude?.toString()??"",feedUrl:t.feedUrl??"",feedSynligAntallDager:(t.feedSynligAntallDager??50).toString()}),d({navn:!1,kontaktEpost:!1}))},[t]);const p=u.useMemo(()=>({navn:O(n.navn),kontaktEpost:q(n.kontaktEpost)}),[n.navn,n.kontaktEpost]),k=u.useMemo(()=>t?(n.navn??"")!==(t.navn??"")||(n.kontaktEpost??"")!==(t.kontaktEpost??"")||(n.banereglement??"")!==(t.banereglement??"")||(n.latitude??"")!==(t.latitude?.toString()??"")||(n.longitude??"")!==(t.longitude?.toString()??"")||(n.feedUrl??"")!==(t.feedUrl??"")||(n.feedSynligAntallDager??"")!==(t.feedSynligAntallDager??50).toString():!1,[t,n]),a=u.useMemo(()=>!p.navn&&!p.kontaktEpost,[p]),i=k&&a;if(r||!t)return e.jsx(w,{});const b=(h,f)=>{o(v=>({...v,[h]:f}))};function s(h){d(f=>f[h]?f:{...f,[h]:!0})}function U(h){d(f=>{let v=!1;const T={...f};for(const D of h)T[D]||(T[D]=!0,v=!0);return v?T:f})}const B=()=>{if(U(["navn","kontaktEpost"]),!a)return;const h=L(n.latitude),f=L(n.longitude),v=L(n.feedSynligAntallDager);l.mutate({...t,navn:n.navn.trim(),kontaktEpost:n.kontaktEpost.trim(),banereglement:n.banereglement,latitude:h??t.latitude??null,longitude:f??t.longitude??null,feedUrl:n.feedUrl,feedSynligAntallDager:v??t.feedSynligAntallDager??50})};return e.jsx(_,{form:n,onChange:b,canSubmit:i,isSaving:l.isPending,onSubmit:B,touched:g,errors:p,onBlurField:s})}function N(t){return`${String(t).padStart(2,"0")}:00`}function Q({aapningHour:t,stengeHour:r,booking:l,onChangeAapningHour:n,onChangeStengeHour:o,onChangeMaksPerDag:g,onChangeMaksTotalt:d,onChangeDagerFremITid:p,onChangeSlotLengdeMinutter:k,canSubmit:a,isSaving:i,onSubmit:b}){return e.jsxs(P,{onSubmit:s=>{s.preventDefault(),b()},children:[e.jsx(y,{title:"Bookinginnstillinger",description:"Styr åpningstider og bookinggrenser.",children:e.jsx(E,{children:e.jsxs(M,{children:[e.jsx(c,{title:"Åpningstid",description:"Tidligste starttidspunkt.",right:e.jsx("div",{className:"text-sm font-medium tabular-nums",children:N(t)}),children:e.jsx(m,{children:e.jsx("input",{id:"aapningstid",type:"range",value:t,min:6,max:23,step:1,onChange:s=>n(Number(s.target.value)),className:"w-full accent-primary"})})}),e.jsx(c,{title:"Stengetid",description:"Seneste starttidspunkt.",right:e.jsx("div",{className:"text-sm font-medium tabular-nums",children:N(r)}),children:e.jsx(m,{children:e.jsx("input",{id:"stengetid",type:"range",value:r,min:6,max:23,step:1,onChange:s=>o(Number(s.target.value)),className:"w-full accent-primary"})})}),e.jsx(c,{title:"Maks bookinger per dag",description:"Per bruker.",right:e.jsx("div",{className:"text-sm font-medium tabular-nums",children:l.maksPerDag}),children:e.jsx(m,{children:e.jsx("input",{id:"maksPerDag",type:"range",value:l.maksPerDag,min:0,max:5,step:1,onChange:s=>g(Number(s.target.value)),className:"w-full accent-primary"})})}),e.jsx(c,{title:"Maks aktive bookinger",description:"Per bruker (totalt).",right:e.jsx("div",{className:"text-sm font-medium tabular-nums",children:l.maksTotalt}),children:e.jsx(m,{children:e.jsx("input",{id:"maksTotalt",type:"range",value:l.maksTotalt,min:0,max:10,step:1,onChange:s=>d(Number(s.target.value)),className:"w-full accent-primary"})})}),e.jsx(c,{title:"Hvor langt frem du kan booke",description:"Antall dager frem i tid.",right:e.jsx("div",{className:"text-sm font-medium tabular-nums",children:l.dagerFremITid}),children:e.jsx(m,{children:e.jsx("input",{id:"dagerFremITid",type:"range",value:l.dagerFremITid,min:1,max:14,step:1,onChange:s=>p(Number(s.target.value)),className:"w-full accent-primary"})})}),e.jsx(c,{title:"Slot-lengde",description:"Låst i denne versjonen.",children:e.jsx(m,{children:e.jsxs($,{value:l.slotLengdeMinutter.toString(),onValueChange:k,disabled:!0,children:[e.jsx(G,{id:"slotLengdeMinutter",children:e.jsx(W,{placeholder:"Velg slot-lengde"})}),e.jsxs(X,{children:[e.jsx(S,{value:"30",children:"30 minutter"}),e.jsx(S,{value:"45",children:"45 minutter"}),e.jsx(S,{value:"60",children:"60 minutter"}),e.jsx(S,{value:"90",children:"90 minutter"})]})]})})})]})})}),e.jsx(R,{variant:"sticky",children:e.jsx(C,{isLoading:i,disabled:!a,fullWidth:!0,loadingText:"Lagrer...",children:"Lagre endringer"})})]})}function A(t){const r=parseInt((t??"").split(":")[0]??"0",10);return Number.isFinite(r)?r:0}function j(t){return`${String(t).padStart(2,"0")}:00`}function Y(){const{data:t,isLoading:r,oppdaterKlubb:l}=K(),[n,o]=u.useState({maksPerDag:1,maksTotalt:2,dagerFremITid:7,slotLengdeMinutter:60,aapningstid:"07:00",stengetid:"22:00"});u.useEffect(()=>{t?.bookingRegel&&o({maksPerDag:t.bookingRegel.maksPerDag??1,maksTotalt:t.bookingRegel.maksTotalt??2,dagerFremITid:t.bookingRegel.dagerFremITid??7,slotLengdeMinutter:t.bookingRegel.slotLengdeMinutter??60,aapningstid:t.bookingRegel.aapningstid??"07:00",stengetid:t.bookingRegel.stengetid??"22:00"})},[t]);const g=u.useMemo(()=>A(n.aapningstid),[n.aapningstid]),d=u.useMemo(()=>A(n.stengetid),[n.stengetid]);u.useEffect(()=>{if(g>=d){const a=Math.min(23,g+1);o(i=>({...i,stengetid:j(a)}))}},[g,d]);const p=u.useMemo(()=>{if(!t?.bookingRegel)return!1;const a=t.bookingRegel;return n.maksPerDag!==(a.maksPerDag??1)||n.maksTotalt!==(a.maksTotalt??2)||n.dagerFremITid!==(a.dagerFremITid??7)||n.slotLengdeMinutter!==(a.slotLengdeMinutter??60)||n.aapningstid!==(a.aapningstid??"07:00")||n.stengetid!==(a.stengetid??"22:00")},[t,n]);if(r||!t)return e.jsx(w,{});const k=()=>{l.mutate({navn:t.navn??"",kontaktEpost:t.kontaktEpost??"",banereglement:t.banereglement??"",latitude:t.latitude??null,longitude:t.longitude??null,feedUrl:t.feedUrl??null,feedSynligAntallDager:t.feedSynligAntallDager??7,bookingRegel:n})};return e.jsx(Q,{aapningHour:g,stengeHour:d,booking:{maksPerDag:n.maksPerDag,maksTotalt:n.maksTotalt,dagerFremITid:n.dagerFremITid,slotLengdeMinutter:n.slotLengdeMinutter},onChangeAapningHour:a=>{const i=a,b=Math.max(d,i+1);o(s=>({...s,aapningstid:j(i),stengetid:j(Math.min(23,b))}))},onChangeStengeHour:a=>{const i=a,b=Math.min(g,i-1);o(s=>({...s,aapningstid:j(Math.max(6,b)),stengetid:j(i)}))},onChangeMaksPerDag:a=>o(i=>({...i,maksPerDag:a})),onChangeMaksTotalt:a=>o(i=>({...i,maksTotalt:a})),onChangeDagerFremITid:a=>o(i=>({...i,dagerFremITid:a})),onChangeSlotLengdeMinutter:a=>o(i=>({...i,slotLengdeMinutter:parseInt(a,10)})),canSubmit:p,isSaving:l.isPending,onSubmit:k})}function de(){return e.jsx(V,{children:e.jsx(H,{defaultValue:"info",items:[{value:"info",label:"Klubbinnstillinger",content:e.jsx(J,{})},{value:"booking",label:"Bookinginnstillinger",content:e.jsx(Y,{})}]})})}export{de as default};
