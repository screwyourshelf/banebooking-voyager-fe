import{j as e,r as l}from"./shadcn-nsGv8pGm.js";import{P as _}from"./Page-Cvsn-K9O.js";import{B as y,F as ee,h as G,I as te,j as ne,l as ae,L as se,t as ie}from"./index-CEYMlDzC.js";import{T as re,a as le,b as q,c as A,d as oe,e as V,u as de}from"./table-CKsAuSpY.js";import{P as z,a as H,b as W,R as m}from"./RowList-BUnu8tIY.js";import{L as ge,S as $}from"./SwitchRow-Cx41t_iY.js";import{S as ce,a as ue,b as he,c as ke,d as pe}from"./select-CwkaMbRh.js";import{D as J}from"./DatoVelger-DgKi0TLT.js";import{D as me,b as xe,c as fe,d as je,f as ve}from"./dialog-FwmrfKZx.js";import{f as Te,e as be,u as De,a as Ce,d as Se,t as Q,b as Fe}from"./datoUtils-Bzity_GL.js";import"./react-RGnvvjkK.js";import"./lucide-ByRD2J1s.js";import"./useBaner-OUooAADc.js";import"./switch-eeOa4_z8.js";import"./index-lSrDbPdF.js";import"./index-BEQRqDzz.js";function we({baner:c,beskrivelse:o,forhandsvisning:i}){const u=[...i.ledige,...i.konflikter].sort((t,s)=>t.dato.localeCompare(s.dato)||t.startTid.localeCompare(s.startTid)||t.baneId.localeCompare(s.baneId));return e.jsx("div",{className:"overflow-auto max-h-[60vh] border rounded-md",children:e.jsxs(re,{className:"text-sm",children:[e.jsx(le,{children:e.jsxs(q,{children:[e.jsx(A,{children:"Dato"}),e.jsx(A,{children:"Klokkeslett"}),e.jsx(A,{children:"Bane"}),e.jsx(A,{children:"Beskrivelse"})]})}),e.jsx(oe,{children:u.map(t=>{const s=c.find(r=>r.id===t.baneId),g=i.konflikter.some(r=>r.baneId===t.baneId&&r.dato===t.dato&&r.startTid===t.startTid&&r.sluttTid===t.sluttTid);return e.jsxs(q,{className:g?"bg-yellow-100":"",children:[e.jsx(V,{children:Te(t.dato)}),e.jsxs(V,{children:[t.startTid," – ",t.sluttTid]}),e.jsx(V,{children:s?.navn??"(ukjent bane)"}),e.jsxs(V,{children:[o,g&&e.jsx("span",{className:"ml-2 text-yellow-700 text-xs italic",children:"(Konflikt)"})]})]},`${t.dato}-${t.baneId}-${t.startTid}`)})})]})})}function Be({open:c,onOpenChange:o,baner:i,beskrivelse:u,forhandsvisning:t,isLoading:s,onCreate:g}){const r=t.ledige.length+t.konflikter.length>0;return e.jsx(me,{open:c,onOpenChange:o,children:e.jsxs(xe,{className:"max-w-3xl",children:[e.jsx(fe,{children:e.jsx(je,{children:"Forhåndsvis bookingene"})}),s?e.jsx("p",{className:"text-muted-foreground italic",children:"Laster forhåndsvisning…"}):r?e.jsxs(e.Fragment,{children:[e.jsx(we,{baner:i,beskrivelse:u,forhandsvisning:t}),e.jsx(ve,{className:"mt-3",children:e.jsxs(y,{type:"button",onClick:g,disabled:s,children:["Opprett ",t.ledige.length," bookinger"]})})]}):e.jsx("p",{className:"text-muted-foreground italic",children:"Ingen bookinger å vise."})]})})}const Ue=["Man","Tir","Ons","Tor","Fre","Lør","Søn"];function Ae(c){const{kategorier:o,kategori:i,beskrivelse:u,datoFra:t,datoTil:s,baner:g,tilgjengeligeUkedager:r,tilgjengeligeTidspunkter:d,valgteBaner:x,valgteUkedager:h,valgteTidspunkter:k,alleBaner:f,alleUkedager:j,alleTidspunkter:v,dialogOpen:T,forhandsvisning:w,isLoadingForhandsvisning:b,onChangeKategori:D,onChangeBeskrivelse:N,onChangeDatoFra:C,onChangeDatoTil:I,onToggleAlleBaner:S,onToggleAlleUkedager:K,onToggleAlleTidspunkter:B,onToggleBane:L,onToggleUkedag:U,onToggleTidspunkt:O,onOpenPreview:P,onCreate:F,onDialogOpenChange:p}=c;return e.jsxs(e.Fragment,{children:[e.jsxs(ee,{onSubmit:n=>{n.preventDefault(),P()},children:[e.jsx(z,{title:"Type",description:"Kategori og beskrivelse for arrangementet.",children:e.jsx(H,{children:e.jsxs(W,{children:[e.jsx(m,{title:"Kategori",description:"Velg type arrangement.",children:e.jsxs(G,{children:[e.jsx(ge,{htmlFor:"kategori",className:"sr-only",children:"Kategori"}),e.jsxs(ce,{value:i,onValueChange:D,children:[e.jsx(ue,{id:"kategori",children:e.jsx(he,{placeholder:"Velg kategori..."})}),e.jsx(ke,{children:o.map(n=>e.jsx(pe,{value:n,children:n},n))})]})]})}),e.jsx(m,{title:"Beskrivelse",description:"Vises på bookingene.",children:e.jsx(G,{children:e.jsx(te,{id:"beskrivelse",value:u,onChange:n=>N(n.target.value)})})})]})})}),e.jsx(z,{title:"Periode",description:"Velg dato-intervallet og hvilke ukedager som gjelder.",children:e.jsx(H,{children:e.jsxs(W,{children:[e.jsx(m,{title:"Fra",description:"Startdato.",children:e.jsx(J,{value:t,onChange:C,visNavigering:!0})}),e.jsx(m,{title:"Til",description:"Sluttdato.",children:e.jsx(J,{value:s,onChange:I,visNavigering:!0})}),e.jsx($,{title:"Alle gyldige dager",description:"Velger automatisk alle dager som finnes i perioden.",checked:j,onCheckedChange:K}),e.jsx(m,{title:"Ukedager",description:"Bare dager som finnes i perioden er aktive.",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:Ue.map(n=>e.jsx(y,{type:"button",variant:h.includes(n)?"default":"outline",size:"sm",onClick:()=>U(n),disabled:j||!r.includes(n),children:n},n))})})]})})}),e.jsx(z,{title:"Baner og tid",description:"Velg hvilke baner og tidspunkter som skal reserveres.",children:e.jsx(H,{children:e.jsxs(W,{children:[e.jsx($,{title:"Velg alle baner",checked:f,onCheckedChange:S}),e.jsx(m,{title:"Baner",description:"Velg hvilke baner arrangementet gjelder.",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:g.map(n=>e.jsx(y,{type:"button",variant:x.includes(n.id)?"default":"outline",size:"sm",onClick:()=>L(n.id),disabled:f,children:n.navn},n.id))})}),e.jsx($,{title:"Velg alle tidspunkter",checked:v,onCheckedChange:B}),e.jsx(m,{title:"Tidspunkter",description:"Velg start-tidspunkt for bookingene.",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:d.map(n=>e.jsx(y,{type:"button",variant:k.includes(n)?"default":"outline",size:"sm",onClick:()=>O(n),disabled:v,children:n},n))})})]})})}),e.jsx(ne,{variant:"sticky",children:e.jsx(ae,{isLoading:b,loadingText:"Forhåndsviser…",fullWidth:!0,children:"Forhåndsvis bookinger"})})]}),e.jsx(Be,{open:T,onOpenChange:p,baner:g,beskrivelse:u,forhandsvisning:w,isLoading:b,onCreate:F})]})}function Ve(c,o){const i=new Set,u=new Date(c),t=new Date(o);for(let s=new Date(u);s<=t;s.setDate(s.getDate()+1)){const g=s.getDay(),r=Fe[g],d=be[r];d&&i.add(d)}return De.filter(s=>i.has(s))}function ye(c){const{datoFra:o,datoTil:i,valgteBaner:u,valgteUkedager:t,valgteTidspunkter:s,kategori:g,beskrivelse:r,onWarning:d}=c;if(!o||!i)return d("Du må velge start- og sluttdato"),null;if(u.length===0)return d("Du må velge minst én bane"),null;if(s.length===0)return d("Du må velge minst ett tidspunkt"),null;if(t.length===0)return d("Du må velge minst én ukedag"),null;const x=Ce(o,i),h=t.map(k=>Se[k]).filter(k=>x.has(k));return h.length===0?(d("Ingen av de valgte ukedagene finnes i datointervallet"),null):{tittel:g,beskrivelse:r,kategori:g,startDato:Q(o),sluttDato:Q(i),ukedager:h,tidspunkter:s,baneIder:u}}const Ne=["Trening","Turnering","Klubbmersterskap","Kurs","Lagkamp","Stigespill","Dugnad","Vedlikehold","Sosialt","Annet"];function Ie(){const{baner:c,tilgjengeligeTidspunkter:o,forhandsvisning:i,forhandsvis:u,clearForhandsvisning:t,opprett:s,isLoading:g,isLoadingForhandsvisning:r}=de(),[d,x]=l.useState(new Date),[h,k]=l.useState(new Date),[f,j]=l.useState([]),[v,T]=l.useState([]),[w,b]=l.useState([]),[D,N]=l.useState(!1),[C,I]=l.useState(!1),[S,K]=l.useState(!1),[B,L]=l.useState("Annet"),[U,O]=l.useState(""),[P,F]=l.useState(!1),p=l.useMemo(()=>Ve(d,h),[d,h]);l.useEffect(()=>{D&&j(c.map(a=>a.id))},[D,c]),l.useEffect(()=>{C&&T(p)},[C,p]),l.useEffect(()=>{S&&b(o)},[S,o]),l.useEffect(()=>{T(a=>a.filter(R=>p.includes(R)))},[p]);const n=(a,R)=>{R(E=>E.includes(a)?E.filter(Z=>Z!==a):[...E,a])},M=()=>ye({datoFra:d,datoTil:h,valgteBaner:f,valgteUkedager:v,valgteTidspunkter:w,kategori:B,beskrivelse:U,onWarning:a=>ie.warning(a)}),X=async()=>{const a=M();a&&(F(!0),await u(a))},Y=async()=>{const a=M();a&&(await s(a),t(),F(!1))};return g?e.jsx(se,{}):e.jsx(Ae,{kategorier:Ne,kategori:B,beskrivelse:U,datoFra:d,datoTil:h,baner:c,tilgjengeligeUkedager:p,tilgjengeligeTidspunkter:o,valgteBaner:f,valgteUkedager:v,valgteTidspunkter:w,alleBaner:D,alleUkedager:C,alleTidspunkter:S,dialogOpen:P,forhandsvisning:i,isLoadingForhandsvisning:r,onChangeKategori:L,onChangeBeskrivelse:O,onChangeDatoFra:x,onChangeDatoTil:k,onToggleAlleBaner:N,onToggleAlleUkedager:I,onToggleAlleTidspunkter:K,onToggleBane:a=>n(a,j),onToggleUkedag:a=>n(a,T),onToggleTidspunkt:a=>n(a,b),onOpenPreview:X,onCreate:Y,onDialogOpenChange:a=>{F(a),a||t()}})}function Ye(){return e.jsx(_,{children:e.jsx(Ie,{})})}export{Ye as default};
