import{r as o,j as n}from"./shadcn-BW0HktFr.js";import{u as B}from"./useSlug-CLlizT9B.js";import{P as L}from"./Page-BxwDHPA6.js";import{S as C}from"./SimpleTabsLazy-d2uoACPW.js";import{u as j}from"./useBaner-BtJ3Nsz9.js";import{B as h}from"./index-DfwF_6E0.js";import{S as E,F as m}from"./SelectField-DLRV7FN-.js";import{S as k,a as P}from"./switch-CeDFAo51.js";import"./react-RGnvvjkK.js";import"./lucide-D2dOsrR-.js";import"./FieldWrapper-fgOeih5f.js";import"./index-CVVkWozz.js";const p="rediger.valgtBaneId";function F({slug:c}){const{baner:s,isLoading:r,oppdaterBane:d}=j(c,!0),[g,u]=o.useState({}),[t,i]=o.useState(()=>{const e=sessionStorage.getItem(p);return e&&e!=="null"?e:null}),a=s.find(e=>e.id===t)??null,l=t?g[t]??null:null;o.useEffect(()=>{sessionStorage.setItem(p,t??"null")},[t]),o.useEffect(()=>{t&&!s.some(e=>e.id===t)&&i(null)},[s,t]),o.useEffect(()=>{!t&&s.length>0&&i(s[0].id)},[s,t]);function f(e,b,v){u(x=>({...x,[e]:{...x[e]??s.find(N=>N.id===e),[b]:v}}))}async function y(){if(!t)return;const e=g[t];if(e)try{await d.mutateAsync({id:t,dto:e}),u(b=>{const v={...b};return delete v[t],v})}catch{}}const S=!!a&&!!l&&!(l.navn===a.navn&&l.beskrivelse===a.beskrivelse&&l.aktiv===a.aktiv);return r?n.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Laster..."}):n.jsx(k,{title:"Rediger bane",description:"Velg en bane og oppdater informasjon.",children:n.jsxs("form",{className:"space-y-4",onSubmit:e=>{e.preventDefault(),y()},children:[n.jsx(E,{id:"velg-bane",label:"Velg bane",value:t??"",onChange:e=>i(e||null),options:s.map(e=>({label:`${e.navn} ${e.aktiv?"":"(inaktiv)"}`,value:e.id}))}),a?n.jsxs(n.Fragment,{children:[n.jsx(m,{id:"navn",label:"Navn",value:l?.navn??a.navn,onChange:e=>f(a.id,"navn",e.target.value)}),n.jsx(m,{id:"beskrivelse",label:"Beskrivelse",value:l?.beskrivelse??a.beskrivelse,onChange:e=>f(a.id,"beskrivelse",e.target.value)}),n.jsxs("div",{className:"flex items-center justify-between gap-3",children:[n.jsxs("div",{className:"min-w-0",children:[n.jsx("div",{className:"text-sm font-medium leading-5",children:"Aktiv"}),n.jsx("div",{className:"text-xs text-muted-foreground mt-1 leading-4",children:"Avgir om banen er tilgjengelig for booking."})]}),n.jsx(P,{checked:l?.aktiv??a.aktiv,onCheckedChange:e=>f(a.id,"aktiv",e)})]}),n.jsx("div",{className:"flex justify-end",children:n.jsx(h,{size:"sm",type:"submit",disabled:!S||d.isPending,children:d.isPending?"Lagrer...":"Lagre"})})]}):n.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ingen baner funnet."})]})})}function I({slug:c}){const{opprettBane:s}=j(c),[r,d]=o.useState({navn:"",beskrivelse:""}),[g,u]=o.useState(null);async function t(){const i=r.navn.trim();if(!i){u("Navn er pÃ¥krevd.");return}u(null);try{await s.mutateAsync({...r,navn:i}),d({navn:"",beskrivelse:""})}catch{}}return n.jsx(k,{title:"Ny bane",description:"Legg til en ny bane i klubben.",children:n.jsxs("form",{className:"space-y-3",onSubmit:i=>{i.preventDefault(),t()},children:[n.jsx(m,{id:"ny-navn",label:"Navn",value:r.navn,error:g,onChange:i=>{const a=i.target.value;d(l=>({...l,navn:a})),g&&a.trim()&&u(null)}}),n.jsx(m,{id:"ny-beskrivelse",label:"Beskrivelse",value:r.beskrivelse,onChange:i=>d(a=>({...a,beskrivelse:i.target.value}))}),n.jsx(h,{size:"sm",type:"submit",disabled:s.isPending,children:s.isPending?"Legger til...":"Legg til"})]})})}function _(){const[c,s]=o.useState("rediger"),r=B();return n.jsx(L,{children:n.jsx(C,{items:[{value:"rediger",label:"Rediger bane",content:n.jsx(F,{slug:r})},{value:"ny",label:"Ny bane",content:n.jsx(I,{slug:r})}],value:c,onValueChange:s})})}export{_ as default};
