import{r as o,j as n}from"./shadcn-BW0HktFr.js";import{u as S}from"./useSlug-Dgkv8Wrt.js";import{P as N}from"./Page-D3HqBSgJ.js";import{S as C}from"./SimpleTabsLazy-C44pBQN4.js";import{u as k}from"./useBaner-B8f9R8Ud.js";import{B as h,t as E}from"./index-BWn9U0qn.js";import{S as P,F as m}from"./SelectField-CME5RjN4.js";import{P as j}from"./PageSection-DNO2zFH9.js";import"./react-RGnvvjkK.js";import"./lucide-D2dOsrR-.js";import"./FieldWrapper-EgKMkGRF.js";import"./index-CVVkWozz.js";const x="rediger.valgtBaneId";function L({slug:u}){const{baner:a,isLoading:r,oppdaterBane:c}=k(u,!0),[v,i]=o.useState({}),[t,f]=o.useState(()=>{const e=sessionStorage.getItem(x);return e&&e!=="null"?e:null}),s=a.find(e=>e.id===t)??null,l=t?v[t]??null:null;o.useEffect(()=>{sessionStorage.setItem(x,t??"null")},[t]),o.useEffect(()=>{t&&!a.some(e=>e.id===t)&&f(null)},[a,t]),o.useEffect(()=>{!t&&a.length>0&&f(a[0].id)},[a,t]);function p(e,g,b){i(d=>({...d,[e]:{...d[e]??a.find(B=>B.id===e),[g]:b}}))}async function y(e){const g=v[e];if(g)try{await c.mutateAsync({id:e,dto:g}),i(b=>{const d={...b};return delete d[e],d})}catch{}}return r?n.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Laster..."}):n.jsxs(j,{bordered:!0,className:"space-y-4",children:[n.jsx(P,{id:"velg-bane",label:"Velg bane",value:t??"",onChange:e=>f(e||null),options:a.map(e=>({label:`${e.navn} ${e.aktiv?"":"(inaktiv)"}`,value:e.id}))}),s&&n.jsxs(n.Fragment,{children:[n.jsx(m,{id:"navn",label:"Navn",value:l?.navn??s.navn,onChange:e=>p(s.id,"navn",e.target.value)}),n.jsx(m,{id:"beskrivelse",label:"Beskrivelse",value:l?.beskrivelse??s.beskrivelse,onChange:e=>p(s.id,"beskrivelse",e.target.value)}),n.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[n.jsx("input",{type:"checkbox",checked:l?.aktiv??s.aktiv,onChange:e=>p(s.id,"aktiv",e.target.checked)}),n.jsx("span",{children:"Aktiv"})]}),n.jsx("div",{className:"flex justify-end",children:n.jsx(h,{size:"sm",onClick:e=>{e.preventDefault(),y(s.id)},disabled:!l||l.navn===s.navn&&l.beskrivelse===s.beskrivelse&&l.aktiv===s.aktiv,children:c.isPending?"Lagrer...":"Lagre"})})]})]})}function T({slug:u}){const{opprettBane:a}=k(u),[r,c]=o.useState({navn:"",beskrivelse:""});async function v(){if(!r.navn.trim()){E.error("Navn er pÃ¥krevd");return}try{await a.mutateAsync(r),c({navn:"",beskrivelse:""})}catch{}}return n.jsxs(j,{bordered:!0,className:"space-y-3",children:[n.jsx(m,{id:"ny-navn",label:"Navn",value:r.navn,onChange:i=>c(t=>({...t,navn:i.target.value}))}),n.jsx(m,{id:"ny-beskrivelse",label:"Beskrivelse",value:r.beskrivelse,onChange:i=>c(t=>({...t,beskrivelse:i.target.value}))}),n.jsx(h,{size:"sm",onClick:i=>{i.preventDefault(),v()},disabled:a.isPending,children:a.isPending?"Legger til...":"Legg til"})]})}function Y(){const[u,a]=o.useState("rediger"),r=S();return n.jsx(N,{children:n.jsx(C,{items:[{value:"rediger",label:"Rediger bane",content:n.jsx(L,{slug:r})},{value:"ny",label:"Ny bane",content:n.jsx(T,{slug:r})}],value:u,onValueChange:a})})}export{Y as default};
