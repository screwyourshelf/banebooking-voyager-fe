import{r as k,j as l}from"./shadcn-BWI-zYLE.js";import{w as N,g as $,u as D,a as F,d as C,b as R,c as x,t as f,f as d}from"./index-BatLQ3bG.js";import{u as L}from"./useBaner-ClqJhM1L.js";function B(e){if(!e)return;const t={...e};return delete t.requireAuth,delete t.axiosConfig,delete t.enabled,t}function E(e,t,a,s){const g=(s?.enabled??!0)&&a!=null,c=s?.requireAuth??!0,i=B(s);return N({queryKey:e,enabled:g,retry:!1,...i,queryFn:async({signal:n})=>(await $.post(t,a,{requireAuth:c,signal:n,timeout:2e4,...s?.axiosConfig??{}})).data})}function w(e){const[t,a]=e.split(":").map(Number);return t*60+a}function I(e){const t=String(Math.floor(e/60)).padStart(2,"0"),a=String(e%60).padStart(2,"0");return`${t}:${a}`}function O(e,t,a){const s=w(e),g=w(t),c=[];for(let i=s;i+a<=g;i+=a)c.push(I(i));return c}const _={ledige:[],konflikter:[]};function H(e){const t={...e,ukedager:[...e.ukedager].sort(),tidspunkter:[...e.tidspunkter].sort(),baneIder:[...e.baneIder].sort()};return JSON.stringify(t)}function G(){const e=D(),t=F(),{data:a,isLoading:s}=C(),{baner:g,isLoading:c}=L(),i=k.useMemo(()=>{if(!a?.bookingRegel)return[];const r=a.bookingRegel.aapningstid||"08:00",u=a.bookingRegel.stengetid||"22:00",o=a.bookingRegel.slotLengdeMinutter||60;return O(r,u,o)},[a?.bookingRegel]),n=["arrangementer",e],m=R(n,`/klubb/${e}/arrangement/kommende`,{requireAuth:!0,staleTime:3e4,select:r=>[...r].sort((u,o)=>u.startDato.localeCompare(o.startDato))}),[b,p]=k.useState(null),A=b?["arrangement-forhandsvis",e,H(b)]:["arrangement-forhandsvis",e,"empty"],y=E(A,`/klubb/${e}/arrangement/forhandsvis`,b,{requireAuth:!0,enabled:!!b,staleTime:6e4,retry:!1}),T=y.data??_,Q=y.isFetching,q=async r=>(p(r),{success:!0}),h=()=>{p(null),t.cancelQueries({queryKey:["arrangement-forhandsvis",e]}),t.removeQueries({queryKey:["arrangement-forhandsvis",e]})},j=x("post",`/klubb/${e}/arrangement`,{onSuccess:async r=>{h(),f.success(`${r.opprettet.length} bookinger opprettet`),await t.invalidateQueries({queryKey:n})},onError:r=>f.error(r.message??"Feil ved oppretting"),retry:!1}),K=async r=>({success:!0,result:await j.mutateAsync(r)}),v=x("delete",({arrangementId:r})=>`/klubb/${e}/arrangement/${r}`,{onMutate:async({arrangementId:r})=>{await t.cancelQueries({queryKey:n});const u=t.getQueryData(n);return t.setQueryData(n,o=>(o??[]).filter(M=>M.id!==r)),{previous:u}},onError:(r,u,o)=>{f.error(r.message??"Kunne ikke slette arrangementet"),o?.previous&&t.setQueryData(n,o.previous)},onSuccess:r=>{f.success(`Arrangementet ble avlyst â€“ ${r.antallBookingerDeaktivert} bookinger fjernet`)},onSettled:async()=>{await t.invalidateQueries({queryKey:n})},retry:!1}),S=async r=>{await v.mutateAsync({arrangementId:r})};return{klubb:a,baner:g,tilgjengeligeTidspunkter:i,arrangementer:m.data??[],forhandsvisning:T,forhandsvis:q,clearForhandsvisning:h,opprett:K,slettArrangement:S,refetchArrangementer:m.refetch,isLoading:s||c||m.isLoading,isLoadingForhandsvisning:Q,sletterArrangementId:v.variables?.arrangementId??null}}function U({className:e,...t}){return l.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:l.jsx("table",{"data-slot":"table",className:d("w-full caption-bottom text-sm",e),...t})})}function V({className:e,...t}){return l.jsx("thead",{"data-slot":"table-header",className:d("[&_tr]:border-b",e),...t})}function W({className:e,...t}){return l.jsx("tbody",{"data-slot":"table-body",className:d("[&_tr:last-child]:border-0",e),...t})}function X({className:e,...t}){return l.jsx("tr",{"data-slot":"table-row",className:d("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...t})}function Y({className:e,...t}){return l.jsx("th",{"data-slot":"table-head",className:d("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}function Z({className:e,...t}){return l.jsx("td",{"data-slot":"table-cell",className:d("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}export{U as T,V as a,X as b,Y as c,W as d,Z as e,G as u};
