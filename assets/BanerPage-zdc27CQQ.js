import{r as d,j as s}from"./shadcn-BfUXmlP3.js";import{u as z,T as R,a as V,b as p,c as f}from"./useBaner-BsHNeszA.js";import{I as u,B as m,t as r}from"./index-uHteJ7vG.js";import{L as v}from"./label-R3hj6KvP.js";import{S as A,a as G,b as O,c as P,d as Y}from"./select-CvMguXA-.js";import{C as y,a as B}from"./card-1imxvBqP.js";import"./react-D5d5vywP.js";import"./lucide-CZTSiasK.js";import"./index-36j8ZHWB.js";const N="rediger.valgtBaneId";function Z(){const{baner:l,isLoading:C,oppdaterBane:S,opprettBane:T,deaktiverBane:E,aktiverBane:I}=z(!0),[k,g]=d.useState({}),[o,x]=d.useState({navn:"",beskrivelse:""}),[n,b]=d.useState(()=>{const e=sessionStorage.getItem(N);return e&&e!=="null"?e:null}),a=l.find(e=>e.id===n)??null,t=n?k[n]??null:null;d.useEffect(()=>{sessionStorage.setItem(N,n??"null")},[n]),d.useEffect(()=>{n&&!l.some(e=>e.id===n)&&b(null)},[l,n]);function j(e,i,h){g(c=>({...c,[e]:{...c[e]??l.find(K=>K.id===e),[i]:h}}))}async function L(e){const i=k[e];if(i)try{await S(e,i),r.success("Endringer lagret"),g(h=>{const c={...h};return delete c[e],c})}catch{r.error("Kunne ikke lagre bane")}}async function w(){if(!o.navn.trim()){r.error("Navn er påkrevd");return}try{await T(o),r.success("Bane lagt til"),x({navn:"",beskrivelse:""})}catch{r.error("Kunne ikke legge til bane")}}async function F(e){try{await E(e),r.success("Bane deaktivert")}catch{r.error("Kunne ikke deaktivere bane")}}async function D(e){try{await I(e),r.success("Bane aktivert")}catch{r.error("Kunne ikke aktivere bane")}}return s.jsx("div",{className:"max-w-screen-sm mx-auto px-2 py-2",children:s.jsxs(R,{defaultValue:"rediger",className:"space-y-4",children:[s.jsxs(V,{className:"mb-2",children:[s.jsx(p,{value:"rediger",children:"Rediger bane"}),s.jsx(p,{value:"ny",children:"Ny bane"})]}),s.jsx(f,{value:"rediger",children:C?s.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Laster..."}):s.jsx(y,{children:s.jsxs(B,{className:"p-4 space-y-4",children:[s.jsxs("div",{children:[s.jsx(v,{className:"mb-1 block text-sm font-medium",children:"Velg bane"}),s.jsxs(A,{value:n??"",onValueChange:e=>b(e||null),children:[s.jsx(G,{children:s.jsx(O,{placeholder:"— Velg bane —"})}),s.jsx(P,{children:l.map(e=>s.jsxs(Y,{value:e.id,children:[e.navn," ",e.aktiv?"":"(inaktiv)"]},e.id))})]})]}),a&&s.jsxs(s.Fragment,{children:[s.jsxs("div",{children:[s.jsx(v,{htmlFor:"navn",className:"block mb-1",children:"Navn"}),s.jsx(u,{id:"navn",value:(t==null?void 0:t.navn)??a.navn,onChange:e=>j(a.id,"navn",e.target.value),disabled:!a.aktiv})]}),s.jsxs("div",{children:[s.jsx(v,{htmlFor:"beskrivelse",className:"block mb-1",children:"Beskrivelse"}),s.jsx(u,{id:"beskrivelse",value:(t==null?void 0:t.beskrivelse)??a.beskrivelse,onChange:e=>j(a.id,"beskrivelse",e.target.value),disabled:!a.aktiv})]}),s.jsx("div",{className:"flex justify-between",children:a.aktiv?s.jsxs(s.Fragment,{children:[s.jsx(m,{size:"sm",onClick:e=>{e.preventDefault(),L(a.id)},disabled:!t||t.navn===a.navn&&t.beskrivelse===a.beskrivelse,children:"Lagre"}),s.jsx(m,{variant:"destructive",size:"sm",onClick:e=>{e.preventDefault(),F(a.id)},children:"Deaktiver"})]}):s.jsx(m,{variant:"outline",size:"sm",onClick:e=>{e.preventDefault(),D(a.id)},children:"Aktiver"})})]})]})})}),s.jsx(f,{value:"ny",children:s.jsx(y,{children:s.jsxs(B,{className:"p-4 space-y-3",children:[s.jsxs("div",{children:[s.jsx(v,{htmlFor:"ny-navn",className:"block mb-1",children:"Navn"}),s.jsx(u,{id:"ny-navn",value:o.navn,onChange:e=>x(i=>({...i,navn:e.target.value}))})]}),s.jsxs("div",{children:[s.jsx(v,{htmlFor:"ny-beskrivelse",className:"block mb-1",children:"Beskrivelse"}),s.jsx(u,{id:"ny-beskrivelse",value:o.beskrivelse,onChange:e=>x(i=>({...i,beskrivelse:e.target.value}))})]}),s.jsx(m,{size:"sm",onClick:e=>{e.preventDefault(),w()},children:"Legg til"})]})})})]})})}export{Z as default};
