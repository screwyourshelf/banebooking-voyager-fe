import{j as e,r as s}from"./shadcn-CGWS6Fka.js";import{P as K}from"./Page-BqGewD4P.js";import{T as O}from"./Tabs-CnThGfnZ.js";import{u as C}from"./useBaner-Cdz-fTbb.js";import{F as L,i as N,I as y,j as I,l as R,m as w,L as Y}from"./index-puGzu8-1.js";import{P as M,a as A,b as F,R as j}from"./RowList-CBSK04iI.js";import{S as _}from"./switch-CjtXT-wj.js";import{S as $,a as q,b as z,c as H,d as J}from"./select-BL2cVPoN.js";import"./react-RGnvvjkK.js";import"./tabs-DFACTpMj.js";import"./lucide-C5rSQBgG.js";import"./index-DnnwNeRP.js";function Q({baner:t,valgtBaneId:a,onChangeValgtBaneId:g,valgtBane:u,redigerteVerdier:v,onChangeFelt:n,canSubmit:b,isSaving:l,onSubmit:k,navnError:h,onBlurNavn:x}){const i=v?.navn??u?.navn??"",d=v?.beskrivelse??u?.beskrivelse??"",c=v?.aktiv??u?.aktiv??!1;return e.jsxs(L,{onSubmit:r=>{r.preventDefault(),k()},children:[e.jsx(M,{title:"Rediger bane",description:"Velg en bane og oppdater informasjon.",children:e.jsx(A,{children:e.jsxs(F,{children:[e.jsx(j,{title:"Velg bane",description:"Velg hvilken bane du vil endre.",children:e.jsx(N,{children:e.jsxs($,{disabled:l,value:a??"",onValueChange:r=>g(r||null),children:[e.jsx(q,{id:"velg-bane",className:"bg-background",children:e.jsx(z,{placeholder:"Velg bane..."})}),e.jsx(H,{children:t.map(r=>e.jsxs(J,{value:r.id,children:[r.navn," ",r.aktiv?"":"(inaktiv)"]},r.id))})]})})}),u?e.jsxs(e.Fragment,{children:[e.jsx(j,{title:"Navn",description:"Navn på banen slik det vises i booking.",children:e.jsxs(N,{"data-invalid":!!h,children:[e.jsx(y,{id:"navn",disabled:l,value:i,onChange:r=>n("navn",r.target.value),onBlur:x,"aria-invalid":!!h,autoComplete:"off"}),h?e.jsx(I,{children:h}):null]})}),e.jsx(j,{title:"Beskrivelse",description:"Valgfritt.",children:e.jsx(N,{children:e.jsx(y,{id:"beskrivelse",disabled:l,value:d,onChange:r=>n("beskrivelse",r.target.value),autoComplete:"off"})})}),e.jsx(j,{title:"Aktiv",description:"Avgjør om banen er tilgjengelig for booking.",right:e.jsx(_,{disabled:l,checked:c,onCheckedChange:r=>n("aktiv",r)})})]}):e.jsx(j,{title:"Ingen baner funnet",children:e.jsx("div",{className:"text-sm text-muted-foreground italic",children:"Det finnes ingen baner å redigere."})})]})})}),e.jsx(R,{variant:"sticky",align:"left",spaced:!1,className:"w-full",children:e.jsx(w,{fullWidth:!0,isLoading:l,disabled:!b,loadingText:"Lagrer...",children:"Lagre"})})]})}const P="rediger.valgtBaneId";function U(){const t=sessionStorage.getItem(P);return t&&t!=="null"?t:null}function X(t){sessionStorage.setItem(P,t??"null")}function Z(t){return t.trim()?null:"Navn er påkrevd."}function ee(){const{baner:t,isLoading:a,oppdaterBane:g}=C(!0),[u,v]=s.useState({}),[n,b]=s.useState(()=>U()),[l,k]=s.useState({}),[h,x]=s.useState(!1),i=s.useMemo(()=>t.find(o=>o.id===n)??null,[t,n]),d=s.useMemo(()=>n?u[n]??null:null,[u,n]);s.useEffect(()=>{X(n)},[n]),s.useEffect(()=>{n&&!t.some(o=>o.id===n)&&b(null)},[t,n]),s.useEffect(()=>{!n&&t.length>0&&b(t[0].id)},[t,n]),s.useEffect(()=>{x(!1)},[n]);function c(o,m){k(f=>{const S=f[o]??{navn:!1};return S[m]?f:{...f,[o]:{...S,[m]:!0}}})}function r(o,m,f){v(S=>({...S,[o]:{...S[o]??t.find(G=>G.id===o),[m]:f}}))}const p=s.useMemo(()=>i?d??{navn:i.navn,beskrivelse:i.beskrivelse,aktiv:i.aktiv}:null,[i,d]),B=s.useMemo(()=>({navn:p?Z(p.navn):null}),[p]),T=s.useMemo(()=>!i||!d?!1:!(d.navn===i.navn&&d.beskrivelse===i.beskrivelse&&d.aktiv===i.aktiv),[i,d]),E=s.useMemo(()=>!B.navn,[B.navn]),V=T&&E,D=(n?l[n]?.navn??!1:!1)||h?B.navn:null;async function W(){if(!n||!i||(x(!0),c(n,"navn"),!V))return;const o=u[n];if(o)try{await g.mutateAsync({id:n,dto:o}),v(m=>{const f={...m};return delete f[n],f}),k(m=>{const f={...m};return delete f[n],f}),x(!1)}catch{}}return a?e.jsx(Y,{}):e.jsx(Q,{baner:t,valgtBaneId:n,onChangeValgtBaneId:b,valgtBane:i,redigerteVerdier:d,onChangeFelt:(o,m)=>{i&&r(i.id,o,m)},canSubmit:V,isSaving:g.isPending,onSubmit:()=>void W(),navnError:D,onBlurNavn:()=>{n&&c(n,"navn")}})}function ne({form:t,onChange:a,canSubmit:g,isSaving:u,onSubmit:v,navnError:n,onBlurNavn:b}){return e.jsxs(L,{onSubmit:l=>{l.preventDefault(),v()},children:[e.jsx(M,{title:"Ny bane",description:"Legg til en ny bane i klubben.",children:e.jsx(A,{children:e.jsxs(F,{children:[e.jsx(j,{title:"Navn",description:"Navn på banen slik det vises i booking.",children:e.jsxs(N,{"data-invalid":!!n,children:[e.jsx(y,{id:"ny-navn",disabled:u,value:t.navn,onChange:l=>a("navn",l.target.value),onBlur:b,"aria-invalid":!!n,autoComplete:"off"}),n?e.jsx(I,{children:n}):null]})}),e.jsx(j,{title:"Beskrivelse",description:"Valgfritt.",children:e.jsx(N,{children:e.jsx(y,{id:"ny-beskrivelse",disabled:u,value:t.beskrivelse,onChange:l=>a("beskrivelse",l.target.value),autoComplete:"off"})})})]})})}),e.jsx(R,{variant:"sticky",align:"left",spaced:!1,className:"w-full",children:e.jsx(w,{fullWidth:!0,isLoading:u,disabled:!g,loadingText:"Legger til...",children:"Legg til"})})]})}function te(t){return t.trim()?null:"Navn er påkrevd."}function ie(){const{opprettBane:t}=C(),[a,g]=s.useState({navn:"",beskrivelse:""}),[u,v]=s.useState({navn:!1}),n=s.useMemo(()=>({navn:te(a.navn)}),[a.navn]),b=s.useMemo(()=>a.navn.trim().length>0||a.beskrivelse.trim().length>0,[a.navn,a.beskrivelse]),l=s.useMemo(()=>!n.navn,[n.navn]),k=b&&l,h=u.navn?n.navn:null;function x(c,r){g(p=>({...p,[c]:r}))}function i(){v(c=>c.navn?c:{...c,navn:!0})}async function d(){if(i(),!l)return;const c=a.navn.trim();try{await t.mutateAsync({navn:c,beskrivelse:a.beskrivelse}),g({navn:"",beskrivelse:""}),v({navn:!1})}catch{}}return e.jsx(ne,{form:a,onChange:x,canSubmit:k,isSaving:t.isPending,onSubmit:()=>void d(),navnError:h,onBlurNavn:i})}function he(){return e.jsx(K,{children:e.jsx(O,{defaultValue:"rediger",items:[{value:"rediger",label:"Rediger bane",content:e.jsx(ee,{})},{value:"ny",label:"Ny bane",content:e.jsx(ie,{})}]})})}export{he as default};
