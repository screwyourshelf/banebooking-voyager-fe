import{j as e,r as g}from"./react-Bq13ngtT.js";import{P as M}from"./Page-Dw6mAgQE.js";import{a as E,b as D,d as K,e as P,t as C,B as v,o as S,I as w,w as I,L as U}from"./index-Bs-TkeFL.js";import{P as F,a as Q,b as V,R as N}from"./RowList-BKzhyJWV.js";import{S as q}from"./switch-P_AE6A6X.js";import{A as $,a as T,b as z,B as O,c as W}from"./badge-DjWA7dJx.js";import{i as _,U as H,S as G}from"./lucide-Bfr9gI8s.js";import{D as J,b as X,c as Y,d as Z,f as ee}from"./dialog-21Nd-wyQ.js";import"./shadcn-B0ihbUNs.js";function se(){const r=E(),c=D(),l=["admin-brukere",r],a=K(l,`/klubb/${r}/bruker/admin/bruker`,{requireAuth:!0,staleTime:3e4}),u=P("put",({brukerId:t})=>`/klubb/${r}/bruker/admin/bruker/${t}`,{onSuccess:async()=>{C.success("Bruker oppdatert"),await c.invalidateQueries({queryKey:l})},onError:t=>C.error(t.message??"Kunne ikke oppdatere bruker"),retry:!1}),d=async(t,m)=>{await u.mutateAsync({brukerId:t,rolle:m.rolle,visningsnavn:m.visningsnavn})};return{brukere:a.data??[],laster:a.isLoading,oppdaterLaster:u.isPending,oppdater:d,hentBrukere:a.refetch,error:a.error?.message??null}}const re=["Medlem","Utvidet","KlubbAdmin"];function te(r){return r?r.toLowerCase().startsWith("slettet_"):!1}function ne({query:r,onQueryChange:c,visSlettede:l,onVisSlettedeChange:a,rolleFilter:u,onToggleRolle:d,filtrerteBrukere:t,lasterListe:m,currentBrukerId:j,onRedigerBruker:h}){return e.jsx("div",{className:"space-y-4",children:e.jsxs(F,{title:"Brukere",description:"Søk etter brukere og endre rolle eller visningsnavn.",children:[e.jsx(Q,{children:e.jsxs(V,{children:[e.jsx(N,{title:"Filter på rolle",description:"",children:e.jsx("div",{className:"flex flex-wrap gap-2",children:re.map(s=>{const o=u.includes(s);return e.jsx(v,{type:"button",size:"sm",variant:o?"default":"outline",onClick:()=>d(s),className:"h-8 px-3",children:s},s)})})}),e.jsx(N,{title:"Inkluder slettede brukere",right:e.jsx(q,{checked:l,onCheckedChange:a})}),e.jsx(N,{title:"Søk",description:"",children:e.jsx(S,{children:e.jsx(w,{id:"brukersok",value:r,onChange:s=>c(s.target.value),placeholder:"Søk på e-post eller visningsnavn…",inputMode:"search",className:"bg-background"})})})]})}),e.jsx("div",{className:"mt-4",children:m?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Laster brukere…"}):t.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ingen brukere funnet."}):e.jsx($,{type:"single",collapsible:!0,className:"rounded-md border bg-background",children:t.map(s=>{const o=te(s.epost),f=s.roller?.[0]??"Medlem",x=s.id!==j&&!o;return e.jsxs(T,{value:s.id,className:`px-4 ${o?"opacity-60":""}`,children:[e.jsx(z,{className:"hover:no-underline",children:e.jsxs("div",{className:"flex flex-col items-start gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.epost??"Ukjent bruker"}),o&&e.jsx(O,{variant:"outline",className:"text-xs",children:"Slettet"})]}),s.visningsnavn&&e.jsx("span",{className:"text-xs text-muted-foreground",children:s.visningsnavn})]})}),e.jsx(W,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"E-post"}),e.jsx("div",{className:"text-sm",children:s.epost??"Ukjent"})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Visningsnavn"}),e.jsx("div",{className:"text-sm",children:s.visningsnavn||e.jsx("span",{className:"text-muted-foreground italic",children:"Ikke satt"})})]})]}),e.jsxs("div",{className:"flex items-start gap-2 sm:col-span-2",children:[e.jsx(G,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Rolle"}),e.jsx("div",{className:"text-sm",children:f})]})]})]}),x&&e.jsx("div",{className:"flex justify-end pt-2 border-t",children:e.jsx(v,{type:"button",size:"sm",variant:"outline",onClick:p=>{p.stopPropagation(),h(s)},children:"Rediger"})})]})})]},s.id)})})})]})})}function ie({aktivBruker:r,edit:c,onEditChange:l,onClose:a,onSave:u,isSaving:d}){return e.jsx(J,{open:!0,onOpenChange:t=>{t||a()},children:e.jsxs(X,{children:[e.jsx(Y,{children:e.jsx(Z,{children:"Rediger bruker"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Bruker"}),e.jsx("div",{className:"text-sm font-medium break-words",children:r.epost})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Visningsnavn"}),e.jsx(S,{children:e.jsx(w,{id:"visningsnavn",value:c.visningsnavn,onChange:t=>l({visningsnavn:t.target.value}),placeholder:"Valgfritt",className:"bg-background"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Rolle"}),e.jsxs("select",{className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:c.rolle,onChange:t=>l({rolle:t.target.value}),children:[e.jsx("option",{value:"Medlem",children:"Medlem"}),e.jsx("option",{value:"Utvidet",children:"Utvidet"}),e.jsx("option",{value:"KlubbAdmin",children:"KlubbAdmin"})]})]})]}),e.jsxs(ee,{children:[e.jsx(v,{variant:"ghost",onClick:a,disabled:d,children:"Avbryt"}),e.jsx(v,{onClick:u,disabled:d,children:d?"Lagrer...":"Lagre"})]})]})})}function ae(r){return r?r.toLowerCase().startsWith("slettet_"):!1}function le(){const{bruker:r,laster:c}=I(),{brukere:l,laster:a,oppdater:u,oppdaterLaster:d}=se(),t=r?.roller.includes("KlubbAdmin"),[m,j]=g.useState(""),[h,s]=g.useState(!1),[o,f]=g.useState([]),[x,p]=g.useState(null),[k,y]=g.useState({rolle:"Medlem",visningsnavn:""}),B=g.useMemo(()=>{const n=m.toLowerCase().trim();return l.filter(i=>!(!h&&ae(i.epost))).filter(i=>{if(o.length===0)return!0;const b=i.roller?.[0]??"Medlem";return o.includes(b)}).filter(i=>n?i.epost?.toLowerCase().includes(n)||i.visningsnavn?.toLowerCase().includes(n):!0)},[l,m,h,o]),L=n=>{p(n),y({rolle:n.roller?.[0]??"Medlem"??"Medlem",visningsnavn:n.visningsnavn??""})},R=async()=>{x&&(await u(x.id,{rolle:k.rolle,visningsnavn:k.visningsnavn}),p(null))};function A(n){f(i=>i.includes(n)?i.filter(b=>b!==n):[...i,n])}return c?e.jsx(U,{}):t?e.jsxs(e.Fragment,{children:[e.jsx(ne,{query:m,onQueryChange:j,visSlettede:h,onVisSlettedeChange:s,rolleFilter:o,onToggleRolle:A,filtrerteBrukere:B,lasterListe:a,currentBrukerId:r?.id,onRedigerBruker:L}),x?e.jsx(ie,{aktivBruker:x,edit:k,onEditChange:n=>y(i=>({...i,...n})),onClose:()=>p(null),onSave:R,isSaving:d}):null]}):e.jsx("p",{className:"text-sm text-destructive px-2 py-2 text-center",children:"Du har ikke tilgang til denne siden."})}function ve(){return e.jsx(M,{children:e.jsx(le,{})})}export{ve as default};
