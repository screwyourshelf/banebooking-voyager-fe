import{r as g,j as t}from"./shadcn-DDUjAgUv.js";import{C as T,f as N,D as w}from"./checkbox-BgdOjGhd.js";import{F as D,B as p,a as E,b as C,c as $,L as B,u as A,d as F,e as y,t as v,f as L,g as M}from"./index-VZYxSd3S.js";import{u as I}from"./useBaner-BQYDmqYn.js";import{s as P,a as K,o as z,h as _}from"./booking-ChEu_yS9.js";import{u as S}from"./useSlug-DipqLcgr.js";import{P as Q}from"./Page-Cq3gZojq.js";import{S as V}from"./SimpleTabsLazy-2FTM8ipJ.js";import{D as q,a as O,b as H,c as R,d as W,e as J}from"./dialog-D6-YYeFR.js";import{a as Y}from"./lucide-Bc72fHhV.js";import"./react-RGnvvjkK.js";import"./index-XHTm-vMi.js";import"./index-CZuuFr9-.js";function G(){const[e,s]=g.useState(!1);return{erBekreftet:e,setErBekreftet:s,reset:()=>s(!1)}}function U({slot:e,isOpen:s,erInteraktiv:i,currentUser:r}){const o=`${e.startTid.slice(0,2)}-${e.sluttTid.slice(0,2)}`,a=!!e.arrangementTittel,[d,l]=g.useState(!1);g.useEffect(()=>{const u=()=>l(window.innerWidth<640);return u(),window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]);const c=40,m=e.arrangementBeskrivelse&&d&&e.arrangementBeskrivelse.length>c?e.arrangementBeskrivelse.slice(0,c)+"...":e.arrangementBeskrivelse;return t.jsx("div",{className:"flex items-center",children:t.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[t.jsx("div",{className:"whitespace-nowrap font-semibold text-sm text-right pr-1",children:o}),t.jsx("div",{className:"w-[18px] h-[18px] flex items-center justify-center",children:e.værSymbol?t.jsx("img",{src:`/banebooking-voyager-fe/weather-symbols/svg/${e.værSymbol}.svg`,alt:e.værSymbol,width:18,height:18,className:"select-none",draggable:!1}):t.jsx("span",{className:"invisible"})}),t.jsx("div",{className:"flex-grow text-sm p-1",children:a?t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.arrangementTittel}),m&&t.jsx("div",{className:"text-xs text-gray-600",children:m})]}):t.jsx("div",{children:e.booketAv?r?e.booketAv:X(e.booketAv):"Ledig"})}),i&&t.jsx("div",{className:"p-1",children:t.jsx(D,{size:12,style:{transform:s?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},"aria-hidden":"true"})})]})})}function X(e){const[s,i]=e.split("@");return!s||!i?e:`${s[0]}***@${i}`}function Z({slot:e,onBook:s=()=>{},onCancel:i=()=>{},onDelete:r=()=>{},time:o,erBekreftet:a,setErBekreftet:d,reset:l=()=>{}}){return t.jsxs("div",{className:"flex flex-col items-end w-full",children:[e.kanBookes&&a!==void 0&&d&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center space-x-1 mb-2 text-sm",children:[t.jsx(T,{id:`book-${o}`,checked:a,onCheckedChange:c=>d(!!c)}),t.jsxs("label",{htmlFor:`book-${o}`,className:"cursor-pointer select-none",children:["Jeg (og de jeg spiller sammen med) har betalt medlemskap for ",new Date().getFullYear()]})]}),t.jsxs(p,{variant:"outline",size:"sm",disabled:!a,onClick:()=>{s(e),l()},className:"flex items-center gap-2 text-sm",children:[t.jsx(E,{}),"Book"]})]}),e.kanAvbestille&&t.jsxs(p,{variant:"outline",size:"sm",onClick:()=>{i(e),l()},className:"flex items-center gap-2 text-sm",children:[t.jsx(C,{}),"Avbestill"]}),e.kanSlette&&t.jsxs(p,{variant:"destructive",size:"sm",onClick:()=>{r(e),l()},className:"flex items-center gap-2 text-sm",children:[t.jsx($,{}),"Slett"]})]})}function ee({slot:e,time:s,erBekreftet:i,setErBekreftet:r,onBook:o,onCancel:a,onDelete:d,reset:l}){return t.jsx("div",{className:"mt-1",children:t.jsx("div",{className:"bg-inherit",children:t.jsx(Z,{slot:e,time:s,erBekreftet:i,setErBekreftet:r,onBook:o,onCancel:a,onDelete:d,reset:l})})})}function te({slot:e,currentUser:s,isOpen:i=!1,onToggle:r,onBook:o=()=>{},onCancel:a=()=>{},onDelete:d=()=>{}}){const{erBekreftet:l,setErBekreftet:c,reset:m}=G(),u=`${e.startTid.slice(0,2)}-${e.sluttTid.slice(0,2)}`,x=e.kanBookes||e.kanAvbestille||e.kanSlette,f=!!s&&x&&!e.erPassert,h=!!e.arrangementTittel,n=e.erEier===!0,b=["border rounded shadow-sm p-2 mb-2","transition-colors duration-300 ease-in-out",e.erPassert?"bg-gray-100 text-gray-400":"",!e.erPassert&&h?"bg-gradient-to-r from-blue-0 via-blue-50 to-blue-200 border-blue-200":"",!e.erPassert&&!h?"bg-white text-gray-900":"",s&&n&&!h?"animate__animated animate__headShake animate__slow":""].join(" "),k=()=>{f&&r&&(r(),c(!1))};return t.jsxs("div",{className:b,style:{cursor:f?"pointer":"default",opacity:e.erPassert?.5:1},onClick:j=>{j.target.closest("button, input, label")||k()},role:f?"button":void 0,tabIndex:f?0:void 0,onKeyDown:j=>{(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),k())},children:[t.jsx(U,{slot:e,isOpen:i,erInteraktiv:f,currentUser:s}),i&&!e.erPassert&&t.jsx(ee,{slot:e,time:u,erBekreftet:l,setErBekreftet:c,onBook:o,onCancel:a,onDelete:d,reset:m})]})}function se({slots:e,currentUser:s,onBook:i,onCancel:r,onDelete:o,apenSlotTid:a,setApenSlotTid:d,isLoading:l=!1}){return l?t.jsx(B,{}):e.length===0?t.jsx("div",{className:"text-muted text-sm italic py-4 text-center",children:"Ingen bookinger eller slots � vise."}):t.jsx("div",{className:"space-y-2",children:e.map(c=>{const m=`${c.dato}-${c.startTid}-${c.baneId}`;return t.jsx(te,{slot:c,currentUser:s,onBook:i,onCancel:r,onDelete:o,isOpen:a===m,onToggle:()=>d?.(a===m?null:m)},m)})})}function ne(e,s,i){const r=A(),[o,a]=g.useState(null),d=["bookinger",e??"",i??"",s??""],{data:l=[],isLoading:c,refetch:m}=F({queryKey:d,queryFn:()=>_(e,i,s),enabled:!!e&&!!i&&!!s,refetchInterval:6e4,staleTime:6e4,refetchOnWindowFocus:!1,onError:n=>v.error(n.message??"Kunne ikke hente bookinger")}),u=()=>{r.invalidateQueries({queryKey:d}),r.invalidateQueries({queryKey:["mineBookinger",e]})},x=y({mutationFn:n=>z(e,i,s,n.startTid,n.sluttTid),onSuccess:(n,b)=>{const k=`${b.startTid.slice(0,2)}-${b.sluttTid.slice(0,2)}`;v.success(`Booket ${k}`),u()},onError:n=>v.error(n instanceof Error?n.message:"Kunne ikke booke.")}),f=y({mutationFn:n=>K(e,i,s,n.startTid,n.sluttTid),onSuccess:()=>{v.info("Bookingen er avbestilt."),u()},onError:n=>v.error(n instanceof Error?n.message:"Kunne ikke avbestille.")}),h=y({mutationFn:n=>P(e,n.baneId,n.dato,n.startTid,n.sluttTid),onSuccess:()=>{v.success("Booking slettet"),a(null),u()},onError:n=>v.error(n instanceof Error?n.message:"Kunne ikke slette booking.")});return{slots:l,isLoading:c,apenSlotTid:o,setApenSlotTid:a,onBook:x.mutate,onCancel:f.mutate,onDelete:h.mutate,hentBookinger:m}}function ie({children:e}){const s=S(),{data:i,isLoading:r}=L(s);if(r||!i)return null;const{bookingRegel:o}=i;return t.jsxs(q,{children:[t.jsx(O,{asChild:!0,children:e}),t.jsxs(H,{children:[t.jsxs(R,{children:[t.jsx(W,{children:"Bookingregler"}),t.jsx(J,{className:"sr-only",children:"Oversikt over bookingreglene i klubben"})]}),t.jsx("div",{className:"space-y-4",children:t.jsxs("ul",{className:"list-disc list-inside text-sm",children:[t.jsxs("li",{children:["Maks ",o.maksPerDag," bookinger per dag"]}),t.jsxs("li",{children:["Maks ",o.maksTotalt," aktive bookinger totalt"]}),t.jsxs("li",{children:["Opptil ",o.dagerFremITid," dager frem i tid"]}),t.jsxs("li",{children:[o.slotLengdeMinutter," minutter per booking"]}),t.jsxs("li",{children:["Tillatt mellom ",o.aapningstid,"–",o.stengetid]})]})})]})]})}function be(){const e=S(),{baner:s,isLoading:i}=I(e,!1),[r,o]=g.useState(""),[a,d]=g.useState(new Date),{currentUser:l}=M(),c=g.useMemo(()=>a?N(a,"yyyy-MM-dd"):"",[a]),{slots:m,apenSlotTid:u,setApenSlotTid:x,onBook:f,onCancel:h,onDelete:n,isLoading:b}=ne(e,c,r);return g.useEffect(()=>{!r&&s.length>0&&o(s[0].id)},[s,r]),g.useEffect(()=>{x(null)},[a,r,x]),g.useEffect(()=>{l||x(null)},[l,x]),g.useEffect(()=>{a&&localStorage.setItem("valgtDato",a.toISOString())},[a]),i||!r?t.jsx(B,{}):t.jsxs(Q,{children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx(ie,{children:t.jsx(p,{variant:"ghost",size:"icon",className:"rounded-full",title:"Vis banereglement",children:t.jsx(Y,{className:"w-5 h-5"})})}),t.jsx(w,{value:a,onChange:k=>d(k??null),visNavigering:!0})]}),t.jsx(V,{items:s.map(k=>({value:k.id,label:k.navn,content:t.jsx(se,{slots:m,currentUser:l?{epost:l.email??""}:null,apenSlotTid:u,setApenSlotTid:x,onBook:f,onCancel:h,onDelete:n,isLoading:b})})),value:r,onValueChange:o})]})}export{be as default};
