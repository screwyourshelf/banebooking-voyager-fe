import{r as n,j as e}from"./shadcn-BfUXmlP3.js";import{u as ie,g as N,h as re,T as de,a as oe,b as V,c as p,d as ce,e as j,f as ge,i as ue,j as he,k as xe,t as E}from"./datoUtils-sZSPEnO_.js";import{T as me,a as pe,b as z,c as O}from"./useBaner-Ol6D5kQa.js";import{d as je,L as fe,I as ve,B as f,t as c}from"./index-fLnmLxwB.js";import{D as P,C as S}from"./checkbox-CRQuVlHV.js";import{L as d}from"./label-BjBqwgl-.js";import{C as $,a as H}from"./card-CgPzx-qu.js";import"./react-D5d5vywP.js";import"./lucide-CZTSiasK.js";import"./index-36j8ZHWB.js";function Ie(){const{slug:R}=je(),{baner:g,tilgjengeligeTidspunkter:v,forhandsvisning:o,setForhandsvisning:M,forhandsvis:q,opprett:G,isLoading:y}=ie(R),[u,B]=n.useState([]),[k,I]=n.useState([]),[T,U]=n.useState([]),[i,J]=n.useState(new Date),[r,Q]=n.useState(new Date),[h,W]=n.useState(!1),[x,X]=n.useState(!1),[m,Y]=n.useState(!1),[b,Z]=n.useState("Annet"),[C,_]=n.useState(""),[ee,A]=n.useState("oppsett"),se=()=>M({ledige:[],konflikter:[]}),D=n.useMemo(()=>{if(!i||!r)return N;const s=new Set,a=new Date(i),l=new Date(r);for(let t=new Date(a);t<=l;t.setDate(t.getDate()+1)){const ne=t.getDay(),le=ue[ne],L=re[le];L&&s.add(L)}return N.filter(t=>s.has(t))},[i,r]);n.useEffect(()=>{h&&B(g.map(s=>s.id)),x&&I(D),m&&U(v)},[h,x,m,g,D,v]);const w=(s,a)=>{a(l=>l.includes(s)?l.filter(t=>t!==s):[...l,s])};function F(){if(!i||!r)return c.warning("Du må velge start- og sluttdato"),null;if(u.length===0)return c.warning("Du må velge minst én bane"),null;if(T.length===0)return c.warning("Du må velge minst ett tidspunkt"),null;if(k.length===0)return c.warning("Du må velge minst én ukedag"),null;const s=he(i,r),a=k.map(l=>xe[l]).filter(l=>s.has(l));return a.length===0?(c.warning("Ingen av de valgte ukedagene finnes i datointervallet"),null):{tittel:b,beskrivelse:C,kategori:b,startDato:E(i),sluttDato:E(r),ukedager:a,tidspunkter:T,baneIder:u}}const ae=async()=>{const s=F();s&&(await G(s),se(),A("oppsett"))},te=async s=>{if(A(s),s==="forhandsvisning"){const a=F();a&&await q(a)}},K=[...o.ledige,...o.konflikter].sort((s,a)=>s.dato.localeCompare(a.dato)||s.startTid.localeCompare(a.startTid)||s.baneId.localeCompare(a.baneId));return e.jsx("div",{className:"max-w-screen-md mx-auto px-1 py-1",children:y?e.jsx(fe,{}):e.jsxs(me,{value:ee,onValueChange:te,children:[e.jsxs(pe,{className:"mb-4",children:[e.jsx(z,{value:"oppsett",children:"Oppsett"}),e.jsxs(z,{value:"forhandsvisning",disabled:u.length===0,children:["Forhåndsvisning (",o.ledige.length,")"]})]}),e.jsx(O,{value:"oppsett",children:e.jsx($,{children:e.jsxs(H,{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsx(d,{children:"Kategori"}),e.jsx("select",{className:"w-full border rounded text-sm px-3 py-2 mt-1",value:b,onChange:s=>Z(s.target.value),children:["Trening","Turnering","Klubbmersterskap","Kurs","Lagkamp","Stigespill","Dugnad","Vedlikehold","Sosialt","Annet"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Beskrivelse"}),e.jsx(ve,{type:"text",className:"w-full text-sm mt-1",value:C,onChange:s=>_(s.target.value)})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Fra"}),e.jsx(P,{value:i,onChange:J,visNavigering:!0})]}),e.jsxs("div",{children:[e.jsx(d,{children:"Til"}),e.jsx(P,{value:r,onChange:Q,visNavigering:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{id:"alleBaner",checked:h,onCheckedChange:s=>W(!!s)}),e.jsx(d,{htmlFor:"alleBaner",children:"Alle baner"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:g.map(s=>e.jsx(f,{variant:u.includes(s.id)?"default":"outline",size:"sm",onClick:()=>w(s.id,B),disabled:h,children:s.navn},s.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{id:"alleUkedager",checked:x,onCheckedChange:s=>X(!!s)}),e.jsx(d,{htmlFor:"alleUkedager",children:"Alle gyldige dager"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:N.map(s=>e.jsx(f,{variant:k.includes(s)?"default":"outline",size:"sm",onClick:a=>{a.preventDefault(),w(s,I)},disabled:x||!D.includes(s),children:s},s))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{id:"alleTidspunkter",checked:m,onCheckedChange:s=>Y(!!s)}),e.jsx(d,{htmlFor:"alleTidspunkter",children:"Alle tidspunkter"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:v.map(s=>e.jsx(f,{variant:T.includes(s)?"default":"outline",size:"sm",onClick:()=>w(s,U),disabled:m,children:s},s))})]})]})})}),e.jsx(O,{value:"forhandsvisning",children:e.jsx($,{children:e.jsx(H,{className:"p-4 space-y-4",children:K.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ingen bookinger tilgjengelig."}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-auto max-h-[60vh] border rounded-md",children:e.jsxs(de,{className:"text-sm",children:[e.jsx(oe,{children:e.jsxs(V,{children:[e.jsx(p,{children:"Dato"}),e.jsx(p,{children:"Klokkeslett"}),e.jsx(p,{children:"Bane"}),e.jsx(p,{children:"Beskrivelse"})]})}),e.jsx(ce,{children:K.map(s=>{const a=g.find(t=>t.id===s.baneId),l=o.konflikter.some(t=>t.baneId===s.baneId&&t.dato===s.dato&&t.startTid===s.startTid&&t.sluttTid===s.sluttTid);return e.jsxs(V,{className:l?"bg-yellow-100":"",children:[e.jsx(j,{children:ge(s.dato)}),e.jsxs(j,{children:[s.startTid," – ",s.sluttTid]}),e.jsx(j,{children:(a==null?void 0:a.navn)??"(ukjent bane)"}),e.jsxs(j,{children:[C,l&&e.jsx("span",{className:"ml-2 text-yellow-700 text-xs italic",children:"(Konflikt)"})]})]},`${s.dato}-${s.baneId}-${s.startTid}`)})})]})}),e.jsx("div",{className:"flex justify-end mt-3",children:e.jsxs(f,{type:"button",onClick:ae,disabled:y,children:["Opprett ",o.ledige.length," bookinger"]})})]})})})})]})})}export{Ie as default};
