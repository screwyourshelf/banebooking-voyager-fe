import{j as a,r as n}from"./shadcn-mOdBhBu9.js";import{u as w,e as se,f as te,d as ne,a as le,b as re,t as O}from"./datoUtils-CMdMNzgI.js";import{u as ie,T as de,a as oe,b as V,c as f,d as ce,e as p}from"./table-CpEHq269.js";import{k as z,F as ge,B as g,t as u}from"./index-D3zhjIn3.js";import{C as S}from"./checkbox-XSJmX2C7.js";import{D as E}from"./DatoVelger-CP9_qejY.js";import{L as ue}from"./LoaderSkeleton-C1mMO82w.js";import{S as me}from"./SelectField-BZEwwzdJ.js";import{D as xe,b as he,c as fe,d as pe,f as ke}from"./dialog-DOfRA9v0.js";import"./react-RGnvvjkK.js";import"./useBaner-C8upZoVo.js";import"./lucide-ByENZzyU.js";import"./index-Bb2dXpgu.js";import"./index-BRMy6Ggk.js";function je({className:r,...i}){return a.jsx("div",{"data-slot":"card",className:z("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",r),...i})}function ve({className:r,...i}){return a.jsx("div",{"data-slot":"card-content",className:z("px-6",r),...i})}function Le(){const{baner:r,tilgjengeligeTidspunkter:i,forhandsvisning:c,forhandsvis:H,clearForhandsvisning:F,opprett:$,isLoading:M,isLoadingForhandsvisning:y}=ie(),[k,B]=n.useState([]),[j,U]=n.useState([]),[v,I]=n.useState([]),[d,P]=n.useState(new Date),[o,R]=n.useState(new Date),[m,q]=n.useState(!1),[x,G]=n.useState(!1),[h,J]=n.useState(!1),[b,Q]=n.useState("Annet"),[D,W]=n.useState(""),[X,T]=n.useState(!1),N=n.useMemo(()=>{if(!d||!o)return w;const e=new Set,t=new Date(d),l=new Date(o);for(let s=new Date(t);s<=l;s.setDate(s.getDate()+1)){const ee=s.getDay(),ae=ne[ee],L=se[ae];L&&e.add(L)}return w.filter(s=>e.has(s))},[d,o]);n.useEffect(()=>{m&&B(r.map(e=>e.id)),x&&U(N),h&&I(i)},[m,x,h,r,N,i]);const C=(e,t)=>{t(l=>l.includes(e)?l.filter(s=>s!==e):[...l,e])};function A(){if(!d||!o)return u.warning("Du må velge start- og sluttdato"),null;if(k.length===0)return u.warning("Du må velge minst én bane"),null;if(v.length===0)return u.warning("Du må velge minst ett tidspunkt"),null;if(j.length===0)return u.warning("Du må velge minst én ukedag"),null;const e=le(d,o),t=j.map(l=>re[l]).filter(l=>e.has(l));return t.length===0?(u.warning("Ingen av de valgte ukedagene finnes i datointervallet"),null):{tittel:b,beskrivelse:D,kategori:b,startDato:O(d),sluttDato:O(o),ukedager:t,tidspunkter:v,baneIder:k}}const K=n.useMemo(()=>[...c.ledige,...c.konflikter].sort((e,t)=>e.dato.localeCompare(t.dato)||e.startTid.localeCompare(t.startTid)||e.baneId.localeCompare(t.baneId)),[c]),Y=K.length>0,Z=async()=>{const e=A();e&&(await $(e),F(),T(!1))},_=async()=>{const e=A();e&&(T(!0),await H(e))};return M?a.jsx(ue,{}):a.jsxs("div",{className:"max-w-screen-md mx-auto px-1 py-1",children:[a.jsx(je,{children:a.jsxs(ve,{className:"p-4 space-y-4",children:[a.jsx(me,{id:"kategori",label:"Kategori",value:b,onChange:e=>Q(e),options:["Trening","Turnering","Klubbmersterskap","Kurs","Lagkamp","Stigespill","Dugnad","Vedlikehold","Sosialt","Annet"].map(e=>({label:e,value:e}))}),a.jsx(ge,{id:"beskrivelse",label:"Beskrivelse",value:D,onChange:e=>W(e.target.value)}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Fra"}),a.jsx(E,{value:d,onChange:P,visNavigering:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Til"}),a.jsx(E,{value:o,onChange:R,visNavigering:!0})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(S,{id:"alleBaner",checked:m,onCheckedChange:e=>q(!!e)}),a.jsx("label",{htmlFor:"alleBaner",className:"text-sm",children:"Alle baner"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:r.map(e=>a.jsx(g,{variant:k.includes(e.id)?"default":"outline",size:"sm",onClick:()=>C(e.id,B),disabled:m,children:e.navn},e.id))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(S,{id:"alleUkedager",checked:x,onCheckedChange:e=>G(!!e)}),a.jsx("label",{htmlFor:"alleUkedager",className:"text-sm",children:"Alle gyldige dager"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:w.map(e=>a.jsx(g,{variant:j.includes(e)?"default":"outline",size:"sm",onClick:t=>{t.preventDefault(),C(e,U)},disabled:x||!N.includes(e),children:e},e))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(S,{id:"alleTidspunkter",checked:h,onCheckedChange:e=>J(!!e)}),a.jsx("label",{htmlFor:"alleTidspunkter",className:"text-sm",children:"Alle tidspunkter"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:i.map(e=>a.jsx(g,{variant:v.includes(e)?"default":"outline",size:"sm",onClick:()=>C(e,I),disabled:h,children:e},e))})]}),a.jsx("div",{className:"flex justify-end pt-4",children:a.jsx(g,{type:"button",onClick:_,children:"Forhåndsvis bookinger"})})]})}),a.jsx(xe,{open:X,onOpenChange:e=>{T(e),e||F()},children:a.jsxs(he,{className:"max-w-3xl",children:[a.jsx(fe,{children:a.jsx(pe,{children:"Forhåndsvis bookingene"})}),y?a.jsx("p",{className:"text-muted-foreground italic",children:"Laster forhåndsvisning…"}):Y?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"overflow-auto max-h-[60vh] border rounded-md",children:a.jsxs(de,{className:"text-sm",children:[a.jsx(oe,{children:a.jsxs(V,{children:[a.jsx(f,{children:"Dato"}),a.jsx(f,{children:"Klokkeslett"}),a.jsx(f,{children:"Bane"}),a.jsx(f,{children:"Beskrivelse"})]})}),a.jsx(ce,{children:K.map(e=>{const t=r.find(s=>s.id===e.baneId),l=c.konflikter.some(s=>s.baneId===e.baneId&&s.dato===e.dato&&s.startTid===e.startTid&&s.sluttTid===e.sluttTid);return a.jsxs(V,{className:l?"bg-yellow-100":"",children:[a.jsx(p,{children:te(e.dato)}),a.jsxs(p,{children:[e.startTid," – ",e.sluttTid]}),a.jsx(p,{children:t?.navn??"(ukjent bane)"}),a.jsxs(p,{children:[D,l&&a.jsx("span",{className:"ml-2 text-yellow-700 text-xs italic",children:"(Konflikt)"})]})]},`${e.dato}-${e.baneId}-${e.startTid}`)})})]})}),a.jsx(ke,{className:"mt-3",children:a.jsxs(g,{type:"button",onClick:Z,disabled:y,children:["Opprett ",c.ledige.length," bookinger"]})})]}):a.jsx("p",{className:"text-muted-foreground italic",children:"Ingen bookinger å vise."})]})})]})}export{Le as default};
