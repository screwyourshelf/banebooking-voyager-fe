import{r as a,j as e}from"./shadcn-mOdBhBu9.js";import{u as E,a as q,b as Q,t as S,k as F,n as U,L as V,B as d,j as z}from"./index-DACapAhf.js";import{S as I}from"./SettingsSection-DfNPesyK.js";import{a as C,S as v}from"./SettingsRow-SsVQpD69.js";import{S as L}from"./SettingsInput-vO4hYVrx.js";import{S as P}from"./switch-CqkRJ2Qn.js";import{D as $,b as O,c as T,d as H,f as W}from"./dialog-B_iTf-mM.js";import"./react-RGnvvjkK.js";import"./lucide-ByENZzyU.js";import"./index-Bb2dXpgu.js";import"./index-BRMy6Ggk.js";function _(s){const u=E(),c=["admin-brukere",s],l=q(c,`/klubb/${s}/bruker/admin/bruker`,{enabled:!!s,requireAuth:!0,staleTime:3e4}),m=Q("put",({brukerId:n})=>`/klubb/${s}/bruker/admin/bruker/${n}`,{onSuccess:async()=>{S.success("Bruker oppdatert"),await u.invalidateQueries({queryKey:c})},onError:n=>S.error(n.message??"Kunne ikke oppdatere bruker"),retry:!1}),k=async(n,p)=>{s&&await m.mutateAsync({brukerId:n,rolle:p.rolle,visningsnavn:p.visningsnavn})};return{brukere:l.data??[],laster:l.isLoading,oppdaterLaster:m.isPending,oppdater:k,hentBrukere:l.refetch,error:l.error?.message??null}}const G=["Medlem","Utvidet","KlubbAdmin"];function B(s){return s?s.toLowerCase().startsWith("slettet_"):!1}function ae(){const{slug:s}=F(),{bruker:u,laster:c}=U(s),{brukere:l,laster:m,oppdater:k,oppdaterLaster:n}=_(s),p=u?.roller.includes("KlubbAdmin"),[f,M]=a.useState(""),[j,w]=a.useState(!1),[o,y]=a.useState([]),[x,g]=a.useState(null),[h,b]=a.useState({rolle:"Medlem",visningsnavn:""}),N=a.useMemo(()=>{const t=f.toLowerCase().trim();return l.filter(r=>!(!j&&B(r.epost))).filter(r=>{if(o.length===0)return!0;const i=r.roller?.[0]??"Medlem";return o.includes(i)}).filter(r=>t?r.epost?.toLowerCase().includes(t)||r.visningsnavn?.toLowerCase().includes(t):!0)},[l,f,j,o]),A=t=>{g(t),b({rolle:t.roller?.[0]??"Medlem"??"Medlem",visningsnavn:t.visningsnavn??""})},R=async()=>{!s||!x||(await k(x.id,{rolle:h.rolle,visningsnavn:h.visningsnavn}),g(null))};function K(t){y(r=>r.includes(t)?r.filter(i=>i!==t):[...r,t])}return c?e.jsx(V,{}):p?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(I,{title:"Brukere",description:"Søk etter brukere og endre rolle eller visningsnavn.",children:[e.jsxs(C,{children:[e.jsxs(v,{title:"Filter på rolle",description:"",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:G.map(t=>{const r=o.includes(t);return e.jsx(d,{type:"button",size:"sm",variant:r?"default":"outline",onClick:()=>K(t),className:"h-8 px-3",children:t},t)})}),o.length>0?e.jsx("div",{className:"mt-2",children:e.jsx(d,{type:"button",size:"sm",variant:"ghost",onClick:()=>y([]),className:"h-8 px-2 text-muted-foreground",children:"Nullstill filter"})}):null]}),e.jsx(v,{title:"Vis slettede brukere",description:"Inkluder brukere som er anonymisert eller slettet.",right:e.jsx("div",{className:"pt-0.5",children:e.jsx(P,{checked:j,onCheckedChange:w})})}),e.jsx(v,{title:"Søk",description:"",children:e.jsx(L,{value:f,onChange:M,placeholder:"Søk på e-post eller visningsnavn…",inputMode:"search",className:"bg-background"})})]}),e.jsx("div",{className:"mt-4",children:m?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Laster brukere…"}):N.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ingen brukere funnet."}):e.jsx(C,{children:N.map(t=>{const r=t.id===u?.id,i=B(t.epost),D=t.roller?.[0]??"Medlem";return e.jsx(v,{title:t.epost??"Ukjent bruker",description:t.visningsnavn||(i?"Slettet/anonymisert":""),right:!r&&!i?e.jsx(d,{type:"button",size:"sm",variant:"outline",onClick:()=>A(t),children:"Rediger"}):null,className:z(i&&"opacity-70"),children:e.jsxs("div",{className:"text-sm text-foreground",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rolle: "}),D,i?e.jsx("span",{className:"text-muted-foreground",children:" (slettet)"}):null]})},t.id)})})})]}),x?e.jsx($,{open:!0,onOpenChange:t=>{t||g(null)},children:e.jsxs(O,{children:[e.jsx(T,{children:e.jsx(H,{children:"Rediger bruker"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Bruker"}),e.jsx("div",{className:"text-sm font-medium break-words",children:x.epost})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Visningsnavn"}),e.jsx(L,{value:h.visningsnavn,onChange:t=>b(r=>({...r,visningsnavn:t})),placeholder:"Valgfritt",className:"bg-background"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Rolle"}),e.jsxs("select",{className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:h.rolle,onChange:t=>b(r=>({...r,rolle:t.target.value})),children:[e.jsx("option",{value:"Medlem",children:"Medlem"}),e.jsx("option",{value:"Utvidet",children:"Utvidet"}),e.jsx("option",{value:"KlubbAdmin",children:"KlubbAdmin"})]})]})]}),e.jsxs(W,{children:[e.jsx(d,{variant:"ghost",onClick:()=>g(null),disabled:n,children:"Avbryt"}),e.jsx(d,{onClick:R,disabled:n,children:n?"Lagrer...":"Lagre"})]})]})}):null]}):e.jsx("p",{className:"text-sm text-destructive px-2 py-2 text-center",children:"Du har ikke tilgang til denne siden."})}export{ae as default};
