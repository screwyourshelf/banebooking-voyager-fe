import{r as n,j as a}from"./shadcn-DPSgmxN6.js";import{u as w,e as se,f as te,a as ne,d as le,t as V,b as ie}from"./datoUtils-Bzity_GL.js";import{u as re}from"./useArrangement-BchSfZRi.js";import{T as de,a as oe,b as O,c as h,d as ce,e as f}from"./index-Ma-LHvo-.js";import{d as ge,L as me,B as d,t as o}from"./index-BYC8jElZ.js";import{D as E,C as S}from"./checkbox-Hs6Axo2B.js";import{C as ue,a as xe}from"./card-Bt8C29rJ.js";import{F as he}from"./FormField-rCnNSN9O.js";import{S as fe}from"./SelectField-BxiLzjVq.js";import{D as ke,a as pe,b as je,c as ve,d as be}from"./dialog-CbjTKi8R.js";import"./react-RGnvvjkK.js";import"./useBaner-eSVDoHg_.js";import"./lucide-Uxrg_z7G.js";import"./index-DUAXFcx0.js";import"./FieldWrapper-DqorA9eC.js";function Ee(){const{slug:L}=ge(),{baner:c,tilgjengeligeTidspunkter:k,forhandsvisning:g,setForhandsvisning:z,forhandsvis:H,opprett:P,isLoading:F}=re(L),[p,B]=n.useState([]),[j,y]=n.useState([]),[v,U]=n.useState([]),[i,$]=n.useState(new Date),[r,R]=n.useState(new Date),[m,M]=n.useState(!1),[u,q]=n.useState(!1),[x,G]=n.useState(!1),[b,J]=n.useState("Annet"),[D,Q]=n.useState(""),[W,T]=n.useState(!1),[X,Y]=n.useState(!1),Z=()=>z({ledige:[],konflikter:[]}),C=n.useMemo(()=>{if(!i||!r)return w;const e=new Set,t=new Date(i),l=new Date(r);for(let s=new Date(t);s<=l;s.setDate(s.getDate()+1)){const ee=s.getDay(),ae=ie[ee],K=se[ae];K&&e.add(K)}return w.filter(s=>e.has(s))},[i,r]);n.useEffect(()=>{m&&B(c.map(e=>e.id)),u&&y(C),x&&U(k)},[m,u,x,c,C,k]);const N=(e,t)=>{t(l=>l.includes(e)?l.filter(s=>s!==e):[...l,e])};function I(){if(!i||!r)return o.warning("Du må velge start- og sluttdato"),null;if(p.length===0)return o.warning("Du må velge minst én bane"),null;if(v.length===0)return o.warning("Du må velge minst ett tidspunkt"),null;if(j.length===0)return o.warning("Du må velge minst én ukedag"),null;const e=ne(i,r),t=j.map(l=>le[l]).filter(l=>e.has(l));return t.length===0?(o.warning("Ingen av de valgte ukedagene finnes i datointervallet"),null):{tittel:b,beskrivelse:D,kategori:b,startDato:V(i),sluttDato:V(r),ukedager:t,tidspunkter:v,baneIder:p}}const _=async()=>{const e=I();e&&(await P(e),Z(),T(!1))},A=[...g.ledige,...g.konflikter].sort((e,t)=>e.dato.localeCompare(t.dato)||e.startTid.localeCompare(t.startTid)||e.baneId.localeCompare(t.baneId));return a.jsx("div",{className:"max-w-screen-md mx-auto px-1 py-1",children:F?a.jsx(me,{}):a.jsxs(a.Fragment,{children:[a.jsx(ue,{children:a.jsxs(xe,{className:"p-4 space-y-4",children:[a.jsx(fe,{id:"kategori",label:"Kategori",value:b,onChange:e=>J(e),options:["Trening","Turnering","Klubbmersterskap","Kurs","Lagkamp","Stigespill","Dugnad","Vedlikehold","Sosialt","Annet"].map(e=>({label:e,value:e}))}),a.jsx(he,{id:"beskrivelse",label:"Beskrivelse",value:D,onChange:e=>Q(e.target.value)}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Fra"}),a.jsx(E,{value:i,onChange:$,visNavigering:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Til"}),a.jsx(E,{value:r,onChange:R,visNavigering:!0})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(S,{id:"alleBaner",checked:m,onCheckedChange:e=>M(!!e)}),a.jsx("label",{htmlFor:"alleBaner",className:"text-sm",children:"Alle baner"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:c.map(e=>a.jsx(d,{variant:p.includes(e.id)?"default":"outline",size:"sm",onClick:()=>N(e.id,B),disabled:m,children:e.navn},e.id))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(S,{id:"alleUkedager",checked:u,onCheckedChange:e=>q(!!e)}),a.jsx("label",{htmlFor:"alleUkedager",className:"text-sm",children:"Alle gyldige dager"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:w.map(e=>a.jsx(d,{variant:j.includes(e)?"default":"outline",size:"sm",onClick:t=>{t.preventDefault(),N(e,y)},disabled:u||!C.includes(e),children:e},e))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(S,{id:"alleTidspunkter",checked:x,onCheckedChange:e=>G(!!e)}),a.jsx("label",{htmlFor:"alleTidspunkter",className:"text-sm",children:"Alle tidspunkter"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:k.map(e=>a.jsx(d,{variant:v.includes(e)?"default":"outline",size:"sm",onClick:()=>N(e,U),disabled:x,children:e},e))})]}),a.jsx("div",{className:"flex justify-end pt-4",children:a.jsx(d,{type:"button",onClick:async()=>{const e=I();e&&(await H(e),Y(!0),T(!0))},children:"Forhåndsvis bookinger"})})]})}),a.jsx(ke,{open:W,onOpenChange:T,children:a.jsxs(pe,{className:"max-w-3xl",children:[a.jsx(je,{children:a.jsx(ve,{children:"Forhåndsvis bookingene"})}),X&&A.length>0?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"overflow-auto max-h-[60vh] border rounded-md",children:a.jsxs(de,{className:"text-sm",children:[a.jsx(oe,{children:a.jsxs(O,{children:[a.jsx(h,{children:"Dato"}),a.jsx(h,{children:"Klokkeslett"}),a.jsx(h,{children:"Bane"}),a.jsx(h,{children:"Beskrivelse"})]})}),a.jsx(ce,{children:A.map(e=>{const t=c.find(s=>s.id===e.baneId),l=g.konflikter.some(s=>s.baneId===e.baneId&&s.dato===e.dato&&s.startTid===e.startTid&&s.sluttTid===e.sluttTid);return a.jsxs(O,{className:l?"bg-yellow-100":"",children:[a.jsx(f,{children:te(e.dato)}),a.jsxs(f,{children:[e.startTid," – ",e.sluttTid]}),a.jsx(f,{children:t?.navn??"(ukjent bane)"}),a.jsxs(f,{children:[D,l&&a.jsx("span",{className:"ml-2 text-yellow-700 text-xs italic",children:"(Konflikt)"})]})]},`${e.dato}-${e.baneId}-${e.startTid}`)})})]})}),a.jsx(be,{className:"mt-3",children:a.jsxs(d,{type:"button",onClick:_,disabled:F,children:["Opprett ",g.ledige.length," bookinger"]})})]}):a.jsx("p",{className:"text-muted-foreground italic",children:"Ingen bookinger å vise."})]})})]})})}export{Ee as default};
