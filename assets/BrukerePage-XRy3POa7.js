import{r as t,j as e}from"./shadcn-DDUjAgUv.js";import{h as L,t as p,k as E,m as A,L as K,B as f,n as D}from"./index-C5bRu15K.js";import{C as F,a as M}from"./card-CKuPQcs1.js";import{F as y}from"./FormField-CSCBCces.js";import{S as H}from"./SelectField-Bnhwm0yA.js";import{D as P,b as U,c as V,d as $,f as q}from"./dialog-F4NMflR9.js";import{T as I,a as O,b as C,c as N,d as z,e as B}from"./table-Cf8nNQMp.js";import"./react-RGnvvjkK.js";import"./lucide-Bc72fHhV.js";import"./index-XHTm-vMi.js";import"./index-CZuuFr9-.js";async function G(s){const a=await L(`/api/klubb/${s}/bruker/admin/bruker`,{method:"GET"},!0);if(!a.ok){const n=await a.text();throw new Error(n||"Kunne ikke hente brukere")}return await a.json()}async function J(s,a,n){const o=await L(`/api/klubb/${s}/bruker/admin/bruker/${a}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},!0);if(!o.ok){const i=await o.text();throw new Error(i||"Kunne ikke oppdatere bruker")}}function Q(s){const[a,n]=t.useState([]),[o,i]=t.useState(!1),d=t.useCallback(async()=>{if(s){i(!0);try{const l=await G(s);n(l)}catch(l){p.error(l instanceof Error?l.message:"Kunne ikke hente brukere."),n([])}finally{i(!1)}}},[s]);t.useEffect(()=>{d()},[d]);const u=t.useCallback(async(l,m)=>{if(!s)return;const c=p.loading("Lagrer endringer...");try{await J(s,l,m),p.success("Bruker oppdatert",{id:c}),await d()}catch(x){p.error(x instanceof Error?x.message:"Kunne ikke oppdatere bruker",{id:c})}},[s,d]);return{brukere:a,laster:o,oppdater:u,hentBrukere:d}}function ie(){const{slug:s}=E(),{bruker:a,laster:n}=A(s),{brukere:o,laster:i,oppdater:d}=Q(s),[u,l]=t.useState(""),[m,c]=t.useState(null),[x,v]=t.useState("Medlem"),[j,b]=t.useState(""),[k,w]=t.useState(!1),R=a?.roller.includes("KlubbAdmin"),g=t.useMemo(()=>{const r=u.toLowerCase().trim();return o.filter(h=>h.epost?.toLowerCase().includes(r)||h.visningsnavn?.toLowerCase().includes(r))},[o,u]),S=r=>{c(r),v(r.roller[0]??"Medlem"),b(r.visningsnavn??"")},T=async()=>{if(!(!s||!m)){w(!0);try{await d(m.id,{rolle:x,visningsnavn:j}),c(null)}finally{w(!1)}}};return n?e.jsx(K,{}):R?e.jsxs("div",{className:"max-w-screen-sm mx-auto px-2 py-2 space-y-4",children:[e.jsx(F,{children:e.jsxs(M,{className:"p-4 space-y-4",children:[e.jsx(y,{id:"sok",label:"SÃ¸k etter bruker",value:u,onChange:r=>l(r.target.value),helpText:"F.eks. navn eller e-post"}),i&&e.jsx("p",{children:"Laster brukere..."}),!i&&g.length===0&&e.jsx("p",{className:"text-muted-foreground",children:"Ingen brukere funnet"}),!i&&g.length>0&&e.jsx("div",{className:"max-w-full overflow-x-auto border rounded-md",children:e.jsxs(I,{className:"text-sm w-full",children:[e.jsx(O,{children:e.jsxs(C,{children:[e.jsx(N,{className:"w-[140px]",children:"Bruker"}),e.jsx(N,{className:"w-2/6",children:"Rolle"})]})}),e.jsx(z,{children:g.map(r=>{const h=r.id===a?.id;return e.jsxs(C,{children:[e.jsx(B,{className:"whitespace-nowrap max-w-[180px]",children:e.jsxs("div",{className:"flex justify-between items-start gap-2 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx("div",{className:"font-medium truncate",title:r.epost,children:r.epost}),r.visningsnavn&&e.jsx("div",{className:"text-muted-foreground text-xs truncate",title:r.visningsnavn,children:r.visningsnavn})]}),!h&&e.jsxs(f,{variant:"ghost",size:"icon",onClick:()=>S(r),title:"Rediger",className:"text-muted-foreground hover:text-primary",children:[e.jsx(D,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Rediger"})]})]})}),e.jsx(B,{className:"whitespace-nowrap",children:r.roller[0]??"Medlem"})]},r.id)})})]})})]})}),m&&e.jsx(P,{open:!0,onOpenChange:()=>c(null),children:e.jsxs(U,{children:[e.jsx(V,{children:e.jsx($,{children:"Rediger bruker"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(y,{id:"visningsnavn",label:"Visningsnavn",value:j,onChange:r=>b(r.target.value)}),e.jsx(H,{id:"rolle",label:"Rolle",value:x,onChange:r=>v(r),options:[{label:"Medlem",value:"Medlem"},{label:"Utvidet",value:"Utvidet"},{label:"KlubbAdmin",value:"KlubbAdmin"}]})]}),e.jsxs(q,{children:[e.jsx(f,{variant:"ghost",onClick:()=>c(null),disabled:k,children:"Avbryt"}),e.jsx(f,{onClick:T,disabled:k,children:k?"Lagrer...":"Lagre"})]})]})})]}):e.jsx("p",{className:"text-sm text-destructive px-2 py-2 text-center",children:"Du har ikke tilgang til denne siden."})}export{ie as default};
