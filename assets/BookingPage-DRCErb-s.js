import{j as e,r as f}from"./react-Bq13ngtT.js";import{P as D}from"./Page-DzYq3R64.js";import{a as A,b as C,d as $,t as p,e as B,k as w,f as Q,L as S,B as N,F as M,g as L,h as P,i as E,j as F}from"./index-Bzex8V_f.js";import{u as I}from"./useBaner-D6nNAZ81.js";import{D as K,f as V}from"./DatoVelger-B0Nt5C_e.js";import{A as z,a as O,b as R,B as q,c as U}from"./badge-SjAerVHH.js";import{a as _,b as H,U as J,c as W,d as Y}from"./lucide-Bfr9gI8s.js";import{c as G,d as X}from"./shadcn-B0ihbUNs.js";import{D as Z,a as ee,b as se,c as te,d as ae,e as re}from"./dialog-COtQF8jY.js";import{T as ne,a as ie,b as oe}from"./tabs-CeV8gL6m.js";function le({items:r,value:o,onValueChange:n,className:t=""}){const d=r.find(g=>g.value===o)??r[0];return e.jsxs(ne,{value:d.value,onValueChange:n,children:[e.jsx(ie,{className:`flex flex-wrap gap-2 mb-2 ${t}`,children:r.map(g=>e.jsx(oe,{value:g.value,children:g.label},g.value))}),e.jsx("div",{className:"mt-0",children:d.content})]})}function ce(r,o){const n=A(),t=C(),[d,g]=f.useState(null),i=["bookinger",n,o,r],h=!!o&&!!r,s=$(i,`/klubb/${n}/bookinger?baneId=${o}&dato=${r}`,{requireAuth:!0,enabled:h,staleTime:0,refetchInterval:3e4,refetchOnWindowFocus:!0,refetchIntervalInBackground:!1,placeholderData:w}),x=f.useRef(!1);f.useEffect(()=>{if(!s.error){x.current=!1;return}x.current||(p.error(s.error.message??"Kunne ikke hente bookinger"),x.current=!0)},[s.error]);const k=()=>{t.invalidateQueries({queryKey:i}),t.invalidateQueries({queryKey:["mineBookinger",n]})},m=(a,u)=>a.startTid===u.startTid&&a.sluttTid===u.sluttTid,v=B("post",`/klubb/${n}/bookinger`,{onMutate:async a=>{await t.cancelQueries({queryKey:i});const u=t.getQueryData(i);return t.setQueryData(i,(l=[])=>l.map(c=>m(c,a)?{...c,booketAv:"Du",erEier:!0,kanBookes:!1,kanAvbestille:!0}:c)),{previous:u}},onError:(a,u,l)=>{l?.previous&&t.setQueryData(i,l.previous),p.error(a.message??"Kunne ikke booke.")},onSuccess:(a,u)=>{const l=`${u.startTid.slice(0,2)}-${u.sluttTid.slice(0,2)}`;p.success(`Booket ${l}`)},onSettled:()=>{k()}}),T=B("delete",`/klubb/${n}/bookinger`,{onMutate:async a=>{await t.cancelQueries({queryKey:i});const u=t.getQueryData(i);return t.setQueryData(i,(l=[])=>l.map(c=>m(c,a)?{...c,booketAv:null,erEier:!1,kanBookes:!0,kanAvbestille:!1,kanSlette:!1}:c)),{previous:u}},onError:(a,u,l)=>{l?.previous&&t.setQueryData(i,l.previous),p.error(a.message??"Kunne ikke avbestille.")},onSuccess:()=>{p.info("Bookingen er avbestilt.")},onSettled:()=>{k()}}),y=B("delete",`/klubb/${n}/bookinger/admin`,{onMutate:async a=>{await t.cancelQueries({queryKey:i});const u=t.getQueryData(i);return t.setQueryData(i,(l=[])=>l.map(c=>m(c,a)?{...c,booketAv:null,erEier:!1,kanBookes:!0,kanAvbestille:!1,kanSlette:!1}:c)),{previous:u}},onError:(a,u,l)=>{l?.previous&&t.setQueryData(i,l.previous),p.error(a.message??"Kunne ikke slette booking.")},onSuccess:()=>{p.success("Booking slettet"),g(null)},onSettled:()=>{k()}});return{slots:s.data??[],isLoading:s.isLoading,isFetching:s.isFetching,apenSlotTid:d,setApenSlotTid:g,onBook:a=>v.mutate({baneId:o,dato:r,startTid:a.startTid,sluttTid:a.sluttTid}),onCancel:a=>T.mutate({baneId:o,dato:r,startTid:a.startTid,sluttTid:a.sluttTid}),onDelete:a=>y.mutate({baneId:a.baneId??o,dato:a.dato??r,startTid:a.startTid,sluttTid:a.sluttTid}),hentBookinger:s.refetch}}function de({className:r,...o}){return e.jsx(G,{"data-slot":"checkbox",className:Q("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",r),...o,children:e.jsx(X,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(_,{className:"size-3.5"})})})}function ue({slots:r,currentUser:o,onBook:n,onCancel:t,onDelete:d,isLoading:g=!1}){const[i,h]=f.useState(null);return g?e.jsx(S,{}):r.length===0?e.jsx("div",{className:"text-muted text-sm italic py-4 text-center",children:"Ingen bookinger eller slots å vise."}):e.jsx(z,{type:"single",collapsible:!0,className:"rounded-md border bg-background",children:r.map(s=>{const x=`${s.dato}-${s.startTid}-${s.baneId}`,k=`${s.startTid.slice(0,5)} – ${s.sluttTid.slice(0,5)}`,m=!!s.arrangementTittel,v=!!s.booketAv,T=s.erEier===!0,y=i===x,a=s.kanBookes||s.kanAvbestille||s.kanSlette,u=!!o&&a&&!s.erPassert,l=!!s.værSymbol||typeof s.temperatur=="number"||typeof s.vind=="number";let c="Ledig",j="secondary";return s.erPassert?(c="Passert",j="outline"):m?(c=s.arrangementTittel??"Arrangement",j="default"):T?(c="Din booking",j="default"):v&&(c="Opptatt",j="outline"),e.jsxs(O,{value:x,className:`px-4 ${s.erPassert?"opacity-50":""}`,children:[e.jsx(R,{className:"hover:no-underline",children:e.jsxs("div",{className:"flex flex-col items-start gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:k}),s.værSymbol&&e.jsx("img",{src:`/banebooking-voyager-fe/weather-symbols/svg/${s.værSymbol}.svg`,alt:s.værSymbol,width:18,height:18,className:"select-none",draggable:!1}),e.jsx(q,{variant:j,className:"text-xs",children:c})]}),m&&s.arrangementBeskrivelse&&e.jsx("span",{className:"text-xs text-muted-foreground line-clamp-1",children:s.arrangementBeskrivelse}),v&&!m&&s.booketAv&&e.jsx("span",{className:"text-xs text-muted-foreground",children:s.booketAv})]})}),e.jsx(U,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(H,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Tidspunkt"}),e.jsx("div",{className:"text-sm",children:k})]})]}),v&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Booket av"}),e.jsx("div",{className:"text-sm",children:s.booketAv})]})]}),m&&s.arrangementBeskrivelse&&e.jsxs("div",{className:"flex items-start gap-2 sm:col-span-2",children:[e.jsx(W,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Arrangement"}),e.jsx("div",{className:"text-sm whitespace-pre-wrap",children:s.arrangementBeskrivelse})]})]}),l&&e.jsxs("div",{className:"flex items-start gap-2 sm:col-span-2",children:[s.værSymbol&&e.jsx("img",{src:`/banebooking-voyager-fe/weather-symbols/svg/${s.værSymbol}.svg`,alt:s.værSymbol,width:16,height:16,className:"select-none mt-0.5 shrink-0",draggable:!1}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Vær"}),e.jsxs("div",{className:"text-sm",children:[typeof s.temperatur=="number"&&e.jsxs("span",{children:[s.temperatur,"°"]}),typeof s.temperatur=="number"&&typeof s.vind=="number"&&" · ",typeof s.vind=="number"&&e.jsxs("span",{children:[s.vind," m/s"]})]})]})]})]}),u&&e.jsxs("div",{className:"flex flex-col items-end gap-2 pt-2 border-t",children:[s.kanBookes&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[e.jsx(de,{id:`book-${x}`,checked:y,onCheckedChange:b=>h(b?x:null)}),e.jsxs("label",{htmlFor:`book-${x}`,className:"cursor-pointer select-none text-sm",children:["Jeg (og de jeg spiller med) har betalt medlemskap for"," ",new Date().getFullYear()]})]}),e.jsxs(N,{variant:"outline",size:"sm",disabled:!y,onClick:b=>{b.stopPropagation(),n?.(s),h(null)},className:"flex items-center gap-2 text-sm",children:[e.jsx(M,{}),"Book"]})]}),s.kanAvbestille&&e.jsxs(N,{variant:"outline",size:"sm",onClick:b=>{b.stopPropagation(),t?.(s)},className:"flex items-center gap-2 text-sm",children:[e.jsx(L,{}),"Avbestill"]}),s.kanSlette&&e.jsxs(N,{variant:"destructive",size:"sm",onClick:b=>{b.stopPropagation(),d?.(s)},className:"flex items-center gap-2 text-sm",children:[e.jsx(P,{}),"Slett"]})]})]})})]},x)})})}function me({children:r}){const{data:o,isLoading:n}=E();if(n||!o)return null;const{bookingRegel:t}=o;return e.jsxs(Z,{children:[e.jsx(ee,{asChild:!0,children:r}),e.jsxs(se,{children:[e.jsxs(te,{children:[e.jsx(ae,{children:"Bookingregler"}),e.jsx(re,{className:"sr-only",children:"Oversikt over bookingreglene i klubben"})]}),e.jsx("div",{className:"space-y-4",children:e.jsxs("ul",{className:"list-disc list-inside text-sm",children:[e.jsxs("li",{children:["Maks ",t.maksPerDag," bookinger per dag"]}),e.jsxs("li",{children:["Maks ",t.maksTotalt," aktive bookinger totalt"]}),e.jsxs("li",{children:["Opptil ",t.dagerFremITid," dager frem i tid"]}),e.jsxs("li",{children:[t.slotLengdeMinutter," minutter per booking"]}),e.jsxs("li",{children:["Tillatt mellom ",t.aapningstid,"–",t.stengetid]})]})})]})]})}function ge({baner:r,valgtBaneId:o,onBaneChange:n,valgtDato:t,onDatoChange:d,slots:g,isLoading:i,currentUser:h,onBook:s,onCancel:x,onDelete:k}){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx(me,{children:e.jsx(N,{variant:"ghost",size:"icon",className:"rounded-full",title:"Vis banereglement",children:e.jsx(Y,{className:"w-5 h-5"})})}),e.jsx(K,{value:t,onChange:m=>d(m??null),visNavigering:!0})]}),e.jsx(le,{items:r.map(m=>({value:m.id,label:m.navn,content:e.jsx(ue,{slots:g,currentUser:h?{epost:h.email??""}:null,onBook:s,onCancel:x,onDelete:k,isLoading:i})})),value:o,onValueChange:n})]})}function xe(){const{baner:r,isLoading:o}=I(!1),[n,t]=f.useState(""),[d,g]=f.useState(new Date),{currentUser:i}=F(),h=f.useMemo(()=>d?V(d,"yyyy-MM-dd"):"",[d]),{slots:s,onBook:x,onCancel:k,onDelete:m,isLoading:v}=ce(h,n);return f.useEffect(()=>{!n&&r.length>0&&t(r[0].id)},[r,n]),f.useEffect(()=>{d&&localStorage.setItem("valgtDato",d.toISOString())},[d]),o||!n?e.jsx(S,{}):e.jsx(ge,{baner:r,valgtBaneId:n,onBaneChange:t,valgtDato:d,onDatoChange:g,slots:s,isLoading:v,currentUser:i,onBook:x,onCancel:k,onDelete:m})}function Be(){return e.jsx(D,{children:e.jsx(xe,{})})}export{Be as default};
