import{r as v,j as a}from"./shadcn-C7L97JSy.js";import{u as L,T as z,a as R,b as f,c as h}from"./useBaner-CviK5qdb.js";import{B as u,t as r}from"./index-znh59LNM.js";import{C as j,a as y}from"./FieldWrapper-D3j7X-tq.js";import{F as d}from"./FormField-B2EyTL9o.js";import{S as O}from"./SelectField-CUAFDQkv.js";import"./react-D5d5vywP.js";import"./lucide-CAh2A4Ey.js";import"./index-BswtpnY1.js";const B="rediger.valgtBaneId";function M(){const{baner:l,isLoading:C,oppdaterBane:N,opprettBane:S,deaktiverBane:E,aktiverBane:T}=L(!0),[m,x]=v.useState({}),[o,g]=v.useState({navn:"",beskrivelse:""}),[s,p]=v.useState(()=>{const e=sessionStorage.getItem(B);return e&&e!=="null"?e:null}),n=l.find(e=>e.id===s)??null,t=s?m[s]??null:null;v.useEffect(()=>{sessionStorage.setItem(B,s??"null")},[s]),v.useEffect(()=>{s&&!l.some(e=>e.id===s)&&p(null)},[l,s]);function b(e,i,k){x(c=>({...c,[e]:{...c[e]??l.find(K=>K.id===e),[i]:k}}))}async function w(e){const i=m[e];if(i)try{await N(e,i),r.success("Endringer lagret"),x(k=>{const c={...k};return delete c[e],c})}catch{r.error("Kunne ikke lagre bane")}}async function F(){if(!o.navn.trim()){r.error("Navn er pÃ¥krevd");return}try{await S(o),r.success("Bane lagt til"),g({navn:"",beskrivelse:""})}catch{r.error("Kunne ikke legge til bane")}}async function D(e){try{await E(e),r.success("Bane deaktivert")}catch{r.error("Kunne ikke deaktivere bane")}}async function I(e){try{await T(e),r.success("Bane aktivert")}catch{r.error("Kunne ikke aktivere bane")}}return a.jsx("div",{className:"max-w-screen-sm mx-auto px-2 py-2",children:a.jsxs(z,{defaultValue:"rediger",className:"space-y-4",children:[a.jsxs(R,{className:"mb-2",children:[a.jsx(f,{value:"rediger",children:"Rediger bane"}),a.jsx(f,{value:"ny",children:"Ny bane"})]}),a.jsx(h,{value:"rediger",children:C?a.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Laster..."}):a.jsx(j,{children:a.jsxs(y,{className:"p-4 space-y-4",children:[a.jsx(O,{id:"velg-bane",label:"Velg bane",value:s??"",onChange:e=>p(e||null),options:l.map(e=>({label:`${e.navn} ${e.aktiv?"":"(inaktiv)"}`,value:e.id}))}),n&&a.jsxs(a.Fragment,{children:[a.jsx(d,{id:"navn",label:"Navn",value:(t==null?void 0:t.navn)??n.navn,onChange:e=>b(n.id,"navn",e.target.value),readOnly:!n.aktiv}),a.jsx(d,{id:"beskrivelse",label:"Beskrivelse",value:(t==null?void 0:t.beskrivelse)??n.beskrivelse,onChange:e=>b(n.id,"beskrivelse",e.target.value),readOnly:!n.aktiv}),a.jsx("div",{className:"flex justify-between",children:n.aktiv?a.jsxs(a.Fragment,{children:[a.jsx(u,{size:"sm",onClick:e=>{e.preventDefault(),w(n.id)},disabled:!t||t.navn===n.navn&&t.beskrivelse===n.beskrivelse,children:"Lagre"}),a.jsx(u,{variant:"destructive",size:"sm",onClick:e=>{e.preventDefault(),D(n.id)},children:"Deaktiver"})]}):a.jsx(u,{variant:"outline",size:"sm",onClick:e=>{e.preventDefault(),I(n.id)},children:"Aktiver"})})]})]})})}),a.jsx(h,{value:"ny",children:a.jsx(j,{children:a.jsxs(y,{className:"p-4 space-y-3",children:[a.jsx(d,{id:"ny-navn",label:"Navn",value:o.navn,onChange:e=>g(i=>({...i,navn:e.target.value}))}),a.jsx(d,{id:"ny-beskrivelse",label:"Beskrivelse",value:o.beskrivelse,onChange:e=>g(i=>({...i,beskrivelse:e.target.value}))}),a.jsx(u,{size:"sm",onClick:e=>{e.preventDefault(),F()},children:"Legg til"})]})})})]})})}export{M as default};
