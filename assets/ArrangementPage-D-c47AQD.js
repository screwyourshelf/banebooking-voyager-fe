import{j as e,r as i}from"./shadcn-CWEYZx5G.js";import{R as se,C as ne,g as le,h as ie,P as re,O as oe,u as S,i as de,T as ce,a as ge,b as P,c as j,d as ue,e as k,f as me,j as xe,k as fe,t as V,l as he}from"./index-BsKzJOE1.js";import{u as pe}from"./useArrangement-TPvsuw3U.js";import{e as x,d as je,L as ke,B as u,t as m}from"./index-BlyKwakQ.js";import{D as E,C as F}from"./checkbox-Dn2kd8kw.js";import{C as ve,a as be}from"./card-ze9r6Rdg.js";import{F as De}from"./FormField-DvZBqlO0.js";import{S as Te}from"./SelectField-D0mF3LY6.js";import{X as Ne}from"./lucide-BJMfYTUr.js";import"./react-D5d5vywP.js";import"./useBaner-Bnyfb3hI.js";import"./index-CT8wDN5g.js";import"./FieldWrapper-D_J1bqtE.js";function Ce({...s}){return e.jsx(se,{"data-slot":"dialog",...s})}function we({...s}){return e.jsx(re,{"data-slot":"dialog-portal",...s})}function ye({className:s,...l}){return e.jsx(oe,{"data-slot":"dialog-overlay",className:x("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...l})}function Se({className:s,children:l,showCloseButton:g=!0,...c}){return e.jsxs(we,{"data-slot":"dialog-portal",children:[e.jsx(ye,{}),e.jsxs(ne,{"data-slot":"dialog-content",className:x("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...c,children:[l,g&&e.jsxs(le,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(Ne,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Fe({className:s,...l}){return e.jsx("div",{"data-slot":"dialog-header",className:x("flex flex-col gap-2 text-center sm:text-left",s),...l})}function Be({className:s,...l}){return e.jsx("div",{"data-slot":"dialog-footer",className:x("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",s),...l})}function Ue({className:s,...l}){return e.jsx(ie,{"data-slot":"dialog-title",className:x("text-lg leading-none font-semibold",s),...l})}function Me(){const{slug:s}=je(),{baner:l,tilgjengeligeTidspunkter:g,forhandsvisning:c,setForhandsvisning:L,forhandsvis:R,opprett:H,isLoading:B}=pe(s),[v,U]=i.useState([]),[b,I]=i.useState([]),[D,A]=i.useState([]),[o,_]=i.useState(new Date),[d,$]=i.useState(new Date),[f,M]=i.useState(!1),[h,X]=i.useState(!1),[p,q]=i.useState(!1),[T,G]=i.useState("Annet"),[N,J]=i.useState(""),[Q,C]=i.useState(!1),[W,Y]=i.useState(!1),Z=()=>L({ledige:[],konflikter:[]}),w=i.useMemo(()=>{if(!o||!d)return S;const a=new Set,t=new Date(o),r=new Date(d);for(let n=new Date(t);n<=r;n.setDate(n.getDate()+1)){const ae=n.getDay(),te=he[ae],O=de[te];O&&a.add(O)}return S.filter(n=>a.has(n))},[o,d]);i.useEffect(()=>{f&&U(l.map(a=>a.id)),h&&I(w),p&&A(g)},[f,h,p,l,w,g]);const y=(a,t)=>{t(r=>r.includes(a)?r.filter(n=>n!==a):[...r,a])};function z(){if(!o||!d)return m.warning("Du må velge start- og sluttdato"),null;if(v.length===0)return m.warning("Du må velge minst én bane"),null;if(D.length===0)return m.warning("Du må velge minst ett tidspunkt"),null;if(b.length===0)return m.warning("Du må velge minst én ukedag"),null;const a=xe(o,d),t=b.map(r=>fe[r]).filter(r=>a.has(r));return t.length===0?(m.warning("Ingen av de valgte ukedagene finnes i datointervallet"),null):{tittel:T,beskrivelse:N,kategori:T,startDato:V(o),sluttDato:V(d),ukedager:t,tidspunkter:D,baneIder:v}}const ee=async()=>{const a=z();a&&(await H(a),Z(),C(!1))},K=[...c.ledige,...c.konflikter].sort((a,t)=>a.dato.localeCompare(t.dato)||a.startTid.localeCompare(t.startTid)||a.baneId.localeCompare(t.baneId));return e.jsx("div",{className:"max-w-screen-md mx-auto px-1 py-1",children:B?e.jsx(ke,{}):e.jsxs(e.Fragment,{children:[e.jsx(ve,{children:e.jsxs(be,{className:"p-4 space-y-4",children:[e.jsx(Te,{id:"kategori",label:"Kategori",value:T,onChange:a=>G(a),options:["Trening","Turnering","Klubbmersterskap","Kurs","Lagkamp","Stigespill","Dugnad","Vedlikehold","Sosialt","Annet"].map(a=>({label:a,value:a}))}),e.jsx(De,{id:"beskrivelse",label:"Beskrivelse",value:N,onChange:a=>J(a.target.value)}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Fra"}),e.jsx(E,{value:o,onChange:_,visNavigering:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Til"}),e.jsx(E,{value:d,onChange:$,visNavigering:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{id:"alleBaner",checked:f,onCheckedChange:a=>M(!!a)}),e.jsx("label",{htmlFor:"alleBaner",className:"text-sm",children:"Alle baner"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:l.map(a=>e.jsx(u,{variant:v.includes(a.id)?"default":"outline",size:"sm",onClick:()=>y(a.id,U),disabled:f,children:a.navn},a.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{id:"alleUkedager",checked:h,onCheckedChange:a=>X(!!a)}),e.jsx("label",{htmlFor:"alleUkedager",className:"text-sm",children:"Alle gyldige dager"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:S.map(a=>e.jsx(u,{variant:b.includes(a)?"default":"outline",size:"sm",onClick:t=>{t.preventDefault(),y(a,I)},disabled:h||!w.includes(a),children:a},a))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(F,{id:"alleTidspunkter",checked:p,onCheckedChange:a=>q(!!a)}),e.jsx("label",{htmlFor:"alleTidspunkter",className:"text-sm",children:"Alle tidspunkter"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:g.map(a=>e.jsx(u,{variant:D.includes(a)?"default":"outline",size:"sm",onClick:()=>y(a,A),disabled:p,children:a},a))})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(u,{type:"button",onClick:async()=>{const a=z();a&&(await R(a),Y(!0),C(!0))},children:"Forhåndsvis bookinger"})})]})}),e.jsx(Ce,{open:Q,onOpenChange:C,children:e.jsxs(Se,{className:"max-w-3xl",children:[e.jsx(Fe,{children:e.jsx(Ue,{children:"Forhåndsvis bookingene"})}),W&&K.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-auto max-h-[60vh] border rounded-md",children:e.jsxs(ce,{className:"text-sm",children:[e.jsx(ge,{children:e.jsxs(P,{children:[e.jsx(j,{children:"Dato"}),e.jsx(j,{children:"Klokkeslett"}),e.jsx(j,{children:"Bane"}),e.jsx(j,{children:"Beskrivelse"})]})}),e.jsx(ue,{children:K.map(a=>{const t=l.find(n=>n.id===a.baneId),r=c.konflikter.some(n=>n.baneId===a.baneId&&n.dato===a.dato&&n.startTid===a.startTid&&n.sluttTid===a.sluttTid);return e.jsxs(P,{className:r?"bg-yellow-100":"",children:[e.jsx(k,{children:me(a.dato)}),e.jsxs(k,{children:[a.startTid," – ",a.sluttTid]}),e.jsx(k,{children:(t==null?void 0:t.navn)??"(ukjent bane)"}),e.jsxs(k,{children:[N,r&&e.jsx("span",{className:"ml-2 text-yellow-700 text-xs italic",children:"(Konflikt)"})]})]},`${a.dato}-${a.baneId}-${a.startTid}`)})})]})}),e.jsx(Be,{className:"mt-3",children:e.jsxs(u,{type:"button",onClick:ee,disabled:B,children:["Opprett ",c.ledige.length," bookinger"]})})]}):e.jsx("p",{className:"text-muted-foreground italic",children:"Ingen bookinger å vise."})]})})]})})}export{Me as default};
