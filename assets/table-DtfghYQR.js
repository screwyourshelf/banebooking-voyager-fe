import{r as f,j as u}from"./shadcn-mOdBhBu9.js";import{m as N,e as $,u as D,c as F,a as L,b as x,t as g,j as d}from"./index-DACapAhf.js";import{u as R}from"./useBaner-DgsCLYux.js";function C(e,t,a,n){const m=n?.requireAuth??!1;return N({queryKey:e,enabled:(n?.enabled??!0)&&a!=null,retry:!1,...n,queryFn:async({signal:l})=>(await $.post(t,a,{requireAuth:m,signal:l,timeout:2e4,...n?.axiosConfig??{}})).data})}function w(e){const[t,a]=e.split(":").map(Number);return t*60+a}function B(e){const t=String(Math.floor(e/60)).padStart(2,"0"),a=String(e%60).padStart(2,"0");return`${t}:${a}`}function E(e,t,a){const n=w(e),m=w(t),l=[];for(let c=n;c+a<=m;c+=a)l.push(B(c));return l}const I={ledige:[],konflikter:[]};function _(e){const t={...e,ukedager:[...e.ukedager].sort(),tidspunkter:[...e.tidspunkter].sort(),baneIder:[...e.baneIder].sort()};return JSON.stringify(t)}function P(e){const t=D(),{data:a,isLoading:n}=F(e),{baner:m,isLoading:l}=R(e),c=f.useMemo(()=>{if(!a?.bookingRegel)return[];const r=a.bookingRegel.aapningstid||"08:00",i=a.bookingRegel.stengetid||"22:00",s=a.bookingRegel.slotLengdeMinutter||60;return E(r,i,s)},[a]),o=f.useMemo(()=>["arrangementer",e],[e]),p=L(o,`/klubb/${e}/arrangement/kommende`,{enabled:!!e,requireAuth:!0,staleTime:3e4,select:r=>[...r].sort((i,s)=>i.startDato.localeCompare(s.startDato))}),[b,y]=f.useState(null),T=f.useMemo(()=>!e||!b?["arrangement-forhandsvis","disabled"]:["arrangement-forhandsvis",e,_(b)],[e,b]),h=C(T,`/klubb/${e}/arrangement/forhandsvis`,e?b:null,{requireAuth:!0,enabled:!!e&&!!b,staleTime:6e4,retry:!1}),A=h.data??I,Q=h.isFetching,j=async r=>e?(y(r),{success:!0}):{success:!1},v=()=>{y(null),e&&(t.cancelQueries({queryKey:["arrangement-forhandsvis",e]}),t.removeQueries({queryKey:["arrangement-forhandsvis",e]}))},q=x("post",`/klubb/${e}/arrangement`,{onSuccess:async r=>{v(),g.success(`${r.opprettet.length} bookinger opprettet`),await t.invalidateQueries({queryKey:o})},onError:r=>g.error(r.message??"Feil ved oppretting"),retry:!1}),K=async r=>e?{success:!0,result:await q.mutateAsync(r)}:{success:!1},k=x("delete",({arrangementId:r})=>`/klubb/${e}/arrangement/${r}`,{onMutate:async({arrangementId:r})=>{if(!e)return{};await t.cancelQueries({queryKey:o});const i=t.getQueryData(o);return t.setQueryData(o,s=>(s??[]).filter(S=>S.id!==r)),{previous:i}},onError:(r,i,s)=>{g.error(r.message??"Kunne ikke slette arrangementet"),s?.previous&&t.setQueryData(o,s.previous)},onSuccess:r=>{g.success(`Arrangementet ble avlyst â€“ ${r.antallBookingerDeaktivert} bookinger fjernet`)},onSettled:async()=>{e&&await t.invalidateQueries({queryKey:o})},retry:!1}),M=async r=>{e&&await k.mutateAsync({arrangementId:r})};return{klubb:a,baner:m,tilgjengeligeTidspunkter:c,arrangementer:p.data??[],forhandsvisning:A,forhandsvis:j,clearForhandsvisning:v,opprett:K,slettArrangement:M,refetchArrangementer:p.refetch,isLoading:n||l||p.isLoading,isLoadingForhandsvisning:Q,sletterArrangementId:k.variables?.arrangementId??null}}function z({className:e,...t}){return u.jsx("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:u.jsx("table",{"data-slot":"table",className:d("w-full caption-bottom text-sm",e),...t})})}function G({className:e,...t}){return u.jsx("thead",{"data-slot":"table-header",className:d("[&_tr]:border-b",e),...t})}function U({className:e,...t}){return u.jsx("tbody",{"data-slot":"table-body",className:d("[&_tr:last-child]:border-0",e),...t})}function V({className:e,...t}){return u.jsx("tr",{"data-slot":"table-row",className:d("hover:bg-muted/50 data-[state=selected]:bg-muted border-b transition-colors",e),...t})}function W({className:e,...t}){return u.jsx("th",{"data-slot":"table-head",className:d("text-foreground h-10 px-2 text-left align-middle font-medium whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}function X({className:e,...t}){return u.jsx("td",{"data-slot":"table-cell",className:d("p-2 align-middle whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...t})}export{z as T,G as a,V as b,W as c,U as d,X as e,P as u};
