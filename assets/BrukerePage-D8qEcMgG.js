import{r as s,j as t}from"./shadcn-BfUXmlP3.js";import{f as M,d as $,i as I,L as U,I as P,B as D,t as N}from"./index-DR0rjjbK.js";import{L as K}from"./label-DswYz8eT.js";import{C as q,a as O}from"./card-C4KXYnIA.js";import{S as W,a as z,b as Q,c as V,d as L}from"./select-fKsZOChJ.js";import"./react-D5d5vywP.js";import"./lucide-CZTSiasK.js";import"./index-36j8ZHWB.js";async function G(n,r){const a=await M(`/api/klubb/${n}/bruker/sok?query=${encodeURIComponent(r.trim())}`,{method:"GET"},!0);if(!a.ok){const o=await a.text();throw new Error(o||"Kunne ikke hente brukere")}return await a.json()}async function J(n,r,a){const o=await M(`/api/klubb/${n}/bruker/${r}/rolle`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},!0);if(!o.ok){const i=await o.text();throw new Error(i||"Kunne ikke oppdatere rolle")}}function H(n,r,a){var o=this,i=s.useRef(null),f=s.useRef(0),u=s.useRef(null),l=s.useRef([]),m=s.useRef(),d=s.useRef(),g=s.useRef(n),v=s.useRef(!0);g.current=n;var w=typeof window<"u",j=!r&&r!==0&&w;if(typeof n!="function")throw new TypeError("Expected a function");r=+r||0;var R=!!(a=a||{}).leading,S=!("trailing"in a)||!!a.trailing,e="maxWait"in a,h="debounceOnServer"in a&&!!a.debounceOnServer,c=e?Math.max(+a.maxWait||0,r):null;s.useEffect(function(){return v.current=!0,function(){v.current=!1}},[]);var k=s.useMemo(function(){var y=function(p){var x=l.current,A=m.current;return l.current=m.current=null,f.current=p,d.current=g.current.apply(A,x)},b=function(p,x){j&&cancelAnimationFrame(u.current),u.current=j?requestAnimationFrame(p):setTimeout(p,x)},B=function(p){if(!v.current)return!1;var x=p-i.current;return!i.current||x>=r||x<0||e&&p-f.current>=c},F=function(p){return u.current=null,S&&l.current?y(p):(l.current=m.current=null,d.current)},C=function p(){var x=Date.now();if(B(x))return F(x);if(v.current){var A=r-(x-i.current),T=e?Math.min(A,c-(x-f.current)):A;b(p,T)}},E=function(){if(w||h){var p=Date.now(),x=B(p);if(l.current=[].slice.call(arguments),m.current=o,i.current=p,x){if(!u.current&&v.current)return f.current=i.current,b(C,r),R?y(i.current):d.current;if(e)return b(C,r),y(i.current)}return u.current||b(C,r),d.current}};return E.cancel=function(){u.current&&(j?cancelAnimationFrame(u.current):clearTimeout(u.current)),f.current=0,l.current=i.current=m.current=u.current=null},E.isPending=function(){return!!u.current},E.flush=function(){return u.current?F(Date.now()):d.current},E},[R,e,r,c,S,j,w,h]);return k}function X(n,r){return n===r}function Y(n,r,a){var o=X,i=s.useRef(n),f=s.useState({})[1],u=H(s.useCallback(function(m){i.current=m,f({})},[f]),r,a),l=s.useRef(n);return o(l.current,n)||(u(n),l.current=n),[i.current,u]}function Z(n,r=""){const[a,o]=s.useState([]),[i,f]=s.useState(!1),[u,l]=s.useState(null),[m]=Y(r.trim(),300);return s.useEffect(()=>{if(!n||m.length<2)return;const d=new AbortController;return f(!0),G(n,m).then(g=>{d.signal.aborted||(o(g),l(null))}).catch(g=>{d.signal.aborted||(l(g.message),o([]))}).finally(()=>{d.signal.aborted||f(!1)}),()=>d.abort()},[n,m]),{brukere:a,laster:i,feil:u}}function ce(){const{slug:n}=$(),{bruker:r,laster:a}=I(n),[o,i]=s.useState(""),{brukere:f,laster:u,feil:l}=Z(n,o),[m,d]=s.useState({}),[g,v]=s.useState({}),w=r==null?void 0:r.roller.includes("KlubbAdmin"),j=(e,h)=>{d(c=>({...c,[e]:h}))},R=e=>{d(h=>{const c={...h};return delete c[e],c})},S=async e=>{if(!n)return;const h=m[e];if(h)try{await J(n,e,h),N.success("Rolle oppdatert"),v(c=>({...c,[e]:h})),d(c=>{const k={...c};return delete k[e],k})}catch(c){c instanceof Error?N.error(c.message):N.error("Ukjent feil ved oppdatering")}};return s.useEffect(()=>{d({})},[o]),a?t.jsx(U,{}):w?t.jsx("div",{className:"max-w-screen-sm mx-auto px-2 py-2 space-y-4",children:t.jsx(q,{children:t.jsxs(O,{className:"p-4 space-y-4",children:[t.jsxs("div",{children:[t.jsx(K,{htmlFor:"sok",children:"Søk etter bruker"}),t.jsx(P,{id:"sok",placeholder:"f.eks. navn eller e-post",value:o,onChange:e=>i(e.target.value),onKeyDown:e=>{e.key==="Enter"&&e.preventDefault()}})]}),u&&t.jsx("p",{children:"Laster brukere..."}),!u&&l&&t.jsx("p",{className:"text-red-600",children:l}),!u&&f.length===0&&!l&&t.jsx("p",{className:"text-muted-foreground",children:"Ingen brukere funnet"}),f.map(e=>{const h=e.id===(r==null?void 0:r.id),c=g[e.id]??e.roller[0]??"Medlem",k=m[e.id]??c,y=k!==c;return t.jsxs("div",{className:"border rounded p-3 space-y-2",children:[t.jsx("div",{className:"font-medium",children:e.epost}),t.jsxs("div",{className:"text-sm text-muted-foreground",children:["Nåværende rolle: ",t.jsx("strong",{children:c})]}),t.jsx(K,{htmlFor:`rolle-${e.id}`,className:"text-sm",children:h?"Du kan ikke endre din egen rolle":"Endre rolle"}),t.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[t.jsxs(W,{value:k,onValueChange:b=>j(e.id,b),disabled:h,children:[t.jsx(z,{id:`rolle-${e.id}`,className:"w-[180px]",children:t.jsx(Q,{})}),t.jsxs(V,{children:[t.jsx(L,{value:"Medlem",children:"Medlem"}),t.jsx(L,{value:"Utvidet",children:"Utvidet"}),t.jsx(L,{value:"KlubbAdmin",children:"KlubbAdmin"})]})]}),!h&&t.jsxs(t.Fragment,{children:[t.jsx(D,{size:"sm",onClick:()=>S(e.id),disabled:!y,children:"Lagre"}),t.jsx(D,{size:"sm",variant:"ghost",onClick:()=>R(e.id),disabled:!y,children:"Avbryt"})]})]})]},e.id)})]})})}):t.jsx("p",{className:"text-sm text-destructive px-2 py-2 text-center",children:"Du har ikke tilgang til denne siden."})}export{ce as default};
