import{r as c,j as a}from"./shadcn-C7L97JSy.js";import{u as L,T as z,a as R,b,c as h}from"./useBaner-Du_P2ZUl.js";import{B as u,t as r}from"./index-3TgM-pJG.js";import{C as j,a as y}from"./FieldWrapper-C86oTohC.js";import{F as d}from"./FormField-C7sfSCIZ.js";import{S as O}from"./SelectField-rKsER-wy.js";import"./react-D5d5vywP.js";import"./lucide-CAh2A4Ey.js";import"./index-BswtpnY1.js";const B="rediger.valgtBaneId";function M(){const{baner:i,isLoading:C,oppdaterBane:N,opprettBane:E,deaktiverBane:S,aktiverBane:T}=L(!0),[x,f]=c.useState({}),[o,g]=c.useState({navn:"",beskrivelse:""}),[s,k]=c.useState(()=>{const e=sessionStorage.getItem(B);return e&&e!=="null"?e:null}),n=i.find(e=>e.id===s)??null,t=s?x[s]??null:null;c.useEffect(()=>{sessionStorage.setItem(B,s??"null")},[s]),c.useEffect(()=>{s&&!i.some(e=>e.id===s)&&k(null)},[i,s]),c.useEffect(()=>{!s&&i.length>0&&k(i[0].id)},[i,s]);function p(e,l,m){f(v=>({...v,[e]:{...v[e]??i.find(K=>K.id===e),[l]:m}}))}async function w(e){const l=x[e];if(l)try{await N(e,l),r.success("Endringer lagret"),f(m=>{const v={...m};return delete v[e],v})}catch{r.error("Kunne ikke lagre bane")}}async function F(){if(!o.navn.trim()){r.error("Navn er pÃ¥krevd");return}try{await E(o),r.success("Bane lagt til"),g({navn:"",beskrivelse:""})}catch{r.error("Kunne ikke legge til bane")}}async function D(e){try{await S(e),r.success("Bane deaktivert")}catch{r.error("Kunne ikke deaktivere bane")}}async function I(e){try{await T(e),r.success("Bane aktivert")}catch{r.error("Kunne ikke aktivere bane")}}return a.jsx("div",{className:"max-w-screen-sm mx-auto px-2 py-2",children:a.jsxs(z,{defaultValue:"rediger",className:"space-y-4",children:[a.jsxs(R,{className:"mb-2",children:[a.jsx(b,{value:"rediger",children:"Rediger bane"}),a.jsx(b,{value:"ny",children:"Ny bane"})]}),a.jsx(h,{value:"rediger",children:C?a.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Laster..."}):a.jsx(j,{children:a.jsxs(y,{className:"p-4 space-y-4",children:[a.jsx(O,{id:"velg-bane",label:"Velg bane",value:s??"",onChange:e=>k(e||null),options:i.map(e=>({label:`${e.navn} ${e.aktiv?"":"(inaktiv)"}`,value:e.id}))}),n&&a.jsxs(a.Fragment,{children:[a.jsx(d,{id:"navn",label:"Navn",value:(t==null?void 0:t.navn)??n.navn,onChange:e=>p(n.id,"navn",e.target.value),readOnly:!n.aktiv}),a.jsx(d,{id:"beskrivelse",label:"Beskrivelse",value:(t==null?void 0:t.beskrivelse)??n.beskrivelse,onChange:e=>p(n.id,"beskrivelse",e.target.value),readOnly:!n.aktiv}),a.jsx("div",{className:"flex justify-between",children:n.aktiv?a.jsxs(a.Fragment,{children:[a.jsx(u,{size:"sm",onClick:e=>{e.preventDefault(),w(n.id)},disabled:!t||t.navn===n.navn&&t.beskrivelse===n.beskrivelse,children:"Lagre"}),a.jsx(u,{variant:"destructive",size:"sm",onClick:e=>{e.preventDefault(),D(n.id)},children:"Deaktiver"})]}):a.jsx(u,{variant:"outline",size:"sm",onClick:e=>{e.preventDefault(),I(n.id)},children:"Aktiver"})})]})]})})}),a.jsx(h,{value:"ny",children:a.jsx(j,{children:a.jsxs(y,{className:"p-4 space-y-3",children:[a.jsx(d,{id:"ny-navn",label:"Navn",value:o.navn,onChange:e=>g(l=>({...l,navn:e.target.value}))}),a.jsx(d,{id:"ny-beskrivelse",label:"Beskrivelse",value:o.beskrivelse,onChange:e=>g(l=>({...l,beskrivelse:e.target.value}))}),a.jsx(u,{size:"sm",onClick:e=>{e.preventDefault(),F()},children:"Legg til"})]})})})]})})}export{M as default};
