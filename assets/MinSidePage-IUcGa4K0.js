import{r as f,j as e}from"./react-Bq13ngtT.js";import{P as Q}from"./Page-loVwC9K4.js";import{T as _}from"./Tabs-Bcz6gVm7.js";import{a as N,d as $,t as v,b as W,e as T,f as m,B as y,g as X,L as w,m as P,l as Y,n as J,o as Z,p as ee,I as te,q as se,r as ne,s as ae,v as re}from"./index-_75ENDbC.js";import{R as j,P as b,a as A,b as D}from"./RowList-BaEqfdnL.js";import{S as ie,f as k,a as oe,L}from"./datoUtils-DdoUO1p4.js";import{A as I,a as E,b as R,B as F,c as K}from"./badge-ogTn5LmY.js";import{M as O,c as q,d as U,e as le}from"./lucide-CWsE_6zt.js";import{e as de,f as ce,g as ue,h as me,D as ge,i as xe,A as fe,j as ve,O as he,k as pe,l as je,m as ke}from"./shadcn-B0ihbUNs.js";import"./tabs-B8FpkNRK.js";import"./switch-DegrM2rZ.js";function be(t=!1){const s=N(),a=$(["mineBookinger",s,t],`/klubb/${s}/bookinger/mine${t?"?inkluderHistoriske=true":""}`,{requireAuth:!0,staleTime:6e4}),r=f.useRef(!1);return f.useEffect(()=>{if(!a.error){r.current=!1;return}r.current||(v.error(a.error.message??"Ukjent feil ved henting av bookinger"),r.current=!0)},[a.error]),a}function Ne(){const t=N(),s=W(),a=()=>{s.invalidateQueries({queryKey:["mineBookinger",t]}),s.invalidateQueries({queryKey:["bookinger",t]})},r=T("delete",`/klubb/${t}/bookinger`,{onError:o=>{v.error(o.message??"Kunne ikke avbestille.")},onSuccess:()=>{v.info("Bookingen er avbestilt.")},onSettled:()=>{a()}});return{avbestill:o=>{r.mutate(o)},avbestillAsync:async o=>r.mutateAsync(o),isPending:r.isPending}}function V({label:t,value:s,description:a,className:r,density:l="default"}){return e.jsx(j,{title:t,description:a,density:l,className:r,children:e.jsx("div",{className:m("text-sm text-muted-foreground break-words"),children:s})})}function ye(t){return[...t].sort((s,a)=>{const r=new Date(a.dato).getTime()-new Date(s.dato).getTime();return r!==0?r:a.startTid.localeCompare(s.startTid)})}function Ae(t){return`${t.baneId}-${t.dato}-${t.startTid}-${t.sluttTid}`}function De({visHistoriske:t,onToggleVisHistoriske:s,bookinger:a,isPending:r,onAvbestill:l}){const i=a.length>0,o=t?"Du har ingen registrerte bookinger.":"Du har ingen kommende bookinger.";return e.jsxs(b,{title:"Bookinger",description:"Se kommende bookinger og velg om du vil inkludere tidligere.",children:[e.jsx(A,{children:e.jsx(D,{children:e.jsx(ie,{title:"Vis også tidligere bookinger",description:"Inkluder bookinger som allerede er gjennomført.",checked:t,onCheckedChange:s})})}),i?e.jsx(I,{type:"single",collapsible:!0,className:`rounded-md border bg-background mt-4 ${r?"pointer-events-none opacity-60":""}`,children:a.map(n=>{const d=Ae(n),c=`${n.startTid.slice(0,5)} – ${n.sluttTid.slice(0,5)}`,x=n.kanAvbestille&&!n.erPassert,g=!!n.værSymbol||typeof n.temperatur=="number"||typeof n.vind=="number";return e.jsxs(E,{value:d,className:`px-4 ${n.erPassert?"opacity-50":""}`,children:[e.jsx(R,{className:"hover:no-underline",children:e.jsxs("div",{className:"flex flex-col items-start gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:n.baneNavn}),n.erPassert&&e.jsx(F,{variant:"outline",className:"text-xs",children:"Gjennomført"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{children:k(n.dato)}),g&&e.jsxs("span",{className:"flex items-center gap-1",children:[n.værSymbol&&e.jsx("img",{src:`/banebooking-voyager-fe/weather-symbols/svg/${n.værSymbol}.svg`,alt:n.værSymbol,width:16,height:16,className:"select-none",draggable:!1}),typeof n.temperatur=="number"&&e.jsxs("span",{children:[n.temperatur,"°"]}),typeof n.vind=="number"&&e.jsxs("span",{children:[n.vind," m/s"]})]})]})]})}),e.jsx(K,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Bane"}),e.jsx("div",{className:"text-sm",children:n.baneNavn})]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Dato"}),e.jsx("div",{className:"text-sm",children:k(n.dato)})]})]}),e.jsxs("div",{className:"flex items-start gap-2 sm:col-span-2",children:[e.jsx(U,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Tidspunkt"}),e.jsx("div",{className:"text-sm",children:c})]})]})]}),x&&e.jsx("div",{className:"flex justify-end pt-2 border-t",children:e.jsxs(y,{variant:"outline",size:"sm",onClick:u=>{u.stopPropagation(),l(n)},className:"flex items-center gap-2 text-sm",children:[e.jsx(X,{}),"Avbestill"]})})]})})]},d)})}):e.jsx("p",{className:"text-sm text-muted-foreground italic mt-4",children:o})]})}function we(){const[t,s]=f.useState(!1),{data:a=[],isLoading:r}=be(t),{avbestillAsync:l,isPending:i}=Ne(),o=f.useMemo(()=>ye(a),[a]);async function n(d){i||await l({baneId:d.baneId,dato:d.dato,startTid:d.startTid,sluttTid:d.sluttTid})}return r?e.jsx(w,{}):e.jsx(De,{visHistoriske:t,onToggleVisHistoriske:s,bookinger:o,isPending:i,onAvbestill:n})}function Se(){const t=N();return $(["kommende-arrangementer",t],`/klubb/${t}/arrangement/kommende`,{requireAuth:!0,staleTime:3e4,select:s=>[...s].sort((a,r)=>a.startDato.localeCompare(r.startDato))})}function Te(t){const s=new Date(t),a=new Date,r=new Date(s.getFullYear(),s.getMonth(),s.getDate()),l=new Date(a.getFullYear(),a.getMonth(),a.getDate()),i=r.getTime()-l.getTime();return Math.max(0,Math.ceil(i/(1e3*60*60*24)))}function Ve(t){return t.startDato===t.sluttDato?k(t.startDato):`${k(t.startDato)} – ${k(t.sluttDato)}`}function Ce({arrangementer:t}){return e.jsx(b,{title:"Kommende arrangementer",description:"Oversikt over arrangementer som er planlagt fremover.",children:t.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ingen arrangementer registrert."}):e.jsx(I,{type:"single",collapsible:!0,className:"rounded-md border bg-background",children:t.map(s=>{const a=Te(s.startDato),r=s.beskrivelse?.trim()??"",l=r.length>0,i=(s.baner?.length??0)>0,o=(s.ukedager?.length??0)>0,n=(s.tidspunkter?.length??0)>0;return e.jsxs(E,{value:s.id,className:"px-4",children:[e.jsx(R,{className:"hover:no-underline",children:e.jsxs("div",{className:"flex flex-col items-start gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium",children:s.tittel}),e.jsxs(F,{variant:"secondary",className:"text-xs",children:[a," ",a===1?"dag":"dager"]})]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:Ve(s)})]})}),e.jsx(K,{children:e.jsxs("div",{className:"space-y-4",children:[l&&e.jsx("p",{className:"text-sm text-muted-foreground whitespace-pre-wrap",children:r}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-2",children:[i&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(O,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Baner"}),e.jsx("div",{className:"text-sm",children:s.baner?.join(", ")})]})]}),o&&e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(q,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Ukedager"}),e.jsx("div",{className:"text-sm",children:oe(s.ukedager)})]})]}),n&&e.jsxs("div",{className:"flex items-start gap-2 sm:col-span-2",children:[e.jsx(U,{className:"h-4 w-4 text-muted-foreground mt-0.5 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs font-medium text-muted-foreground",children:"Tidspunkter"}),e.jsxs("div",{className:"text-sm",children:[s.tidspunkter?.join(", "),s.slotLengdeMinutter&&e.jsxs("span",{className:"text-muted-foreground",children:[" ","(",s.slotLengdeMinutter," min)"]})]})]})]})]})]})})]},s.id)})})})}function $e(){const{data:t=[],isLoading:s}=Se();return s?e.jsx(w,{}):e.jsx(Ce,{arrangementer:t})}function Me({...t}){return e.jsx(de,{"data-slot":"alert-dialog",...t})}function Le({...t}){return e.jsx(ce,{"data-slot":"alert-dialog-trigger",...t})}function Be({...t}){return e.jsx(ve,{"data-slot":"alert-dialog-portal",...t})}function Pe({className:t,...s}){return e.jsx(he,{"data-slot":"alert-dialog-overlay",className:m("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...s})}function Ie({className:t,...s}){return e.jsxs(Be,{children:[e.jsx(Pe,{}),e.jsx(ue,{"data-slot":"alert-dialog-content",className:m("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...s})]})}function Ee({className:t,...s}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:m("flex flex-col gap-2 text-center sm:text-left",t),...s})}function Re({className:t,...s}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:m("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...s})}function Fe({className:t,...s}){return e.jsx(me,{"data-slot":"alert-dialog-title",className:m("text-lg font-semibold",t),...s})}function Ke({className:t,...s}){return e.jsx(ge,{"data-slot":"alert-dialog-description",className:m("text-muted-foreground text-sm",t),...s})}function Oe({className:t,...s}){return e.jsx(fe,{className:m(P(),t),...s})}function qe({className:t,...s}){return e.jsx(xe,{className:m(P({variant:"outline"}),t),...s})}function Ue({slettMeg:t,fullWidth:s=!1,disabled:a=!1,className:r}){const{signOut:l}=Y(),[i,o]=f.useState(!1),n=t.isPending,d=async()=>{try{await t.mutateAsync(),o(!1),await l()}catch{}};return e.jsxs(Me,{open:i,onOpenChange:o,children:[e.jsx(Le,{asChild:!0,children:e.jsx(y,{variant:"destructive",disabled:a||n,className:m(s&&"w-full",r),children:n?"Sletter...":"Slett min bruker"})}),e.jsxs(Ie,{children:[e.jsxs(Ee,{children:[e.jsx(Fe,{children:"Er du sikker?"}),e.jsx(Ke,{children:"Dette vil slette din bruker og all tilknytning permanent. Denne handlingen kan ikke angres."})]}),e.jsxs(Re,{children:[e.jsx(qe,{disabled:n,children:"Avbryt"}),e.jsx(Oe,{asChild:!0,children:e.jsx(y,{variant:"destructive",onClick:d,disabled:n,children:n?"Sletter...":"Slett bruker"})})]})]})]})}function z(){const t=N(),s=$(["meg",t],`/klubb/${t}/bruker/meg`,{requireAuth:!0,staleTime:6e4}),a=T("patch",`/klubb/${t}/bruker/meg`,{onSuccess:()=>{v.success("Visningsnavn oppdatert"),s.refetch()},onError:i=>{v.error(i.message??"Kunne ikke oppdatere visningsnavn")}}),r=T("delete",`/klubb/${t}/bruker/meg`,{onSuccess:()=>v.success("Brukeren er slettet"),onError:i=>v.error(i.message??"Kunne ikke slette bruker")}),l=async()=>{try{const i=await J.get(`/klubb/${t}/bruker/meg/egen-data`,{requireAuth:!0,responseType:"blob"}),o=i.data,d=i.headers?.["content-disposition"]?.match(/filename\*=UTF-8''([^;]+)|filename="?([^"]+)"?/i),x=decodeURIComponent(d?.[1]??d?.[2]??"")||`banebooking-data-${new Date().toISOString().slice(0,10)}.json`,g=URL.createObjectURL(o),u=document.createElement("a");u.href=g,u.download=x,document.body.appendChild(u),u.click(),u.remove(),URL.revokeObjectURL(g)}catch(i){const o=i instanceof Error?i.message:"Kunne ikke laste ned egen data";v.error(o)}};return{bruker:s.data,laster:s.isLoading,error:s.error,refetch:s.refetch,lastNedEgenData:l,oppdaterVisningsnavn:a,slettMeg:r}}function ze({className:t,...s}){return e.jsx(pe,{"data-slot":"radio-group",className:m("grid gap-3",t),...s})}function B({className:t,...s}){return e.jsx(je,{"data-slot":"radio-group-item",className:m("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(ke,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(le,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}function Ge({epost:t,rollerText:s,mode:a,onSetMode:r,visningsnavn:l,onChangeVisningsnavn:i,maxLength:o,canSubmit:n,isSaving:d,error:c,onSubmit:x,deleteAction:g,isDeleteDisabled:u=!1}){return e.jsxs(Z,{density:"default",onSubmit:h=>{h.preventDefault(),x()},children:[e.jsxs(b,{title:"Innstillinger",description:"Velg hva som vises som navnet ditt i appen.",children:[e.jsx(A,{children:e.jsxs(D,{children:[e.jsx(j,{title:"Visningsnavn",description:"Velg e-post eller et eget navn.",children:e.jsxs(ze,{value:a,onValueChange:h=>r(h==="epost"?"epost":"navn"),className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{value:"epost",id:"visningsnavn-epost"}),e.jsxs(L,{htmlFor:"visningsnavn-epost",children:["E-post (",t,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(B,{value:"navn",id:"visningsnavn-navn"}),e.jsx(L,{htmlFor:"visningsnavn-navn",children:"Eget navn"})]})]})}),a==="navn"?e.jsx(j,{children:e.jsxs(ee,{"data-invalid":!!c,children:[e.jsx(te,{id:"visningsnavn",value:l,onChange:h=>i(h.target.value),placeholder:`F.eks. Ola Nordmann (maks ${o} tegn)`,maxLength:o,autoComplete:"name","aria-invalid":!!c}),c?e.jsx(se,{children:c}):null]})}):null]})}),e.jsx(ne,{align:"left",spaced:!1,className:"w-full mt-4",children:e.jsx(ae,{isLoading:d,disabled:!n,fullWidth:!0,children:"Lagre endringer"})})]}),e.jsx(b,{title:"Konto",description:"Kontoinformasjon og tilgang. Enkelte opplysninger administreres av klubben.",children:e.jsx(A,{children:e.jsxs(D,{children:[e.jsx(V,{label:"Brukernavn / ID",value:t}),e.jsx(V,{label:"Tilgang",value:s}),e.jsx(j,{title:"Slett min bruker",description:"Sletter bruker og all tilknyttet data permanent.",right:e.jsx("div",{className:u?"pointer-events-none opacity-60":"",children:g})})]})})})]})}const C=50,He=/^[\p{L}\d\s.@'_%+-]{3,}$/u;function Qe(t){const s=t.trim();return s.length===0?"Visningsnavn kan ikke være tomt.":s.length<3?"Visningsnavn må være minst 3 tegn.":He.test(s)?s.length>C?`Visningsnavn kan ikke være lengre enn ${C} tegn.`:null:"Visningsnavn inneholder ugyldige tegn."}function _e(){const{bruker:t,laster:s,oppdaterVisningsnavn:a,slettMeg:r}=z(),{mutateAsync:l,isPending:i}=a,[o,n]=f.useState("epost"),[d,c]=f.useState(""),[x,g]=f.useState(null);if(f.useEffect(()=>{if(!t)return;const p=t.visningsnavn?.trim();!p||p===t.epost?(n("epost"),c("")):(n("navn"),c(p)),g(null)},[t]),s||!t)return e.jsx(w,{});const u=o==="epost"?t.epost:d.trim(),h=(t.visningsnavn??"").trim(),M=u,S=o==="navn"?Qe(d):null,G=M.length>0&&M!==h&&(o==="epost"||!S);async function H(){g(S),!S&&await l({visningsnavn:u})}return e.jsx(Ge,{epost:t.epost,rollerText:t.roller.join(", "),mode:o,onSetMode:p=>{n(p),g(null)},visningsnavn:d,onChangeVisningsnavn:p=>{c(p),x&&g(null)},maxLength:C,error:x,canSubmit:G,isSaving:i,onSubmit:()=>{H()},deleteAction:e.jsx(Ue,{slettMeg:r}),isDeleteDisabled:i})}function We(){const t=N(),{bruker:s,laster:a,lastNedEgenData:r,slettMeg:l}=z(),[i,o]=f.useState(!1);if(a||!s)return e.jsx(w,{});const n=s.vilkårAkseptertDato?`Akseptert ${k(s.vilkårAkseptertDato)}${s.vilkårVersjon?` (versjon ${s.vilkårVersjon})`:""}`:"Ikke registrert",d=async()=>{if(!i)try{o(!0),await r()}catch(c){const x=c instanceof Error?c.message:"Kunne ikke laste ned egen data";v.error(x)}finally{o(!1)}};return e.jsx("div",{children:e.jsx(b,{title:"Persondata",description:"Her kan du se vilkår og laste ned egne data.",children:e.jsx(A,{children:e.jsxs(D,{children:[e.jsx(V,{label:"Vilkår",description:"Vilkårene aksepteres automatisk ved første innlogging.",value:n}),e.jsx(j,{title:"Les vilkårene",description:"Åpnes i ny fane.",right:e.jsx(re,{to:`/${t}/vilkaar`,className:"text-sm underline text-primary hover:text-primary/80",target:"_blank",rel:"noopener noreferrer",children:"Åpne"})}),e.jsx(j,{title:"Last ned dine data",description:"JSON med registrerte opplysninger og bookinger.",right:e.jsx(y,{onClick:d,size:"sm",variant:"outline",disabled:i||l.isPending,children:i?"Laster...":"Last ned"})})]})})})})}function ot(){return e.jsx(Q,{children:e.jsx(_,{defaultValue:"bookinger",items:[{value:"bookinger",label:"Bookinger",content:e.jsx(we,{})},{value:"kommende-arrangementer",label:"Arrangement",content:e.jsx($e,{})},{value:"profil",label:"Profil",content:e.jsx(_e,{})},{value:"persondata",label:"Data",content:e.jsx(We,{})}]})})}export{ot as default};
