import{r as i,c as ee,y as $e,w as Fe,j as e,x as $,i as w,l as R,k as y,P as H,h as Le,m as Ve,p as Be,q as Ge,o as We,F as Ke,D as He,z as ze}from"./shadcn-C7L97JSy.js";import{t as h,f as P,d as D,e as te,u as Ue,B as K,g as qe,S as Ye,L as F}from"./index-znh59LNM.js";import{b as Je}from"./booking-CUECbV1u.js";import{u as Xe,f as C,T as X,a as Z,b as S,c as k,d as Q,e as N}from"./datoUtils-BbFBIYp4.js";import{T as Ze,a as Qe,b as L,c as V}from"./useBaner-CviK5qdb.js";import{C as B,a as G,F as E}from"./FieldWrapper-D3j7X-tq.js";import{F as et}from"./FormField-B2EyTL9o.js";import"./react-D5d5vywP.js";import"./lucide-CAh2A4Ey.js";function tt(t){const[a,n]=i.useState([]),[s,r]=i.useState(!0),[o,l]=i.useState(null),d=i.useCallback(async()=>{if(t)try{r(!0),l(null);const u=await Je(t);n(u)}catch(u){const g=u instanceof Error?u.message:"Ukjent feil ved henting";l(g),h.error(g)}finally{r(!1)}},[t]);return i.useEffect(()=>{d()},[d]),{bookinger:a,laster:s,error:o,refetch:d}}async function at(t){const a=await P(`/api/klubb/${t}/bruker/meg/egen-data`,{method:"GET"},!0);if(!a.ok){const o=await a.text();throw new Error(o||"Kunne ikke hente egen data")}const n=await a.blob(),s=window.URL.createObjectURL(n),r=document.createElement("a");r.href=s,r.download=`banebooking-data-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(r),r.click(),r.remove(),window.URL.revokeObjectURL(s)}async function rt(t){const a=await P(`/api/klubb/${t}/bruker/meg`,{method:"GET"},!0);if(!a.ok){const n=await a.text();throw new Error(n||"Kunne ikke hente meg")}return await a.json()}async function nt(t,a){const n=await P(`/api/klubb/${t}/bruker/meg`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)},!0);if(!n.ok){const s=await n.text();throw new Error(s||"Kunne ikke oppdatere visningsnavn")}}async function st(t){const a=await P(`/api/klubb/${t}/bruker/meg`,{method:"DELETE"},!0);if(!a.ok){const n=await a.text();throw new Error(n||"Kunne ikke slette brukeren")}}function ot(t){const[a,n]=i.useState(null),[s,r]=i.useState(!0),[o,l]=i.useState(null),d=i.useCallback(async()=>{if(t)try{await at(t),h.success("Dataen din lastes nå ned")}catch(f){const p=f instanceof Error?f.message:"Kunne ikke laste ned data";h.error(p)}},[t]),u=i.useCallback(async()=>{if(t){r(!0);try{const f=await rt(t);n(f),l(null)}catch(f){const p=f instanceof Error?f.message:"Ukjent feil ved henting";l(p),h.error(p),n(null)}finally{r(!1)}}},[t]),g=i.useCallback(async f=>{if(!(!a||!t))try{await nt(t,{visningsnavn:f}),n({...a,visningsnavn:f}),h.success("Visningsnavn lagret")}catch(p){const T=p instanceof Error?p.message:"Kunne ikke lagre visningsnavn";h.error(T)}},[t,a]),m=i.useCallback(async()=>{if(t)try{await st(t),n(null),h.success("Brukeren er slettet")}catch(f){const p=f instanceof Error?f.message:"Kunne ikke slette bruker";h.error(p)}},[t]);return i.useEffect(()=>{u()},[u]),{bruker:a,laster:s,feil:o,oppdaterVisningsnavn:g,refetch:u,slettMeg:m,lastNedEgenData:d}}var M="Dialog",[ae,re]=ee(M),[it,x]=ae(M),ne=t=>{const{__scopeDialog:a,children:n,open:s,defaultOpen:r,onOpenChange:o,modal:l=!0}=t,d=i.useRef(null),u=i.useRef(null),[g,m]=Fe({prop:s,defaultProp:r??!1,onChange:o,caller:M});return e.jsx(it,{scope:a,triggerRef:d,contentRef:u,contentId:$(),titleId:$(),descriptionId:$(),open:g,onOpenChange:m,onOpenToggle:i.useCallback(()=>m(f=>!f),[m]),modal:l,children:n})};ne.displayName=M;var se="DialogTrigger",oe=i.forwardRef((t,a)=>{const{__scopeDialog:n,...s}=t,r=x(se,n),o=w(a,r.triggerRef);return e.jsx(R.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":q(r.open),...s,ref:o,onClick:y(t.onClick,r.onOpenToggle)})});oe.displayName=se;var z="DialogPortal",[lt,ie]=ae(z,{forceMount:void 0}),le=t=>{const{__scopeDialog:a,forceMount:n,children:s,container:r}=t,o=x(z,a);return e.jsx(lt,{scope:a,forceMount:n,children:i.Children.map(s,l=>e.jsx(H,{present:n||o.open,children:e.jsx(Le,{asChild:!0,container:r,children:l})}))})};le.displayName=z;var O="DialogOverlay",ce=i.forwardRef((t,a)=>{const n=ie(O,t.__scopeDialog),{forceMount:s=n.forceMount,...r}=t,o=x(O,t.__scopeDialog);return o.modal?e.jsx(H,{present:s||o.open,children:e.jsx(dt,{...r,ref:a})}):null});ce.displayName=O;var ct=Ge("DialogOverlay.RemoveScroll"),dt=i.forwardRef((t,a)=>{const{__scopeDialog:n,...s}=t,r=x(O,n);return e.jsx(Be,{as:ct,allowPinchZoom:!0,shards:[r.contentRef],children:e.jsx(R.div,{"data-state":q(r.open),...s,ref:a,style:{pointerEvents:"auto",...s.style}})})}),b="DialogContent",de=i.forwardRef((t,a)=>{const n=ie(b,t.__scopeDialog),{forceMount:s=n.forceMount,...r}=t,o=x(b,t.__scopeDialog);return e.jsx(H,{present:s||o.open,children:o.modal?e.jsx(ut,{...r,ref:a}):e.jsx(gt,{...r,ref:a})})});de.displayName=b;var ut=i.forwardRef((t,a)=>{const n=x(b,t.__scopeDialog),s=i.useRef(null),r=w(a,n.contentRef,s);return i.useEffect(()=>{const o=s.current;if(o)return Ve(o)},[]),e.jsx(ue,{...t,ref:r,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:y(t.onCloseAutoFocus,o=>{var l;o.preventDefault(),(l=n.triggerRef.current)==null||l.focus()}),onPointerDownOutside:y(t.onPointerDownOutside,o=>{const l=o.detail.originalEvent,d=l.button===0&&l.ctrlKey===!0;(l.button===2||d)&&o.preventDefault()}),onFocusOutside:y(t.onFocusOutside,o=>o.preventDefault())})}),gt=i.forwardRef((t,a)=>{const n=x(b,t.__scopeDialog),s=i.useRef(!1),r=i.useRef(!1);return e.jsx(ue,{...t,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var l,d;(l=t.onCloseAutoFocus)==null||l.call(t,o),o.defaultPrevented||(s.current||(d=n.triggerRef.current)==null||d.focus(),o.preventDefault()),s.current=!1,r.current=!1},onInteractOutside:o=>{var u,g;(u=t.onInteractOutside)==null||u.call(t,o),o.defaultPrevented||(s.current=!0,o.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const l=o.target;((g=n.triggerRef.current)==null?void 0:g.contains(l))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&r.current&&o.preventDefault()}})}),ue=i.forwardRef((t,a)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:r,onCloseAutoFocus:o,...l}=t,d=x(b,n),u=i.useRef(null),g=w(a,u);return We(),e.jsxs(e.Fragment,{children:[e.jsx(Ke,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:r,onUnmountAutoFocus:o,children:e.jsx(He,{role:"dialog",id:d.contentId,"aria-describedby":d.descriptionId,"aria-labelledby":d.titleId,"data-state":q(d.open),...l,ref:g,onDismiss:()=>d.onOpenChange(!1)})}),e.jsxs(e.Fragment,{children:[e.jsx(pt,{titleId:d.titleId}),e.jsx(xt,{contentRef:u,descriptionId:d.descriptionId})]})]})}),U="DialogTitle",ge=i.forwardRef((t,a)=>{const{__scopeDialog:n,...s}=t,r=x(U,n);return e.jsx(R.h2,{id:r.titleId,...s,ref:a})});ge.displayName=U;var fe="DialogDescription",pe=i.forwardRef((t,a)=>{const{__scopeDialog:n,...s}=t,r=x(fe,n);return e.jsx(R.p,{id:r.descriptionId,...s,ref:a})});pe.displayName=fe;var me="DialogClose",xe=i.forwardRef((t,a)=>{const{__scopeDialog:n,...s}=t,r=x(me,n);return e.jsx(R.button,{type:"button",...s,ref:a,onClick:y(t.onClick,()=>r.onOpenChange(!1))})});xe.displayName=me;function q(t){return t?"open":"closed"}var he="DialogTitleWarning",[ft,ve]=$e(he,{contentName:b,titleName:U,docsSlug:"dialog"}),pt=({titleId:t})=>{const a=ve(he),n=`\`${a.contentName}\` requires a \`${a.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${a.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${a.docsSlug}`;return i.useEffect(()=>{t&&(document.getElementById(t)||console.error(n))},[n,t]),null},mt="DialogDescriptionWarning",xt=({contentRef:t,descriptionId:a})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ve(mt).contentName}}.`;return i.useEffect(()=>{var o;const r=(o=t.current)==null?void 0:o.getAttribute("aria-describedby");a&&r&&(document.getElementById(a)||console.warn(s))},[s,t,a]),null},ht=ne,vt=oe,Dt=le,jt=ce,bt=de,kt=ge,Nt=pe,De=xe,je="AlertDialog",[yt,da]=ee(je,[re]),v=re(),be=t=>{const{__scopeAlertDialog:a,...n}=t,s=v(a);return e.jsx(ht,{...s,...n,modal:!0})};be.displayName=je;var At="AlertDialogTrigger",ke=i.forwardRef((t,a)=>{const{__scopeAlertDialog:n,...s}=t,r=v(n);return e.jsx(vt,{...r,...s,ref:a})});ke.displayName=At;var Ct="AlertDialogPortal",Ne=t=>{const{__scopeAlertDialog:a,...n}=t,s=v(a);return e.jsx(Dt,{...s,...n})};Ne.displayName=Ct;var Et="AlertDialogOverlay",ye=i.forwardRef((t,a)=>{const{__scopeAlertDialog:n,...s}=t,r=v(n);return e.jsx(jt,{...r,...s,ref:a})});ye.displayName=Et;var A="AlertDialogContent",[wt,Rt]=yt(A),Tt=ze("AlertDialogContent"),Ae=i.forwardRef((t,a)=>{const{__scopeAlertDialog:n,children:s,...r}=t,o=v(n),l=i.useRef(null),d=w(a,l),u=i.useRef(null);return e.jsx(ft,{contentName:A,titleName:Ce,docsSlug:"alert-dialog",children:e.jsx(wt,{scope:n,cancelRef:u,children:e.jsxs(bt,{role:"alertdialog",...o,...r,ref:d,onOpenAutoFocus:y(r.onOpenAutoFocus,g=>{var m;g.preventDefault(),(m=u.current)==null||m.focus({preventScroll:!0})}),onPointerDownOutside:g=>g.preventDefault(),onInteractOutside:g=>g.preventDefault(),children:[e.jsx(Tt,{children:s}),e.jsx(St,{contentRef:l})]})})})});Ae.displayName=A;var Ce="AlertDialogTitle",Ee=i.forwardRef((t,a)=>{const{__scopeAlertDialog:n,...s}=t,r=v(n);return e.jsx(kt,{...r,...s,ref:a})});Ee.displayName=Ce;var we="AlertDialogDescription",Re=i.forwardRef((t,a)=>{const{__scopeAlertDialog:n,...s}=t,r=v(n);return e.jsx(Nt,{...r,...s,ref:a})});Re.displayName=we;var _t="AlertDialogAction",Te=i.forwardRef((t,a)=>{const{__scopeAlertDialog:n,...s}=t,r=v(n);return e.jsx(De,{...r,...s,ref:a})});Te.displayName=_t;var _e="AlertDialogCancel",Se=i.forwardRef((t,a)=>{const{__scopeAlertDialog:n,...s}=t,{cancelRef:r}=Rt(_e,n),o=v(n),l=w(a,r);return e.jsx(De,{...o,...s,ref:l})});Se.displayName=_e;var St=({contentRef:t})=>{const a=`\`${A}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${A}\` by passing a \`${we}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${A}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return i.useEffect(()=>{var s;document.getElementById((s=t.current)==null?void 0:s.getAttribute("aria-describedby"))||console.warn(a)},[a,t]),null},Ot=be,Pt=ke,Mt=Ne,It=ye,$t=Ae,Ft=Te,Lt=Se,Vt=Ee,Bt=Re;function Gt({...t}){return e.jsx(Ot,{"data-slot":"alert-dialog",...t})}function Wt({...t}){return e.jsx(Pt,{"data-slot":"alert-dialog-trigger",...t})}function Kt({...t}){return e.jsx(Mt,{"data-slot":"alert-dialog-portal",...t})}function Ht({className:t,...a}){return e.jsx(It,{"data-slot":"alert-dialog-overlay",className:D("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...a})}function zt({className:t,...a}){return e.jsxs(Kt,{children:[e.jsx(Ht,{}),e.jsx($t,{"data-slot":"alert-dialog-content",className:D("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...a})]})}function Ut({className:t,...a}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:D("flex flex-col gap-2 text-center sm:text-left",t),...a})}function qt({className:t,...a}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:D("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...a})}function Yt({className:t,...a}){return e.jsx(Vt,{"data-slot":"alert-dialog-title",className:D("text-lg font-semibold",t),...a})}function Jt({className:t,...a}){return e.jsx(Bt,{"data-slot":"alert-dialog-description",className:D("text-muted-foreground text-sm",t),...a})}function Xt({className:t,...a}){return e.jsx(Ft,{className:D(te(),t),...a})}function Zt({className:t,...a}){return e.jsx(Lt,{className:D(te({variant:"outline"}),t),...a})}function Qt({slettMeg:t}){const{signOut:a}=Ue(),[n,s]=i.useState(!1),[r,o]=i.useState(!1),l=async()=>{o(!0);try{await t(),h.success("Brukeren er slettet"),s(!1),await a()}catch{h.error("Noe gikk galt ved sletting")}finally{o(!1)}};return e.jsxs(Gt,{open:n,onOpenChange:s,children:[e.jsx(Wt,{asChild:!0,children:e.jsx(K,{variant:"destructive",children:"Slett min bruker"})}),e.jsxs(zt,{children:[e.jsxs(Ut,{children:[e.jsx(Yt,{children:"Er du sikker?"}),e.jsx(Jt,{children:"Dette vil slette din bruker og all tilknytning permanent. Denne handlingen kan ikke angres."})]}),e.jsxs(qt,{children:[e.jsx(Zt,{disabled:r,children:"Avbryt"}),e.jsx(Xt,{className:"bg-red-600 hover:bg-red-700 focus:ring-red-600",onClick:l,disabled:r,children:r?"Sletter...":"Slett bruker"})]})]})]})}const W=50,ea=/^[\p{L}\d\s.@'_%+-]{2,}$/u;function ua(){const{slug:t}=qe(),a=i.useContext(Ye)??t,[n,s]=i.useState("profil"),{bruker:r,laster:o,oppdaterVisningsnavn:l,slettMeg:d,lastNedEgenData:u}=ot(a),[g,m]=i.useState(""),[f,p]=i.useState(null),{bookinger:T,laster:Oe}=tt(a),{arrangementer:Y,isLoading:Pe}=Xe(a),[I,_]=i.useState(!1);i.useEffect(()=>{var c;if(r){const j=(c=r.visningsnavn)==null?void 0:c.trim();!j||j===r.epost?(_(!0),m("")):(m(j),_(!1))}},[r]);const Me=()=>{const c=g.trim();if(c.length===0){p("Visningsnavn kan ikke være tomt.");return}if(c.length<3){p("Visningsnavn må være minst 3 tegn.");return}if(!ea.test(c)){p("Visningsnavn inneholder ugyldige tegn.");return}if(c.length>W){p(`Visningsnavn kan ikke være lengre enn ${W} tegn.`);return}p(null),l(c)};return e.jsx("div",{className:"max-w-screen-md mx-auto px-2 py-4",children:e.jsxs(Ze,{value:n,onValueChange:s,children:[e.jsxs(Qe,{className:"mb-4",children:[e.jsx(L,{value:"profil",children:"Min profil"}),e.jsx(L,{value:"bookinger",children:"Mine bookinger"}),e.jsx(L,{value:"arrangementer",children:"Arrangementer"})]}),e.jsx(V,{value:"profil",children:e.jsx(B,{children:e.jsx(G,{className:"p-4 space-y-6",children:o||!r?e.jsx(F,{}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"space-y-4",onSubmit:c=>{c.preventDefault(),Me()},children:[e.jsx(et,{id:"visningsnavn",label:"Visningsnavn",value:I?"":g,maxLength:W,placeholder:(r==null?void 0:r.epost)||"f.eks. Ola Nordmann",onChange:c=>{m(c.target.value),_(!1)},disabled:I,error:f,helpText:"Navnet vises i grensesnittet, og settes automatisk til e-post ved første innlogging. Du kan endre det her. Eller velg å bruke e-post i stedet."}),e.jsxs("label",{className:"flex items-center space-x-2 text-sm",children:[e.jsx("input",{type:"checkbox",checked:I,onChange:c=>{_(c.target.checked),c.target.checked&&m("")}}),e.jsx("span",{children:"Bruk e-post som visningsnavn"})]}),e.jsx(K,{type:"submit",size:"sm",children:"Lagre"})]}),e.jsxs("div",{className:"pt-4 border-t mt-4 space-y-4",children:[e.jsx(E,{id:"epost",label:"Brukernavn / ID",children:e.jsx("p",{className:"text-sm text-foreground",children:r.epost})}),e.jsx(E,{id:"rolle",label:"Rolle (i klubben)",helpText:"Roller tildeles av klubbens administrator og kan ikke endres manuelt.",children:e.jsx("p",{className:"text-sm text-foreground",children:r.roller.join(", ")})})]}),e.jsxs("div",{className:"pt-4 border-t mt-4 space-y-4",children:[e.jsxs(E,{id:"vilkaar",label:"Vilkår for bruk",helpText:"Du aksepterer vilkårene automatisk ved første innlogging.",children:[r.vilkaarAkseptertDato?e.jsxs("p",{className:"text-sm text-foreground",children:["Akseptert ",C(r.vilkaarAkseptertDato)," ",r.vilkaarVersjon&&`(versjon ${r.vilkaarVersjon})`]}):e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ikke registrert"}),e.jsx("p",{className:"text-sm mt-1",children:e.jsx("a",{href:`/banebooking-voyager-fe/${a}/vilkaar`,className:"underline text-primary hover:text-primary/80",children:"Les vilkårene"})})]}),e.jsx(E,{id:"last-ned-data",label:"Last ned dine data",helpText:"Du kan laste ned alle registrerte opplysninger og bookinger i JSON-format.",children:e.jsx(K,{onClick:u,size:"sm",variant:"outline",children:"Last ned data"})}),e.jsx(E,{id:"slett-bruker",label:"Slett bruker",helpText:"Dette sletter brukeren din og all tilknyttet data permanent. Dette kan ikke angres.",children:e.jsx(Qt,{slettMeg:d})})]})]})})})}),e.jsx(V,{value:"bookinger",children:e.jsx(B,{children:e.jsx(G,{className:"p-4 space-y-4",children:Oe?e.jsx(F,{}):T.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Du har ingen kommende bookinger."}):e.jsx("div",{className:"overflow-auto max-h-[60vh] border-b border-x rounded-b-md",children:e.jsxs(X,{className:"text-sm",children:[e.jsx(Z,{children:e.jsxs(S,{children:[e.jsx(k,{children:"Dato"}),e.jsx(k,{children:"Tid"}),e.jsx(k,{children:"Bane"})]})}),e.jsx(Q,{children:T.map((c,j)=>e.jsxs(S,{children:[e.jsx(N,{children:C(c.dato)}),e.jsxs(N,{children:[c.startTid,"–",c.sluttTid]}),e.jsx(N,{children:c.baneNavn})]},j))})]})})})})}),e.jsx(V,{value:"arrangementer",children:e.jsx(B,{children:e.jsx(G,{className:"p-4 space-y-4",children:Pe?e.jsx(F,{}):Y.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ingen arrangementer registrert."}):e.jsx("div",{className:"overflow-auto max-h-[60vh] border-b border-x rounded-b-md",children:e.jsxs(X,{className:"text-sm",children:[e.jsx(Z,{children:e.jsxs(S,{children:[e.jsx(k,{className:"w-1/3",children:"Hva"}),e.jsx(k,{className:"w-1/3",children:"Når"}),e.jsx(k,{className:"w-1/3",children:"Om"})]})}),e.jsx(Q,{children:Y.map(c=>{const j=new Date(c.startDato),Ie=new Date,J=Math.max(0,Math.ceil((j.getTime()-Ie.getTime())/(1e3*60*60*24)));return e.jsxs(S,{children:[e.jsxs(N,{className:"whitespace-normal break-words",children:[e.jsx("div",{className:"font-medium",children:c.tittel}),c.beskrivelse&&e.jsx("div",{className:"text-muted-foreground text-xs whitespace-normal break-words",children:c.beskrivelse})]}),e.jsx(N,{className:"whitespace-normal break-words text-sm",children:c.startDato===c.sluttDato?C(c.startDato):`${C(c.startDato)} - ${C(c.sluttDato)}`}),e.jsxs(N,{className:"whitespace-nowrap",children:[J," ",J===1?"dag":"dager"]})]},c.id)})})]})})})})})]})})}export{ua as default};
