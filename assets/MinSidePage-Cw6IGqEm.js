import{j as e,r as g}from"./shadcn-BW0HktFr.js";import{u as E}from"./useSlug-CLlizT9B.js";import{P as $}from"./Page-BxwDHPA6.js";import{S as P}from"./SimpleTabsLazy-d2uoACPW.js";import{d as A,e as D,t as h,h as R,L as S,I as M,B as w,g as B,i as H}from"./index-DfwF_6E0.js";import{F as O}from"./FieldWrapper-fgOeih5f.js";import{S as k,a as F}from"./switch-CeDFAo51.js";import{A as I,a as U,b as q,c as K,d as _,e as z,f as G,g as Q,h as X}from"./alert-dialog-DeQjmu7a.js";import{f as L}from"./datoUtils-CMdMNzgI.js";import{T as J,a as W,b as T,c as j,d as Y,e as N}from"./table-Dha75Hze.js";import"./react-RGnvvjkK.js";import"./lucide-D2dOsrR-.js";import"./index-CVVkWozz.js";import"./index-CJjGIk76.js";function x({children:t,className:n=""}){return e.jsx("div",{className:`rounded-md border bg-background divide-y divide-border/60 ${n}`,children:t})}function p({title:t,description:n,right:s,children:r,className:o=""}){return e.jsxs("div",{className:`p-3 ${o}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium leading-5",children:t}),n?e.jsx("div",{className:"text-xs text-muted-foreground mt-1 leading-4",children:n}):null]}),s?e.jsx("div",{className:"shrink-0",children:s}):null]}),r?e.jsx("div",{className:"mt-2 min-w-0 text-sm text-foreground",children:r}):null]})}function y({label:t,value:n,description:s,className:r=""}){return e.jsx(p,{title:t,description:s,className:r,children:n})}function V(t){const n=A(["meg",t],`/klubb/${t}/bruker/meg`,{requireAuth:!0,enabled:!!t,staleTime:6e4}),s=D("patch",`/klubb/${t}/bruker/meg`,{onSuccess:()=>{h.success("Visningsnavn oppdatert"),n.refetch()},onError:a=>{h.error(a.message??"Kunne ikke oppdatere visningsnavn")}}),r=D("delete",`/klubb/${t}/bruker/meg`,{onSuccess:()=>h.success("Brukeren er slettet"),onError:a=>h.error(a.message??"Kunne ikke slette bruker")}),o=async()=>{if(!t)return;const a=await R.get(`/klubb/${t}/bruker/meg/egen-data`,{requireAuth:!0,responseType:"blob"}),i=a.data,c=a.headers?.["content-disposition"]?.match(/filename\*=UTF-8''([^;]+)|filename="?([^"]+)"?/i),b=decodeURIComponent(c?.[1]??c?.[2]??"")||`banebooking-data-${new Date().toISOString().slice(0,10)}.json`,u=URL.createObjectURL(i),m=document.createElement("a");m.href=u,m.download=b,document.body.appendChild(m),m.click(),m.remove(),URL.revokeObjectURL(u)};return{bruker:n.data,laster:n.isLoading,error:n.error,refetch:n.refetch,lastNedEgenData:o,oppdaterVisningsnavn:s,slettMeg:r}}function Z({name:t,title:n,description:s,value:r,options:o,onChange:a,className:i=""}){return e.jsx(p,{title:n,description:s,className:i,children:e.jsx("div",{className:"space-y-2",children:o.map(l=>e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer select-none",children:[e.jsx("input",{type:"radio",name:t,checked:r===l.value,onChange:()=>a(l.value)}),e.jsx("span",{children:l.label})]},String(l.value)))})})}const f=50,ee=/^[\p{L}\d\s.@'_%+-]{2,}$/u;function ne({slug:t}){const{bruker:n,laster:s,oppdaterVisningsnavn:r}=V(t),{mutateAsync:o,isPending:a}=r,[i,l]=g.useState("epost"),[c,v]=g.useState(""),[b,u]=g.useState(null);g.useEffect(()=>{if(!n)return;const d=n.visningsnavn?.trim();!d||d===n.epost?(l("epost"),v("")):(l("navn"),v(d))},[n]);const m=g.useMemo(()=>n?i==="epost"?n.visningsnavn!==n.epost:c.trim()!==(n.visningsnavn??"").trim():!1,[n,i,c]),C=async()=>{if(!n)return;if(i==="epost"){u(null),await o({visningsnavn:n.epost});return}const d=c.trim();if(d.length===0)return u("Visningsnavn kan ikke være tomt.");if(d.length<3)return u("Visningsnavn må være minst 3 tegn.");if(!ee.test(d))return u("Visningsnavn inneholder ugyldige tegn.");if(d.length>f)return u(`Visningsnavn kan ikke være lengre enn ${f} tegn.`);u(null),await o({visningsnavn:d})};return s||!n?e.jsx(S,{}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{title:"Min profil",description:"Velg hva som vises som navnet ditt i appen.",children:e.jsxs(x,{children:[e.jsx(Z,{name:"visningsnavn-mode",title:"Visningsnavn",description:"Velg e-post eller et eget navn.",value:i,onChange:d=>{l(d),u(null),d==="epost"&&v("")},options:[{value:"epost",label:`E-post (${n.epost})`},{value:"navn",label:"Eget navn"}]}),e.jsx(p,{title:"Eget navn",description:`Maks ${f} tegn.`,right:e.jsx(w,{type:"button",size:"sm",disabled:!m||a,onClick:()=>void C(),children:a?"Lagrer...":"Lagre"}),className:i==="navn"?"":"opacity-50",children:e.jsx(O,{id:"visningsnavn",label:"Eget navn",hideLabel:!0,error:b,className:"space-y-0",children:e.jsx(M,{id:"visningsnavn",value:i==="navn"?c:"",maxLength:f,placeholder:"f.eks. Ola Nordmann",onChange:d=>v(d.target.value),disabled:i!=="navn",className:b?"border-destructive":""})})})]})}),e.jsx(k,{title:"Konto",description:"Denne informasjonen kan bare endres av klubbadministrator.",children:e.jsxs(x,{children:[e.jsx(y,{label:"Brukernavn / ID",value:n.epost}),e.jsx(y,{label:"Tilgang",value:n.roller.join(", ")})]})})]})}function te({slettMeg:t}){const{signOut:n}=B(),[s,r]=g.useState(!1),o=async()=>{try{await t.mutateAsync(),r(!1),await n()}catch{}};return e.jsxs(I,{open:s,onOpenChange:r,children:[e.jsx(U,{asChild:!0,children:e.jsx(w,{variant:"destructive",disabled:t.isPending,children:t.isPending?"Sletter...":"Slett min bruker"})}),e.jsxs(q,{children:[e.jsxs(K,{children:[e.jsx(_,{children:"Er du sikker?"}),e.jsx(z,{children:"Dette vil slette din bruker og all tilknytning permanent. Denne handlingen kan ikke angres."})]}),e.jsxs(G,{children:[e.jsx(Q,{disabled:t.isPending,children:"Avbryt"}),e.jsx(X,{variant:"destructive",onClick:o,disabled:t.isPending,children:t.isPending?"Sletter...":"Slett bruker"})]})]})]})}function se({slug:t}){const{bruker:n,laster:s,lastNedEgenData:r,slettMeg:o}=V(t),{isPending:a}=o;if(s||!n)return e.jsx(S,{});const i=n.vilkaarAkseptertDato?`Akseptert ${L(n.vilkaarAkseptertDato)}${n.vilkaarVersjon?` (versjon ${n.vilkaarVersjon})`:""}`:"Ikke registrert";return e.jsxs("div",{className:"space-y-4",children:[e.jsx(k,{title:"Persondata",description:"Her kan du se vilkår og laste ned egne data.",children:e.jsxs(x,{children:[e.jsx(y,{label:"Vilkår",description:"Vilkårene aksepteres automatisk ved første innlogging.",value:i}),e.jsx(p,{title:"Les vilkårene",description:"Åpnes i ny fane.",right:e.jsx(H,{to:`/${t}/vilkaar`,className:"text-sm underline text-primary hover:text-primary/80",target:"_blank",rel:"noopener noreferrer",children:"Åpne"})}),e.jsx(p,{title:"Last ned dine data",description:"JSON med registrerte opplysninger og bookinger.",right:e.jsx(w,{onClick:r,size:"sm",variant:"outline",disabled:a,children:a?"Laster...":"Last ned"})})]})}),e.jsx(k,{title:"Slett bruker",description:"Sletter bruker og all tilknyttet data permanent.",children:e.jsx(x,{children:e.jsx(p,{title:"Fareområde",description:"Dette kan ikke angres.",right:e.jsx(te,{slettMeg:o})})})})]})}function re(t,n=!1){const s=A(["mineBookinger",t,n],`/klubb/${t}/bookinger/mine${n?"?inkluderHistoriske=true":""}`,{requireAuth:!0,enabled:!!t,staleTime:6e4}),r=g.useRef(!1);return g.useEffect(()=>{if(!s.error){r.current=!1;return}r.current||(h.error(s.error.message??"Ukjent feil ved henting av bookinger"),r.current=!0)},[s.error]),s}function ie({slug:t}){const[n,s]=g.useState(!1),{data:r=[],isLoading:o}=re(t,n),a=[...r].sort((i,l)=>{const c=new Date(l.dato).getTime()-new Date(i.dato).getTime();return c!==0?c:l.startTid.localeCompare(i.startTid)});return o?e.jsx(S,{}):e.jsx("div",{className:"space-y-4",children:e.jsx(k,{title:"Bookinger",description:"Se kommende bookinger og velg om du vil inkludere tidligere.",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(x,{children:e.jsx(p,{title:"Vis også tidligere bookinger",description:"Inkluder bookinger som allerede er gjennomført.",right:e.jsx(F,{checked:n,onCheckedChange:s})})}),a.length===0?e.jsx("div",{className:"text-sm text-muted-foreground italic",children:n?"Du har ingen registrerte bookinger.":"Du har ingen kommende bookinger."}):e.jsx("div",{className:"overflow-x-auto rounded-md border bg-background",children:e.jsxs(J,{className:"text-sm",children:[e.jsx(W,{children:e.jsxs(T,{children:[e.jsx(j,{className:"whitespace-nowrap",children:"Dato"}),e.jsx(j,{className:"whitespace-nowrap",children:"Tid"}),e.jsx(j,{className:"whitespace-nowrap",children:"Bane"})]})}),e.jsx(Y,{children:a.map((i,l)=>e.jsxs(T,{children:[e.jsx(N,{className:"whitespace-nowrap",children:L(i.dato)}),e.jsxs(N,{className:"whitespace-nowrap",children:[i.startTid,"–",i.sluttTid]}),e.jsx(N,{className:"min-w-[10rem]",children:i.baneNavn})]},l))})]})})]})})})}function fe(){const[t,n]=g.useState("bookinger"),s=E();return e.jsx($,{children:e.jsx(P,{items:[{value:"bookinger",label:"Mine bookinger",content:e.jsx(ie,{slug:s})},{value:"profil",label:"Min profil",content:e.jsx(ne,{slug:s})},{value:"persondata",label:"Persondata",content:e.jsx(se,{slug:s})}],value:t,onValueChange:n})})}export{fe as default};
