import{j as a,r as n}from"./shadcn-mOdBhBu9.js";import{u as S,e as te,f as ne,d as le,a as re,b as ie,t as V}from"./datoUtils-CMdMNzgI.js";import{u as de,T as oe,a as ce,b as E,c as f,d as ge,e as p}from"./table-DtfghYQR.js";import{j as H,k as ue,L as me,B as g,t as u}from"./index-DACapAhf.js";import{C as F}from"./checkbox-CS2usIo5.js";import{D as z}from"./DatoVelger-C0u8nsI9.js";import{F as xe}from"./FormField-Yytd7LCQ.js";import{S as he}from"./SelectField-Lp4Czzit.js";import{D as fe,b as pe,c as ke,d as je,f as ve}from"./dialog-B_iTf-mM.js";import"./react-RGnvvjkK.js";import"./useBaner-DgsCLYux.js";import"./lucide-ByENZzyU.js";import"./index-Bb2dXpgu.js";import"./FieldWrapper-BhwyvJQg.js";import"./index-BRMy6Ggk.js";function be({className:o,...r}){return a.jsx("div",{"data-slot":"card",className:H("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",o),...r})}function De({className:o,...r}){return a.jsx("div",{"data-slot":"card-content",className:H("px-6",o),...r})}function Ee(){const{slug:o}=ue(),{baner:r,tilgjengeligeTidspunkter:k,forhandsvisning:c,forhandsvis:P,clearForhandsvisning:y,opprett:$,isLoading:M,isLoadingForhandsvisning:B}=de(o),[j,U]=n.useState([]),[v,I]=n.useState([]),[b,A]=n.useState([]),[i,R]=n.useState(new Date),[d,q]=n.useState(new Date),[m,G]=n.useState(!1),[x,J]=n.useState(!1),[h,Q]=n.useState(!1),[D,W]=n.useState("Annet"),[T,X]=n.useState(""),[Y,N]=n.useState(!1),C=n.useMemo(()=>{if(!i||!d)return S;const e=new Set,t=new Date(i),l=new Date(d);for(let s=new Date(t);s<=l;s.setDate(s.getDate()+1)){const ae=s.getDay(),se=le[ae],O=te[se];O&&e.add(O)}return S.filter(s=>e.has(s))},[i,d]);n.useEffect(()=>{m&&U(r.map(e=>e.id)),x&&I(C),h&&A(k)},[m,x,h,r,C,k]);const w=(e,t)=>{t(l=>l.includes(e)?l.filter(s=>s!==e):[...l,e])};function K(){if(!i||!d)return u.warning("Du må velge start- og sluttdato"),null;if(j.length===0)return u.warning("Du må velge minst én bane"),null;if(b.length===0)return u.warning("Du må velge minst ett tidspunkt"),null;if(v.length===0)return u.warning("Du må velge minst én ukedag"),null;const e=re(i,d),t=v.map(l=>ie[l]).filter(l=>e.has(l));return t.length===0?(u.warning("Ingen av de valgte ukedagene finnes i datointervallet"),null):{tittel:D,beskrivelse:T,kategori:D,startDato:V(i),sluttDato:V(d),ukedager:t,tidspunkter:b,baneIder:j}}const L=n.useMemo(()=>[...c.ledige,...c.konflikter].sort((e,t)=>e.dato.localeCompare(t.dato)||e.startTid.localeCompare(t.startTid)||e.baneId.localeCompare(t.baneId)),[c]),Z=L.length>0,_=async()=>{const e=K();e&&(await $(e),y(),N(!1))},ee=async()=>{const e=K();e&&(N(!0),await P(e))};return M?a.jsx(me,{}):a.jsxs("div",{className:"max-w-screen-md mx-auto px-1 py-1",children:[a.jsx(be,{children:a.jsxs(De,{className:"p-4 space-y-4",children:[a.jsx(he,{id:"kategori",label:"Kategori",value:D,onChange:e=>W(e),options:["Trening","Turnering","Klubbmersterskap","Kurs","Lagkamp","Stigespill","Dugnad","Vedlikehold","Sosialt","Annet"].map(e=>({label:e,value:e}))}),a.jsx(xe,{id:"beskrivelse",label:"Beskrivelse",value:T,onChange:e=>X(e.target.value)}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Fra"}),a.jsx(z,{value:i,onChange:R,visNavigering:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Til"}),a.jsx(z,{value:d,onChange:q,visNavigering:!0})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(F,{id:"alleBaner",checked:m,onCheckedChange:e=>G(!!e)}),a.jsx("label",{htmlFor:"alleBaner",className:"text-sm",children:"Alle baner"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:r.map(e=>a.jsx(g,{variant:j.includes(e.id)?"default":"outline",size:"sm",onClick:()=>w(e.id,U),disabled:m,children:e.navn},e.id))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(F,{id:"alleUkedager",checked:x,onCheckedChange:e=>J(!!e)}),a.jsx("label",{htmlFor:"alleUkedager",className:"text-sm",children:"Alle gyldige dager"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:S.map(e=>a.jsx(g,{variant:v.includes(e)?"default":"outline",size:"sm",onClick:t=>{t.preventDefault(),w(e,I)},disabled:x||!C.includes(e),children:e},e))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(F,{id:"alleTidspunkter",checked:h,onCheckedChange:e=>Q(!!e)}),a.jsx("label",{htmlFor:"alleTidspunkter",className:"text-sm",children:"Alle tidspunkter"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:k.map(e=>a.jsx(g,{variant:b.includes(e)?"default":"outline",size:"sm",onClick:()=>w(e,A),disabled:h,children:e},e))})]}),a.jsx("div",{className:"flex justify-end pt-4",children:a.jsx(g,{type:"button",onClick:ee,children:"Forhåndsvis bookinger"})})]})}),a.jsx(fe,{open:Y,onOpenChange:e=>{N(e),e||y()},children:a.jsxs(pe,{className:"max-w-3xl",children:[a.jsx(ke,{children:a.jsx(je,{children:"Forhåndsvis bookingene"})}),B?a.jsx("p",{className:"text-muted-foreground italic",children:"Laster forhåndsvisning…"}):Z?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"overflow-auto max-h-[60vh] border rounded-md",children:a.jsxs(oe,{className:"text-sm",children:[a.jsx(ce,{children:a.jsxs(E,{children:[a.jsx(f,{children:"Dato"}),a.jsx(f,{children:"Klokkeslett"}),a.jsx(f,{children:"Bane"}),a.jsx(f,{children:"Beskrivelse"})]})}),a.jsx(ge,{children:L.map(e=>{const t=r.find(s=>s.id===e.baneId),l=c.konflikter.some(s=>s.baneId===e.baneId&&s.dato===e.dato&&s.startTid===e.startTid&&s.sluttTid===e.sluttTid);return a.jsxs(E,{className:l?"bg-yellow-100":"",children:[a.jsx(p,{children:ne(e.dato)}),a.jsxs(p,{children:[e.startTid," – ",e.sluttTid]}),a.jsx(p,{children:t?.navn??"(ukjent bane)"}),a.jsxs(p,{children:[T,l&&a.jsx("span",{className:"ml-2 text-yellow-700 text-xs italic",children:"(Konflikt)"})]})]},`${e.dato}-${e.baneId}-${e.startTid}`)})})]})}),a.jsx(ve,{className:"mt-3",children:a.jsxs(g,{type:"button",onClick:_,disabled:B,children:["Opprett ",c.ledige.length," bookinger"]})})]}):a.jsx("p",{className:"text-muted-foreground italic",children:"Ingen bookinger å vise."})]})})]})}export{Ee as default};
