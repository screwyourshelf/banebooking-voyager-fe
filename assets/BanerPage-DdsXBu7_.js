import{r as o,j as n}from"./shadcn-mOdBhBu9.js";import{u as N}from"./useSlug-DMGJr7eH.js";import{P as L}from"./Page-pTszYvfk.js";import{S as C}from"./SimpleTabsLazy-Cmj-F3Ld.js";import{u as k}from"./useBaner-DgsCLYux.js";import{B as j}from"./index-DACapAhf.js";import{F as m}from"./FormField-Yytd7LCQ.js";import{S as E}from"./SelectField-Lp4Czzit.js";import{S as P}from"./SwitchRow-Dtxv7Wv4.js";import{S as h}from"./SettingsSection-DfNPesyK.js";import"./react-RGnvvjkK.js";import"./lucide-ByENZzyU.js";import"./FieldWrapper-BhwyvJQg.js";import"./index-Bb2dXpgu.js";import"./switch-CqkRJ2Qn.js";const x="rediger.valgtBaneId";function R({slug:c}){const{baner:s,isLoading:r,oppdaterBane:u}=k(c,!0),[g,d]=o.useState({}),[t,i]=o.useState(()=>{const e=sessionStorage.getItem(x);return e&&e!=="null"?e:null}),a=s.find(e=>e.id===t)??null,l=t?g[t]??null:null;o.useEffect(()=>{sessionStorage.setItem(x,t??"null")},[t]),o.useEffect(()=>{t&&!s.some(e=>e.id===t)&&i(null)},[s,t]),o.useEffect(()=>{!t&&s.length>0&&i(s[0].id)},[s,t]);function f(e,b,v){d(p=>({...p,[e]:{...p[e]??s.find(B=>B.id===e),[b]:v}}))}async function y(){if(!t)return;const e=g[t];if(e)try{await u.mutateAsync({id:t,dto:e}),d(b=>{const v={...b};return delete v[t],v})}catch{}}const S=!!a&&!!l&&!(l.navn===a.navn&&l.beskrivelse===a.beskrivelse&&l.aktiv===a.aktiv);return r?n.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Laster..."}):n.jsx(h,{title:"Rediger bane",description:"Velg en bane og oppdater informasjon.",children:n.jsxs("form",{className:"space-y-4",onSubmit:e=>{e.preventDefault(),y()},children:[n.jsx(E,{id:"velg-bane",label:"Velg bane",value:t??"",onChange:e=>i(e||null),options:s.map(e=>({label:`${e.navn} ${e.aktiv?"":"(inaktiv)"}`,value:e.id}))}),a?n.jsxs(n.Fragment,{children:[n.jsx(m,{id:"navn",label:"Navn",value:l?.navn??a.navn,onChange:e=>f(a.id,"navn",e.target.value)}),n.jsx(m,{id:"beskrivelse",label:"Beskrivelse",value:l?.beskrivelse??a.beskrivelse,onChange:e=>f(a.id,"beskrivelse",e.target.value)}),n.jsx(P,{title:"Aktiv",description:"Avgjør om banen er tilgjengelig for booking.",checked:l?.aktiv??a.aktiv,onCheckedChange:e=>f(a.id,"aktiv",e)}),n.jsx("div",{className:"flex justify-end",children:n.jsx(j,{size:"sm",type:"submit",disabled:!S||u.isPending,children:u.isPending?"Lagrer...":"Lagre"})})]}):n.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ingen baner funnet."})]})})}function F({slug:c}){const{opprettBane:s}=k(c),[r,u]=o.useState({navn:"",beskrivelse:""}),[g,d]=o.useState(null);async function t(){const i=r.navn.trim();if(!i){d("Navn er påkrevd.");return}d(null);try{await s.mutateAsync({...r,navn:i}),u({navn:"",beskrivelse:""})}catch{}}return n.jsx(h,{title:"Ny bane",description:"Legg til en ny bane i klubben.",children:n.jsxs("form",{className:"space-y-3",onSubmit:i=>{i.preventDefault(),t()},children:[n.jsx(m,{id:"ny-navn",label:"Navn",value:r.navn,error:g,onChange:i=>{const a=i.target.value;u(l=>({...l,navn:a})),g&&a.trim()&&d(null)}}),n.jsx(m,{id:"ny-beskrivelse",label:"Beskrivelse",value:r.beskrivelse,onChange:i=>u(a=>({...a,beskrivelse:i.target.value}))}),n.jsx(j,{size:"sm",type:"submit",disabled:s.isPending,children:s.isPending?"Legger til...":"Legg til"})]})})}function J(){const[c,s]=o.useState("rediger"),r=N();return n.jsx(L,{children:n.jsx(C,{items:[{value:"rediger",label:"Rediger bane",content:n.jsx(R,{slug:r})},{value:"ny",label:"Ny bane",content:n.jsx(F,{slug:r})}],value:c,onValueChange:s})})}export{J as default};
