import{r as o,j as e}from"./shadcn-ciDZoPHa.js";import{u as D,a as E,b as V,c as P,t as N,s as q,L as Q,B as m,T as S,f as T}from"./index-DwBi739w.js";import{P as U,F as v}from"./FieldRow-CWaEdzBa.js";import{F as C,a as L}from"./FieldList-BQUYp8es.js";import{S as z}from"./switch-HPBUd7c1.js";import{D as $,b as I,c as O,d as G,f as H}from"./dialog-BZMpItL7.js";import"./react-RGnvvjkK.js";import"./lucide-DUUYvuJp.js";import"./index-4Vwc2qQR.js";import"./index-DkVNnv8l.js";function W(){const r=D(),k=E(),d=["admin-brukere",r],i=V(d,`/klubb/${r}/bruker/admin/bruker`,{requireAuth:!0,staleTime:3e4}),p=P("put",({brukerId:l})=>`/klubb/${r}/bruker/admin/bruker/${l}`,{onSuccess:async()=>{N.success("Bruker oppdatert"),await k.invalidateQueries({queryKey:d})},onError:l=>N.error(l.message??"Kunne ikke oppdatere bruker"),retry:!1}),u=async(l,a)=>{await p.mutateAsync({brukerId:l,rolle:a.rolle,visningsnavn:a.visningsnavn})};return{brukere:i.data??[],laster:i.isLoading,oppdaterLaster:p.isPending,oppdater:u,hentBrukere:i.refetch,error:i.error?.message??null}}const _=["Medlem","Utvidet","KlubbAdmin"];function B(r){return r?r.toLowerCase().startsWith("slettet_"):!1}function ie(){const{bruker:r,laster:k}=q(),{brukere:d,laster:i,oppdater:p,oppdaterLaster:u}=W(),l=r?.roller.includes("KlubbAdmin"),[a,M]=o.useState(""),[j,w]=o.useState(!1),[c,b]=o.useState([]),[x,g]=o.useState(null),[h,f]=o.useState({rolle:"Medlem",visningsnavn:""}),y=o.useMemo(()=>{const s=a.toLowerCase().trim();return d.filter(t=>!(!j&&B(t.epost))).filter(t=>{if(c.length===0)return!0;const n=t.roller?.[0]??"Medlem";return c.includes(n)}).filter(t=>s?t.epost?.toLowerCase().includes(s)||t.visningsnavn?.toLowerCase().includes(s):!0)},[d,a,j,c]),A=s=>{g(s),f({rolle:s.roller?.[0]??"Medlem"??"Medlem",visningsnavn:s.visningsnavn??""})},R=async()=>{x&&(await p(x.id,{rolle:h.rolle,visningsnavn:h.visningsnavn}),g(null))};function F(s){b(t=>t.includes(s)?t.filter(n=>n!==s):[...t,s])}return k?e.jsx(Q,{}):l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(U,{title:"Brukere",description:"Søk etter brukere og endre rolle eller visningsnavn.",children:[e.jsx(C,{children:e.jsxs(L,{children:[e.jsxs(v,{title:"Filter på rolle",description:"",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:_.map(s=>{const t=c.includes(s);return e.jsx(m,{type:"button",size:"sm",variant:t?"default":"outline",onClick:()=>F(s),className:"h-8 px-3",children:s},s)})}),c.length>0?e.jsx("div",{className:"mt-2",children:e.jsx(m,{type:"button",size:"sm",variant:"ghost",onClick:()=>b([]),className:"h-8 px-2 text-muted-foreground",children:"Nullstill filter"})}):null]}),e.jsx(v,{title:"Vis slettede brukere",description:"Inkluder brukere som er anonymisert eller slettet.",right:e.jsx("div",{className:"pt-0.5",children:e.jsx(z,{checked:j,onCheckedChange:w})})}),e.jsx(v,{title:"Søk",description:"",children:e.jsx(S,{id:"brukersok",label:"Søk",hideLabel:!0,value:a,onValueChange:M,inputProps:{placeholder:"Søk på e-post eller visningsnavn…",inputMode:"search",className:"bg-background"}})})]})}),e.jsx("div",{className:"mt-4",children:i?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Laster brukere…"}):y.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ingen brukere funnet."}):e.jsx(C,{children:e.jsx(L,{children:y.map(s=>{const t=s.id===r?.id,n=B(s.epost),K=s.roller?.[0]??"Medlem";return e.jsx(v,{title:s.epost??"Ukjent bruker",description:s.visningsnavn||(n?"Slettet/anonymisert":""),right:!t&&!n?e.jsx(m,{type:"button",size:"sm",variant:"outline",onClick:()=>A(s),children:"Rediger"}):null,className:T(n&&"opacity-70"),children:e.jsxs("div",{className:"text-sm text-foreground",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rolle: "}),K,n?e.jsx("span",{className:"text-muted-foreground",children:" (slettet)"}):null]})},s.id)})})})})]}),x?e.jsx($,{open:!0,onOpenChange:s=>{s||g(null)},children:e.jsxs(I,{children:[e.jsx(O,{children:e.jsx(G,{children:"Rediger bruker"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Bruker"}),e.jsx("div",{className:"text-sm font-medium break-words",children:x.epost})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Visningsnavn"}),e.jsx(S,{id:"visningsnavn",label:"Visningsnavn",hideLabel:!0,value:h.visningsnavn,onValueChange:s=>f(t=>({...t,visningsnavn:s})),inputProps:{placeholder:"Valgfritt",className:"bg-background"}})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Rolle"}),e.jsxs("select",{className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:h.rolle,onChange:s=>f(t=>({...t,rolle:s.target.value})),children:[e.jsx("option",{value:"Medlem",children:"Medlem"}),e.jsx("option",{value:"Utvidet",children:"Utvidet"}),e.jsx("option",{value:"KlubbAdmin",children:"KlubbAdmin"})]})]})]}),e.jsxs(H,{children:[e.jsx(m,{variant:"ghost",onClick:()=>g(null),disabled:u,children:"Avbryt"}),e.jsx(m,{onClick:R,disabled:u,children:u?"Lagrer...":"Lagre"})]})]})}):null]}):e.jsx("p",{className:"text-sm text-destructive px-2 py-2 text-center",children:"Du har ikke tilgang til denne siden."})}export{ie as default};
