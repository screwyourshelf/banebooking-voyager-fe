import{r as a,j as e}from"./shadcn-V64FgQuT.js";import{f as S,t as p,d as K,i as D,L as F,B as f,j as M}from"./index-CruuviPJ.js";import{C as H,a as P}from"./card-ylY7M-bu.js";import{F as N}from"./FormField-x4wmGKYU.js";import{S as U}from"./SelectField-CtIwQEP3.js";import{D as V,a as $,b as q,c as I,d as O}from"./dialog-CJjfc08s.js";import{T as z,a as G,b as B,c as L,d as J,e as R}from"./index-SB0lL7E3.js";import"./react-D5d5vywP.js";import"./lucide-VYBZz5NY.js";import"./FieldWrapper-d3x2wDOw.js";import"./index-uoXEFuNP.js";async function Q(s){const t=await S(`/api/klubb/${s}/bruker/admin/bruker`,{method:"GET"},!0);if(!t.ok){const n=await t.text();throw new Error(n||"Kunne ikke hente brukere")}return await t.json()}async function W(s,t,n){const o=await S(`/api/klubb/${s}/bruker/admin/bruker/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)},!0);if(!o.ok){const i=await o.text();throw new Error(i||"Kunne ikke oppdatere bruker")}}function X(s){const[t,n]=a.useState([]),[o,i]=a.useState(!1),d=a.useCallback(async()=>{if(s){i(!0);try{const l=await Q(s);n(l)}catch(l){p.error(l instanceof Error?l.message:"Kunne ikke hente brukere."),n([])}finally{i(!1)}}},[s]);a.useEffect(()=>{d()},[d]);const u=a.useCallback(async(l,m)=>{if(!s)return;const c=p.loading("Lagrer endringer...");try{await W(s,l,m),p.success("Bruker oppdatert",{id:c}),await d()}catch(x){p.error(x instanceof Error?x.message:"Kunne ikke oppdatere bruker",{id:c})}},[s,d]);return{brukere:t,laster:o,oppdater:u,hentBrukere:d}}function oe(){const{slug:s}=K(),{bruker:t,laster:n}=D(s),{brukere:o,laster:i,oppdater:d}=X(s),[u,l]=a.useState(""),[m,c]=a.useState(null),[x,v]=a.useState("Medlem"),[j,b]=a.useState(""),[g,w]=a.useState(!1),T=t==null?void 0:t.roller.includes("KlubbAdmin"),k=a.useMemo(()=>{const r=u.toLowerCase().trim();return o.filter(h=>{var y,C;return((y=h.epost)==null?void 0:y.toLowerCase().includes(r))||((C=h.visningsnavn)==null?void 0:C.toLowerCase().includes(r))})},[o,u]),E=r=>{c(r),v(r.roller[0]??"Medlem"),b(r.visningsnavn??"")},A=async()=>{if(!(!s||!m)){w(!0);try{await d(m.id,{rolle:x,visningsnavn:j}),c(null)}finally{w(!1)}}};return n?e.jsx(F,{}):T?e.jsxs("div",{className:"max-w-screen-sm mx-auto px-2 py-2 space-y-4",children:[e.jsx(H,{children:e.jsxs(P,{className:"p-4 space-y-4",children:[e.jsx(N,{id:"sok",label:"SÃ¸k etter bruker",value:u,onChange:r=>l(r.target.value),helpText:"F.eks. navn eller e-post"}),i&&e.jsx("p",{children:"Laster brukere..."}),!i&&k.length===0&&e.jsx("p",{className:"text-muted-foreground",children:"Ingen brukere funnet"}),!i&&k.length>0&&e.jsx("div",{className:"max-w-full overflow-x-auto border rounded-md",children:e.jsxs(z,{className:"text-sm w-full",children:[e.jsx(G,{children:e.jsxs(B,{children:[e.jsx(L,{className:"w-[140px]",children:"Bruker"}),e.jsx(L,{className:"w-2/6",children:"Rolle"})]})}),e.jsx(J,{children:k.map(r=>{const h=r.id===(t==null?void 0:t.id);return e.jsxs(B,{children:[e.jsx(R,{className:"whitespace-nowrap max-w-[180px]",children:e.jsxs("div",{className:"flex justify-between items-start gap-2 overflow-hidden",children:[e.jsxs("div",{className:"flex-1 overflow-hidden",children:[e.jsx("div",{className:"font-medium truncate",title:r.epost,children:r.epost}),r.visningsnavn&&e.jsx("div",{className:"text-muted-foreground text-xs truncate",title:r.visningsnavn,children:r.visningsnavn})]}),!h&&e.jsxs(f,{variant:"ghost",size:"icon",onClick:()=>E(r),title:"Rediger",className:"text-muted-foreground hover:text-primary",children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{className:"sr-only",children:"Rediger"})]})]})}),e.jsx(R,{className:"whitespace-nowrap",children:r.roller[0]??"Medlem"})]},r.id)})})]})})]})}),m&&e.jsx(V,{open:!0,onOpenChange:()=>c(null),children:e.jsxs($,{children:[e.jsx(q,{children:e.jsx(I,{children:"Rediger bruker"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(N,{id:"visningsnavn",label:"Visningsnavn",value:j,onChange:r=>b(r.target.value)}),e.jsx(U,{id:"rolle",label:"Rolle",value:x,onChange:r=>v(r),options:[{label:"Medlem",value:"Medlem"},{label:"Utvidet",value:"Utvidet"},{label:"KlubbAdmin",value:"KlubbAdmin"}]})]}),e.jsxs(O,{children:[e.jsx(f,{variant:"ghost",onClick:()=>c(null),disabled:g,children:"Avbryt"}),e.jsx(f,{onClick:A,disabled:g,children:g?"Lagrer...":"Lagre"})]})]})})]}):e.jsx("p",{className:"text-sm text-destructive px-2 py-2 text-center",children:"Du har ikke tilgang til denne siden."})}export{oe as default};
