import{r as n,j as a}from"./shadcn-BfUXmlP3.js";import{u as le,g as N,h as ie,T as re,a as de,b as V,c as x,d as oe,e as p,f as ce,i as ge,j as ue,k as me,t as L}from"./datoUtils-Cf88NydY.js";import{T as he,a as xe,b as E,c as z}from"./useBaner-BRpSQ6Fy.js";import{d as pe,L as fe,B as f,t as o}from"./index-CZ7yxNIj.js";import{D as O,C as w}from"./checkbox-CuQzlf-o.js";import{C as P,a as $}from"./FieldWrapper--7bcjA_e.js";import{F as je}from"./FormField-BuG9kLHv.js";import{S as ke}from"./SelectField-6ZkCjNlN.js";import"./react-D5d5vywP.js";import"./lucide-CZTSiasK.js";import"./index-36j8ZHWB.js";function Ue(){const{slug:H}=pe(),{baner:c,tilgjengeligeTidspunkter:j,forhandsvisning:d,setForhandsvisning:R,forhandsvis:M,opprett:q,isLoading:S}=le(H),[g,B]=n.useState([]),[k,F]=n.useState([]),[v,y]=n.useState([]),[i,G]=n.useState(new Date),[r,J]=n.useState(new Date),[u,Q]=n.useState(!1),[m,W]=n.useState(!1),[h,X]=n.useState(!1),[b,Y]=n.useState("Annet"),[T,Z]=n.useState(""),[_,U]=n.useState("oppsett"),ee=()=>R({ledige:[],konflikter:[]}),C=n.useMemo(()=>{if(!i||!r)return N;const e=new Set,s=new Date(i),l=new Date(r);for(let t=new Date(s);t<=l;t.setDate(t.getDate()+1)){const te=t.getDay(),ne=ge[te],K=ie[ne];K&&e.add(K)}return N.filter(t=>e.has(t))},[i,r]);n.useEffect(()=>{u&&B(c.map(e=>e.id)),m&&F(C),h&&y(j)},[u,m,h,c,C,j]);const D=(e,s)=>{s(l=>l.includes(e)?l.filter(t=>t!==e):[...l,e])};function A(){if(!i||!r)return o.warning("Du må velge start- og sluttdato"),null;if(g.length===0)return o.warning("Du må velge minst én bane"),null;if(v.length===0)return o.warning("Du må velge minst ett tidspunkt"),null;if(k.length===0)return o.warning("Du må velge minst én ukedag"),null;const e=ue(i,r),s=k.map(l=>me[l]).filter(l=>e.has(l));return s.length===0?(o.warning("Ingen av de valgte ukedagene finnes i datointervallet"),null):{tittel:b,beskrivelse:T,kategori:b,startDato:L(i),sluttDato:L(r),ukedager:s,tidspunkter:v,baneIder:g}}const ae=async()=>{const e=A();e&&(await q(e),ee(),U("oppsett"))},se=async e=>{if(U(e),e==="forhandsvisning"){const s=A();s&&await M(s)}},I=[...d.ledige,...d.konflikter].sort((e,s)=>e.dato.localeCompare(s.dato)||e.startTid.localeCompare(s.startTid)||e.baneId.localeCompare(s.baneId));return a.jsx("div",{className:"max-w-screen-md mx-auto px-1 py-1",children:S?a.jsx(fe,{}):a.jsxs(he,{value:_,onValueChange:se,children:[a.jsxs(xe,{className:"mb-4",children:[a.jsx(E,{value:"oppsett",children:"Oppsett"}),a.jsxs(E,{value:"forhandsvisning",disabled:g.length===0,children:["Forhåndsvisning (",d.ledige.length,")"]})]}),a.jsx(z,{value:"oppsett",children:a.jsx(P,{children:a.jsxs($,{className:"p-4 space-y-4",children:[a.jsx(ke,{id:"kategori",label:"Kategori",value:b,onChange:e=>Y(e),options:["Trening","Turnering","Klubbmersterskap","Kurs","Lagkamp","Stigespill","Dugnad","Vedlikehold","Sosialt","Annet"].map(e=>({label:e,value:e}))}),a.jsx(je,{id:"beskrivelse",label:"Beskrivelse",value:T,onChange:e=>Z(e.target.value)}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Fra"}),a.jsx(O,{value:i,onChange:G,visNavigering:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Til"}),a.jsx(O,{value:r,onChange:J,visNavigering:!0})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(w,{id:"alleBaner",checked:u,onCheckedChange:e=>Q(!!e)}),a.jsx("label",{htmlFor:"alleBaner",className:"text-sm",children:"Alle baner"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:c.map(e=>a.jsx(f,{variant:g.includes(e.id)?"default":"outline",size:"sm",onClick:()=>D(e.id,B),disabled:u,children:e.navn},e.id))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(w,{id:"alleUkedager",checked:m,onCheckedChange:e=>W(!!e)}),a.jsx("label",{htmlFor:"alleUkedager",className:"text-sm",children:"Alle gyldige dager"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:N.map(e=>a.jsx(f,{variant:k.includes(e)?"default":"outline",size:"sm",onClick:s=>{s.preventDefault(),D(e,F)},disabled:m||!C.includes(e),children:e},e))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(w,{id:"alleTidspunkter",checked:h,onCheckedChange:e=>X(!!e)}),a.jsx("label",{htmlFor:"alleTidspunkter",className:"text-sm",children:"Alle tidspunkter"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:j.map(e=>a.jsx(f,{variant:v.includes(e)?"default":"outline",size:"sm",onClick:()=>D(e,y),disabled:h,children:e},e))})]})]})})}),a.jsx(z,{value:"forhandsvisning",children:a.jsx(P,{children:a.jsx($,{className:"p-4 space-y-4",children:I.length===0?a.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ingen bookinger tilgjengelig."}):a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"overflow-auto max-h-[60vh] border rounded-md",children:a.jsxs(re,{className:"text-sm",children:[a.jsx(de,{children:a.jsxs(V,{children:[a.jsx(x,{children:"Dato"}),a.jsx(x,{children:"Klokkeslett"}),a.jsx(x,{children:"Bane"}),a.jsx(x,{children:"Beskrivelse"})]})}),a.jsx(oe,{children:I.map(e=>{const s=c.find(t=>t.id===e.baneId),l=d.konflikter.some(t=>t.baneId===e.baneId&&t.dato===e.dato&&t.startTid===e.startTid&&t.sluttTid===e.sluttTid);return a.jsxs(V,{className:l?"bg-yellow-100":"",children:[a.jsx(p,{children:ce(e.dato)}),a.jsxs(p,{children:[e.startTid," – ",e.sluttTid]}),a.jsx(p,{children:(s==null?void 0:s.navn)??"(ukjent bane)"}),a.jsxs(p,{children:[T,l&&a.jsx("span",{className:"ml-2 text-yellow-700 text-xs italic",children:"(Konflikt)"})]})]},`${e.dato}-${e.baneId}-${e.startTid}`)})})]})}),a.jsx("div",{className:"flex justify-end mt-3",children:a.jsxs(f,{type:"button",onClick:ae,disabled:S,children:["Opprett ",d.ledige.length," bookinger"]})})]})})})})]})})}export{Ue as default};
