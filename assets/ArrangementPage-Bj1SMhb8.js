import{r as n,j as a}from"./shadcn-BW0HktFr.js";import{u as w,e as se,f as te,d as ne,a as le,b as ie,t as O}from"./datoUtils-CMdMNzgI.js";import{u as re}from"./useArrangement-BS0m1lDW.js";import{T as de,a as oe,b as V,c as h,d as ce,e as f}from"./table-Dha75Hze.js";import{k as ge,L as me,B as o,t as c}from"./index-DfwF_6E0.js";import{D as E,C as S}from"./checkbox-D7k7CnWR.js";import{C as ue,a as xe}from"./card-DirEjasX.js";import{S as he,F as fe}from"./SelectField-DLRV7FN-.js";import{D as pe,b as ke,c as je,d as ve,f as be}from"./dialog-Br_JWRZF.js";import"./react-RGnvvjkK.js";import"./useBaner-BtJ3Nsz9.js";import"./lucide-D2dOsrR-.js";import"./index-CVVkWozz.js";import"./FieldWrapper-fgOeih5f.js";import"./index-CJjGIk76.js";function Ve(){const{slug:z}=ge(),{baner:g,tilgjengeligeTidspunkter:p,forhandsvisning:d,forhandsvis:H,clearForhandsvisning:F,opprett:P,isLoading:$,isLoadingForhandsvisning:B}=re(z),[k,y]=n.useState([]),[j,U]=n.useState([]),[v,I]=n.useState([]),[i,M]=n.useState(new Date),[r,R]=n.useState(new Date),[m,q]=n.useState(!1),[u,G]=n.useState(!1),[x,J]=n.useState(!1),[b,Q]=n.useState("Annet"),[D,W]=n.useState(""),[X,T]=n.useState(!1),C=n.useMemo(()=>{if(!i||!r)return w;const e=new Set,t=new Date(i),l=new Date(r);for(let s=new Date(t);s<=l;s.setDate(s.getDate()+1)){const ee=s.getDay(),ae=ne[ee],L=se[ae];L&&e.add(L)}return w.filter(s=>e.has(s))},[i,r]);n.useEffect(()=>{m&&y(g.map(e=>e.id)),u&&U(C),x&&I(p)},[m,u,x,g,C,p]);const N=(e,t)=>{t(l=>l.includes(e)?l.filter(s=>s!==e):[...l,e])};function A(){if(!i||!r)return c.warning("Du må velge start- og sluttdato"),null;if(k.length===0)return c.warning("Du må velge minst én bane"),null;if(v.length===0)return c.warning("Du må velge minst ett tidspunkt"),null;if(j.length===0)return c.warning("Du må velge minst én ukedag"),null;const e=le(i,r),t=j.map(l=>ie[l]).filter(l=>e.has(l));return t.length===0?(c.warning("Ingen av de valgte ukedagene finnes i datointervallet"),null):{tittel:b,beskrivelse:D,kategori:b,startDato:O(i),sluttDato:O(r),ukedager:t,tidspunkter:v,baneIder:k}}const K=n.useMemo(()=>[...d.ledige,...d.konflikter].sort((e,t)=>e.dato.localeCompare(t.dato)||e.startTid.localeCompare(t.startTid)||e.baneId.localeCompare(t.baneId)),[d]),Y=K.length>0,Z=async()=>{const e=A();e&&(await P(e),F(),T(!1))},_=async()=>{const e=A();e&&(T(!0),await H(e))};return $?a.jsx(me,{}):a.jsxs("div",{className:"max-w-screen-md mx-auto px-1 py-1",children:[a.jsx(ue,{children:a.jsxs(xe,{className:"p-4 space-y-4",children:[a.jsx(he,{id:"kategori",label:"Kategori",value:b,onChange:e=>Q(e),options:["Trening","Turnering","Klubbmersterskap","Kurs","Lagkamp","Stigespill","Dugnad","Vedlikehold","Sosialt","Annet"].map(e=>({label:e,value:e}))}),a.jsx(fe,{id:"beskrivelse",label:"Beskrivelse",value:D,onChange:e=>W(e.target.value)}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Fra"}),a.jsx(E,{value:i,onChange:M,visNavigering:!0})]}),a.jsxs("div",{children:[a.jsx("label",{className:"text-sm font-medium",children:"Til"}),a.jsx(E,{value:r,onChange:R,visNavigering:!0})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(S,{id:"alleBaner",checked:m,onCheckedChange:e=>q(!!e)}),a.jsx("label",{htmlFor:"alleBaner",className:"text-sm",children:"Alle baner"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:g.map(e=>a.jsx(o,{variant:k.includes(e.id)?"default":"outline",size:"sm",onClick:()=>N(e.id,y),disabled:m,children:e.navn},e.id))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(S,{id:"alleUkedager",checked:u,onCheckedChange:e=>G(!!e)}),a.jsx("label",{htmlFor:"alleUkedager",className:"text-sm",children:"Alle gyldige dager"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:w.map(e=>a.jsx(o,{variant:j.includes(e)?"default":"outline",size:"sm",onClick:t=>{t.preventDefault(),N(e,U)},disabled:u||!C.includes(e),children:e},e))})]}),a.jsxs("div",{children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(S,{id:"alleTidspunkter",checked:x,onCheckedChange:e=>J(!!e)}),a.jsx("label",{htmlFor:"alleTidspunkter",className:"text-sm",children:"Alle tidspunkter"})]}),a.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:p.map(e=>a.jsx(o,{variant:v.includes(e)?"default":"outline",size:"sm",onClick:()=>N(e,I),disabled:x,children:e},e))})]}),a.jsx("div",{className:"flex justify-end pt-4",children:a.jsx(o,{type:"button",onClick:_,children:"Forhåndsvis bookinger"})})]})}),a.jsx(pe,{open:X,onOpenChange:e=>{T(e),e||F()},children:a.jsxs(ke,{className:"max-w-3xl",children:[a.jsx(je,{children:a.jsx(ve,{children:"Forhåndsvis bookingene"})}),B?a.jsx("p",{className:"text-muted-foreground italic",children:"Laster forhåndsvisning…"}):Y?a.jsxs(a.Fragment,{children:[a.jsx("div",{className:"overflow-auto max-h-[60vh] border rounded-md",children:a.jsxs(de,{className:"text-sm",children:[a.jsx(oe,{children:a.jsxs(V,{children:[a.jsx(h,{children:"Dato"}),a.jsx(h,{children:"Klokkeslett"}),a.jsx(h,{children:"Bane"}),a.jsx(h,{children:"Beskrivelse"})]})}),a.jsx(ce,{children:K.map(e=>{const t=g.find(s=>s.id===e.baneId),l=d.konflikter.some(s=>s.baneId===e.baneId&&s.dato===e.dato&&s.startTid===e.startTid&&s.sluttTid===e.sluttTid);return a.jsxs(V,{className:l?"bg-yellow-100":"",children:[a.jsx(f,{children:te(e.dato)}),a.jsxs(f,{children:[e.startTid," – ",e.sluttTid]}),a.jsx(f,{children:t?.navn??"(ukjent bane)"}),a.jsxs(f,{children:[D,l&&a.jsx("span",{className:"ml-2 text-yellow-700 text-xs italic",children:"(Konflikt)"})]})]},`${e.dato}-${e.baneId}-${e.startTid}`)})})]})}),a.jsx(be,{className:"mt-3",children:a.jsxs(o,{type:"button",onClick:Z,disabled:B,children:["Opprett ",d.ledige.length," bookinger"]})})]}):a.jsx("p",{className:"text-muted-foreground italic",children:"Ingen bookinger å vise."})]})})]})}export{Ve as default};
