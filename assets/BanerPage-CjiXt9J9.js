import{j as e,r as i}from"./react-Bq13ngtT.js";import{P as G}from"./Page-Dw6mAgQE.js";import{T as K}from"./Tabs-2c4TG08W.js";import{u as C}from"./useBaner-Db97kNUS.js";import{n as L,o as N,I as y,p as I,q as R,r as w,L as O}from"./index-Bs-TkeFL.js";import{P as M,a as A,b as P,R as j}from"./RowList-BKzhyJWV.js";import{S as Y}from"./switch-P_AE6A6X.js";import{S as _,a as $,b as z,c as H,d as J}from"./select-IdcvXYSt.js";import"./tabs-Do3hRHuy.js";import"./shadcn-B0ihbUNs.js";import"./lucide-Bfr9gI8s.js";function Q({baner:t,valgtBaneId:a,onChangeValgtBaneId:g,valgtBane:u,redigerteVerdier:v,onChangeFelt:n,canSubmit:b,isSaving:l,onSubmit:k,navnError:h,onBlurNavn:x}){const s=v?.navn??u?.navn??"",d=v?.beskrivelse??u?.beskrivelse??"",c=v?.aktiv??u?.aktiv??!1;return e.jsxs(L,{onSubmit:r=>{r.preventDefault(),k()},children:[e.jsx(M,{title:"Rediger bane",description:"Velg en bane og oppdater informasjon.",children:e.jsx(A,{children:e.jsxs(P,{children:[e.jsx(j,{title:"Velg bane",description:"Velg hvilken bane du vil endre.",children:e.jsx(N,{children:e.jsxs(_,{disabled:l,value:a??"",onValueChange:r=>g(r||null),children:[e.jsx($,{id:"velg-bane",className:"bg-background",children:e.jsx(z,{placeholder:"Velg bane..."})}),e.jsx(H,{children:t.map(r=>e.jsxs(J,{value:r.id,children:[r.navn," ",r.aktiv?"":"(inaktiv)"]},r.id))})]})})}),u?e.jsxs(e.Fragment,{children:[e.jsx(j,{title:"Navn",description:"Navn på banen slik det vises i booking.",children:e.jsxs(N,{"data-invalid":!!h,children:[e.jsx(y,{id:"navn",disabled:l,value:s,onChange:r=>n("navn",r.target.value),onBlur:x,"aria-invalid":!!h,autoComplete:"off"}),h?e.jsx(I,{children:h}):null]})}),e.jsx(j,{title:"Beskrivelse",description:"Valgfritt.",children:e.jsx(N,{children:e.jsx(y,{id:"beskrivelse",disabled:l,value:d,onChange:r=>n("beskrivelse",r.target.value),autoComplete:"off"})})}),e.jsx(j,{title:"Aktiv",description:"Avgjør om banen er tilgjengelig for booking.",right:e.jsx(Y,{disabled:l,checked:c,onCheckedChange:r=>n("aktiv",r)})})]}):e.jsx(j,{title:"Ingen baner funnet",children:e.jsx("div",{className:"text-sm text-muted-foreground italic",children:"Det finnes ingen baner å redigere."})})]})})}),e.jsx(R,{variant:"sticky",align:"left",spaced:!1,className:"w-full",children:e.jsx(w,{fullWidth:!0,isLoading:l,disabled:!b,loadingText:"Lagrer...",children:"Lagre"})})]})}const T="rediger.valgtBaneId";function U(){const t=sessionStorage.getItem(T);return t&&t!=="null"?t:null}function X(t){sessionStorage.setItem(T,t??"null")}function Z(t){return t.trim()?null:"Navn er påkrevd."}function ee(){const{baner:t,isLoading:a,oppdaterBane:g}=C(!0),[u,v]=i.useState({}),[n,b]=i.useState(()=>U()),[l,k]=i.useState({}),[h,x]=i.useState(!1),s=i.useMemo(()=>t.find(o=>o.id===n)??null,[t,n]),d=i.useMemo(()=>n?u[n]??null:null,[u,n]);i.useEffect(()=>{X(n)},[n]),i.useEffect(()=>{n&&!t.some(o=>o.id===n)&&b(null)},[t,n]),i.useEffect(()=>{!n&&t.length>0&&b(t[0].id)},[t,n]),i.useEffect(()=>{x(!1)},[n]);function c(o,m){k(f=>{const S=f[o]??{navn:!1};return S[m]?f:{...f,[o]:{...S,[m]:!0}}})}function r(o,m,f){v(S=>({...S,[o]:{...S[o]??t.find(q=>q.id===o),[m]:f}}))}const p=i.useMemo(()=>s?d??{navn:s.navn,beskrivelse:s.beskrivelse,aktiv:s.aktiv}:null,[s,d]),B=i.useMemo(()=>({navn:p?Z(p.navn):null}),[p]),F=i.useMemo(()=>!s||!d?!1:!(d.navn===s.navn&&d.beskrivelse===s.beskrivelse&&d.aktiv===s.aktiv),[s,d]),E=i.useMemo(()=>!B.navn,[B.navn]),V=F&&E,D=(n?l[n]?.navn??!1:!1)||h?B.navn:null;async function W(){if(!n||!s||(x(!0),c(n,"navn"),!V))return;const o=u[n];if(o)try{await g.mutateAsync({id:n,dto:o}),v(m=>{const f={...m};return delete f[n],f}),k(m=>{const f={...m};return delete f[n],f}),x(!1)}catch{}}return a?e.jsx(O,{}):e.jsx(Q,{baner:t,valgtBaneId:n,onChangeValgtBaneId:b,valgtBane:s,redigerteVerdier:d,onChangeFelt:(o,m)=>{s&&r(s.id,o,m)},canSubmit:V,isSaving:g.isPending,onSubmit:()=>{W()},navnError:D,onBlurNavn:()=>{n&&c(n,"navn")}})}function ne({form:t,onChange:a,canSubmit:g,isSaving:u,onSubmit:v,navnError:n,onBlurNavn:b}){return e.jsxs(L,{onSubmit:l=>{l.preventDefault(),v()},children:[e.jsx(M,{title:"Ny bane",description:"Legg til en ny bane i klubben.",children:e.jsx(A,{children:e.jsxs(P,{children:[e.jsx(j,{title:"Navn",description:"Navn på banen slik det vises i booking.",children:e.jsxs(N,{"data-invalid":!!n,children:[e.jsx(y,{id:"ny-navn",disabled:u,value:t.navn,onChange:l=>a("navn",l.target.value),onBlur:b,"aria-invalid":!!n,autoComplete:"off"}),n?e.jsx(I,{children:n}):null]})}),e.jsx(j,{title:"Beskrivelse",description:"Valgfritt.",children:e.jsx(N,{children:e.jsx(y,{id:"ny-beskrivelse",disabled:u,value:t.beskrivelse,onChange:l=>a("beskrivelse",l.target.value),autoComplete:"off"})})})]})})}),e.jsx(R,{variant:"sticky",align:"left",spaced:!1,className:"w-full",children:e.jsx(w,{fullWidth:!0,isLoading:u,disabled:!g,loadingText:"Legger til...",children:"Legg til"})})]})}function te(t){return t.trim()?null:"Navn er påkrevd."}function se(){const{opprettBane:t}=C(),[a,g]=i.useState({navn:"",beskrivelse:""}),[u,v]=i.useState({navn:!1}),n=i.useMemo(()=>({navn:te(a.navn)}),[a.navn]),b=i.useMemo(()=>a.navn.trim().length>0||a.beskrivelse.trim().length>0,[a.navn,a.beskrivelse]),l=i.useMemo(()=>!n.navn,[n.navn]),k=b&&l,h=u.navn?n.navn:null;function x(c,r){g(p=>({...p,[c]:r}))}function s(){v(c=>c.navn?c:{...c,navn:!0})}async function d(){if(s(),!l)return;const c=a.navn.trim();try{await t.mutateAsync({navn:c,beskrivelse:a.beskrivelse}),g({navn:"",beskrivelse:""}),v({navn:!1})}catch{}}return e.jsx(ne,{form:a,onChange:x,canSubmit:k,isSaving:t.isPending,onSubmit:()=>{d()},navnError:h,onBlurNavn:s})}function be(){return e.jsx(G,{children:e.jsx(K,{defaultValue:"rediger",items:[{value:"rediger",label:"Rediger bane",content:e.jsx(ee,{})},{value:"ny",label:"Ny bane",content:e.jsx(se,{})}]})})}export{be as default};
