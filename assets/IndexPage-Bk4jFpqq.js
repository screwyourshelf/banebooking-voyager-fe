import{j as t,r as u}from"./shadcn-BfUXmlP3.js";import{T as B,a as w,b as N,u as S}from"./useBaner-BklKAY07.js";import{C as T,f as C,D as E}from"./checkbox-CXO8LMTq.js";import{F as $,B as j,a as L,b as A,c as D,L as y,t as k,u as F,S as P}from"./index-Cn5mi-B0.js";import{h as I,a as z,o as _}from"./booking-CGIAtdKl.js";import"./react-D5d5vywP.js";import"./lucide-CZTSiasK.js";import"./index-36j8ZHWB.js";function K({baner:e,valgtBaneId:n,onVelgBane:s}){return t.jsx(B,{value:n,onValueChange:s,children:t.jsx(w,{className:"flex flex-wrap gap-2 mb-2",children:e.map(r=>t.jsx(N,{value:r.id,children:r.navn},r.id))})})}function M(){const[e,n]=u.useState(!1);return{erBekreftet:e,setErBekreftet:n,reset:()=>n(!1)}}function V({slot:e,isOpen:n,erInteraktiv:s}){const r=`${e.startTid.slice(0,2)}-${e.sluttTid.slice(0,2)}`,a=!!e.arrangementTittel,[d,i]=u.useState(!1);u.useEffect(()=>{const o=()=>i(window.innerWidth<640);return o(),window.addEventListener("resize",o),()=>window.removeEventListener("resize",o)},[]);const m=40,l=e.arrangementBeskrivelse&&d&&e.arrangementBeskrivelse.length>m?e.arrangementBeskrivelse.slice(0,m)+"...":e.arrangementBeskrivelse;return t.jsx("div",{className:"flex items-center",children:t.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[t.jsx("div",{className:"whitespace-nowrap font-semibold text-sm text-right pr-1",children:r}),t.jsx("div",{className:"w-[18px] h-[18px] flex items-center justify-center",children:e.værSymbol?t.jsx("img",{src:`/banebooking-voyager-fe/weather-symbols/svg/${e.værSymbol}.svg`,alt:e.værSymbol,width:18,height:18,className:"select-none",draggable:!1}):t.jsx("span",{className:"invisible"})}),t.jsx("div",{className:"flex-grow text-sm p-1",children:a?t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.arrangementTittel}),l&&t.jsx("div",{className:"text-xs text-gray-600",children:l})]}):t.jsx("div",{children:e.booketAv??"Ledig"})}),s&&t.jsx("div",{className:"p-1",children:t.jsx($,{size:12,style:{transform:n?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},"aria-hidden":"true"})})]})})}function H({slot:e,onBook:n=()=>{},onCancel:s=()=>{},onDelete:r=()=>{},time:a,erBekreftet:d,setErBekreftet:i,reset:m=()=>{}}){return t.jsxs("div",{className:"flex flex-col items-end w-full",children:[e.kanBookes&&d!==void 0&&i&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center space-x-1 mb-2 text-sm",children:[t.jsx(T,{id:`book-${a}`,checked:d,onCheckedChange:l=>i(!!l)}),t.jsxs("label",{htmlFor:`book-${a}`,className:"cursor-pointer select-none",children:["Jeg (og de jeg spiller sammen med) har betalt medlemskap for ",new Date().getFullYear()]})]}),t.jsxs(j,{variant:"outline",size:"sm",disabled:!d,onClick:()=>{n(e),m()},className:"flex items-center gap-2 text-sm",children:[t.jsx(L,{}),"Book"]})]}),e.kanAvbestille&&t.jsxs(j,{variant:"outline",size:"sm",onClick:()=>{s(e),m()},className:"flex items-center gap-2 text-sm",children:[t.jsx(A,{}),"Avbestill"]}),e.kanSlette&&t.jsxs(j,{variant:"destructive",size:"sm",onClick:()=>{r(e),m()},className:"flex items-center gap-2 text-sm",children:[t.jsx(D,{}),"Slett"]})]})}function J({slot:e,time:n,erBekreftet:s,setErBekreftet:r,onBook:a,onCancel:d,onDelete:i,reset:m}){return t.jsx("div",{className:"mt-1",children:t.jsx("div",{className:"bg-inherit",children:t.jsx(H,{slot:e,time:n,erBekreftet:s,setErBekreftet:r,onBook:a,onCancel:d,onDelete:i,reset:m})})})}function O({slot:e,currentUser:n,isOpen:s=!1,onToggle:r,onBook:a=()=>{},onCancel:d=()=>{},onDelete:i=()=>{}}){const{erBekreftet:m,setErBekreftet:l,reset:o}=M(),b=`${e.startTid.slice(0,2)}-${e.sluttTid.slice(0,2)}`,g=e.kanBookes||e.kanAvbestille||e.kanSlette,c=!!n&&g&&!e.erPassert,x=!!e.arrangementTittel,v=e.booketAv===(n==null?void 0:n.epost),f=["border rounded shadow-sm p-2 mb-2","transition-colors duration-300 ease-in-out",e.erPassert?"bg-gray-100 text-gray-400":"",!e.erPassert&&x?"bg-gradient-to-r from-blue-0 via-blue-50 to-blue-200 border-blue-200":"",!e.erPassert&&!x?"bg-white text-gray-900":"",v&&!x?"animate__animated animate__headShake animate__slow":""].join(" "),p=()=>{c&&r&&(r(),l(!1))};return t.jsxs("div",{className:f,style:{cursor:c?"pointer":"default",opacity:e.erPassert?.5:1},onClick:h=>{h.target.closest("button, input, label")||p()},role:c?"button":void 0,tabIndex:c?0:void 0,onKeyDown:h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),p())},children:[t.jsx(V,{slot:e,isOpen:s,erInteraktiv:c}),s&&!e.erPassert&&t.jsx(J,{slot:e,time:b,erBekreftet:m,setErBekreftet:l,onBook:a,onCancel:d,onDelete:i,reset:o})]})}function R({slots:e,currentUser:n,onBook:s,onCancel:r,onDelete:a,apenSlotTid:d,setApenSlotTid:i,isLoading:m=!1}){return m?t.jsx(y,{}):e.length===0?t.jsx("div",{className:"text-muted text-sm italic py-4 text-center",children:"Ingen bookinger eller slots � vise."}):t.jsx("div",{className:"space-y-2",children:e.map(l=>{const o=`${l.dato}-${l.startTid}-${l.baneId}`;return t.jsx(O,{slot:l,currentUser:n,onBook:s,onCancel:r,onDelete:a,isOpen:d===o,onToggle:()=>i==null?void 0:i(d===o?null:o)},o)})})}function W(e,n,s){const[r,a]=u.useState([]),[d,i]=u.useState(null),[m,l]=u.useState(!0),o=u.useCallback(async()=>{if(!(!e||!s)){l(!0);try{const c=await I(e,s,n);a(c)}catch{a([]),k.error("Kunne ikke hente bookinger.")}finally{l(!1)}}},[e,n,s]);return u.useEffect(()=>{o()},[o]),{slots:r,apenSlotTid:d,setApenSlotTid:i,onBook:async c=>{if(!(!e||!s))try{await _(e,s,n,c.startTid,c.sluttTid);const x=`${c.startTid.slice(0,2)}-${c.sluttTid.slice(0,2)}`;k.success(`Booket ${x}`),await o()}catch(x){k.error(x instanceof Error?x.message:"Kunne ikke booke slot.")}},onCancel:async c=>{if(!(!e||!s))try{await z(e,s,n,c.startTid,c.sluttTid),k.info("Bookingen er avbestilt."),await o()}catch(x){k.error(x instanceof Error?x.message:"Kunne ikke avbestille slot.")}},hentBookinger:o,isLoading:m}}function se(){const{baner:e,isLoading:n}=S(),[s,r]=u.useState(""),[a,d]=u.useState(new Date),{currentUser:i}=F(),m=u.useContext(P),l=a?C(a,"yyyy-MM-dd"):"",{slots:o,apenSlotTid:b,setApenSlotTid:g,onBook:c,onCancel:x,isLoading:v}=W(m,l,s);return u.useEffect(()=>{!s&&e.length>0&&r(e[0].id)},[e,s]),u.useEffect(()=>{g(null)},[a,s,g]),u.useEffect(()=>{i||g(null)},[i,g]),u.useEffect(()=>{a&&localStorage.setItem("valgtDato",a.toISOString())},[a]),n||!s?t.jsx(y,{}):t.jsxs("div",{className:"max-w-screen-sm mx-auto px-1 py-1",children:[t.jsx("div",{className:"mb-2",children:t.jsx(E,{value:a,onChange:f=>d(f??null),visNavigering:!0})}),t.jsx("div",{className:"mb-0",children:t.jsx(K,{baner:e,valgtBaneId:s,onVelgBane:r})}),t.jsx(R,{slots:o,currentUser:i?{epost:i.email??""}:null,apenSlotTid:b,setApenSlotTid:g,onBook:c,onCancel:x,onDelete:f=>console.log("Slett",f),isLoading:v})]})}export{se as default};
