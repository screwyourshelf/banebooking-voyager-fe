import{r as g,j as t}from"./shadcn-DDUjAgUv.js";import{C as w,f as B,D as T}from"./checkbox-BNLLXAxS.js";import{F as N,B as p,a as D,b as C,c as E,L as y,t as b,u as $,d as L}from"./index-DPErGzPN.js";import{u as A}from"./useBaner-D9y-A84v.js";import{h as I,s as P,a as F,o as M}from"./booking-HRtkDR5-.js";import{u as S}from"./useSlug-DGcvY4vP.js";import{P as z}from"./Page-Cq3gZojq.js";import{S as K}from"./SimpleTabsLazy-Cch1SZpp.js";import{D as _,a as V,b as H,c as O,d as J,e as Q}from"./dialog-0p2o0fmL.js";import{a as W}from"./lucide-Bc72fHhV.js";import"./react-RGnvvjkK.js";import"./index-XHTm-vMi.js";import"./index-CZuuFr9-.js";function Y(){const[e,s]=g.useState(!1);return{erBekreftet:e,setErBekreftet:s,reset:()=>s(!1)}}function q({slot:e,isOpen:s,erInteraktiv:n,currentUser:o}){const a=`${e.startTid.slice(0,2)}-${e.sluttTid.slice(0,2)}`,r=!!e.arrangementTittel,[u,l]=g.useState(!1);g.useEffect(()=>{const f=()=>l(window.innerWidth<640);return f(),window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]);const d=40,c=e.arrangementBeskrivelse&&u&&e.arrangementBeskrivelse.length>d?e.arrangementBeskrivelse.slice(0,d)+"...":e.arrangementBeskrivelse;return t.jsx("div",{className:"flex items-center",children:t.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[t.jsx("div",{className:"whitespace-nowrap font-semibold text-sm text-right pr-1",children:a}),t.jsx("div",{className:"w-[18px] h-[18px] flex items-center justify-center",children:e.værSymbol?t.jsx("img",{src:`/banebooking-voyager-fe/weather-symbols/svg/${e.værSymbol}.svg`,alt:e.værSymbol,width:18,height:18,className:"select-none",draggable:!1}):t.jsx("span",{className:"invisible"})}),t.jsx("div",{className:"flex-grow text-sm p-1",children:r?t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.arrangementTittel}),c&&t.jsx("div",{className:"text-xs text-gray-600",children:c})]}):t.jsx("div",{children:e.booketAv?o?e.booketAv:G(e.booketAv):"Ledig"})}),n&&t.jsx("div",{className:"p-1",children:t.jsx(N,{size:12,style:{transform:s?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},"aria-hidden":"true"})})]})})}function G(e){const[s,n]=e.split("@");return!s||!n?e:`${s[0]}***@${n}`}function R({slot:e,onBook:s=()=>{},onCancel:n=()=>{},onDelete:o=()=>{},time:a,erBekreftet:r,setErBekreftet:u,reset:l=()=>{}}){return t.jsxs("div",{className:"flex flex-col items-end w-full",children:[e.kanBookes&&r!==void 0&&u&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center space-x-1 mb-2 text-sm",children:[t.jsx(w,{id:`book-${a}`,checked:r,onCheckedChange:d=>u(!!d)}),t.jsxs("label",{htmlFor:`book-${a}`,className:"cursor-pointer select-none",children:["Jeg (og de jeg spiller sammen med) har betalt medlemskap for ",new Date().getFullYear()]})]}),t.jsxs(p,{variant:"outline",size:"sm",disabled:!r,onClick:()=>{s(e),l()},className:"flex items-center gap-2 text-sm",children:[t.jsx(D,{}),"Book"]})]}),e.kanAvbestille&&t.jsxs(p,{variant:"outline",size:"sm",onClick:()=>{n(e),l()},className:"flex items-center gap-2 text-sm",children:[t.jsx(C,{}),"Avbestill"]}),e.kanSlette&&t.jsxs(p,{variant:"destructive",size:"sm",onClick:()=>{o(e),l()},className:"flex items-center gap-2 text-sm",children:[t.jsx(E,{}),"Slett"]})]})}function U({slot:e,time:s,erBekreftet:n,setErBekreftet:o,onBook:a,onCancel:r,onDelete:u,reset:l}){return t.jsx("div",{className:"mt-1",children:t.jsx("div",{className:"bg-inherit",children:t.jsx(R,{slot:e,time:s,erBekreftet:n,setErBekreftet:o,onBook:a,onCancel:r,onDelete:u,reset:l})})})}function X({slot:e,currentUser:s,isOpen:n=!1,onToggle:o,onBook:a=()=>{},onCancel:r=()=>{},onDelete:u=()=>{}}){const{erBekreftet:l,setErBekreftet:d,reset:c}=Y(),f=`${e.startTid.slice(0,2)}-${e.sluttTid.slice(0,2)}`,k=e.kanBookes||e.kanAvbestille||e.kanSlette,h=!!s&&k&&!e.erPassert,j=!!e.arrangementTittel,i=e.erEier===!0,m=["border rounded shadow-sm p-2 mb-2","transition-colors duration-300 ease-in-out",e.erPassert?"bg-gray-100 text-gray-400":"",!e.erPassert&&j?"bg-gradient-to-r from-blue-0 via-blue-50 to-blue-200 border-blue-200":"",!e.erPassert&&!j?"bg-white text-gray-900":"",s&&i&&!j?"animate__animated animate__headShake animate__slow":""].join(" "),x=()=>{h&&o&&(o(),d(!1))};return t.jsxs("div",{className:m,style:{cursor:h?"pointer":"default",opacity:e.erPassert?.5:1},onClick:v=>{v.target.closest("button, input, label")||x()},role:h?"button":void 0,tabIndex:h?0:void 0,onKeyDown:v=>{(v.key==="Enter"||v.key===" ")&&(v.preventDefault(),x())},children:[t.jsx(q,{slot:e,isOpen:n,erInteraktiv:h,currentUser:s}),n&&!e.erPassert&&t.jsx(U,{slot:e,time:f,erBekreftet:l,setErBekreftet:d,onBook:a,onCancel:r,onDelete:u,reset:c})]})}function Z({slots:e,currentUser:s,onBook:n,onCancel:o,onDelete:a,apenSlotTid:r,setApenSlotTid:u,isLoading:l=!1}){return l?t.jsx(y,{}):e.length===0?t.jsx("div",{className:"text-muted text-sm italic py-4 text-center",children:"Ingen bookinger eller slots � vise."}):t.jsx("div",{className:"space-y-2",children:e.map(d=>{const c=`${d.dato}-${d.startTid}-${d.baneId}`;return t.jsx(X,{slot:d,currentUser:s,onBook:n,onCancel:o,onDelete:a,isOpen:r===c,onToggle:()=>u?.(r===c?null:c)},c)})})}function ee(e,s,n){const[o,a]=g.useState([]),[r,u]=g.useState(null),[l,d]=g.useState(!0),c=g.useCallback(async()=>{if(!(!e||!n)){d(!0);try{const i=await I(e,n,s);a(i)}catch{a([]),b.error("Kunne ikke hente bookinger.")}finally{d(!1)}}},[e,s,n]);g.useEffect(()=>{c()},[c]);const f=i=>{a(m=>m.filter(x=>!(x.baneId===i.baneId&&x.dato===i.dato&&x.startTid===i.startTid&&x.sluttTid===i.sluttTid)))};return{slots:o,apenSlotTid:r,setApenSlotTid:u,onBook:async i=>{if(!(!e||!n))try{await M(e,n,s,i.startTid,i.sluttTid);const m=`${i.startTid.slice(0,2)}-${i.sluttTid.slice(0,2)}`;b.success(`Booket ${m}`),await c()}catch(m){b.error(m instanceof Error?m.message:"Kunne ikke booke.")}},onCancel:async i=>{if(!(!e||!n))try{await F(e,n,s,i.startTid,i.sluttTid),f(i),b.info("Bookingen er avbestilt."),await c()}catch(m){b.error(m instanceof Error?m.message:"Kunne ikke avbestille.")}},onDelete:async i=>{if(e)try{await P(e,i.baneId,i.dato,i.startTid,i.sluttTid),f(i),b.success("Booking slettet"),u(null),await c()}catch(m){b.error(m instanceof Error?m.message:"Kunne ikke slette booking.")}},hentBookinger:c,isLoading:l}}function te({children:e}){const s=S(),{data:n,isLoading:o}=$(s);if(o||!n)return null;const{bookingRegel:a}=n;return t.jsxs(_,{children:[t.jsx(V,{asChild:!0,children:e}),t.jsxs(H,{children:[t.jsxs(O,{children:[t.jsx(J,{children:"Bookingregler"}),t.jsx(Q,{className:"sr-only",children:"Oversikt over bookingreglene i klubben"})]}),t.jsx("div",{className:"space-y-4",children:t.jsxs("ul",{className:"list-disc list-inside text-sm",children:[t.jsxs("li",{children:["Maks ",a.maksPerDag," bookinger per dag"]}),t.jsxs("li",{children:["Maks ",a.maksTotalt," aktive bookinger totalt"]}),t.jsxs("li",{children:["Opptil ",a.dagerFremITid," dager frem i tid"]}),t.jsxs("li",{children:[a.slotLengdeMinutter," minutter per booking"]}),t.jsxs("li",{children:["Tillatt mellom ",a.aapningstid,"–",a.stengetid]})]})})]})]})}function ke(){const e=S(),{baner:s,isLoading:n}=A(e,!1),[o,a]=g.useState(""),[r,u]=g.useState(new Date),{currentUser:l}=L(),d=r?B(r,"yyyy-MM-dd"):"",{slots:c,apenSlotTid:f,setApenSlotTid:k,onBook:h,onCancel:j,onDelete:i,isLoading:m}=ee(e,d,o);return g.useEffect(()=>{!o&&s.length>0&&a(s[0].id)},[s,o]),g.useEffect(()=>{k(null)},[r,o,k]),g.useEffect(()=>{l||k(null)},[l,k]),g.useEffect(()=>{r&&localStorage.setItem("valgtDato",r.toISOString())},[r]),n||!o?t.jsx(y,{}):t.jsxs(z,{children:[t.jsxs("div",{className:"flex justify-between items-center mb-2",children:[t.jsx(te,{children:t.jsx(p,{variant:"ghost",size:"icon",className:"rounded-full",title:"Vis banereglement",children:t.jsx(W,{className:"w-5 h-5"})})}),t.jsx(T,{value:r,onChange:x=>u(x??null),visNavigering:!0})]}),t.jsx(K,{items:s.map(x=>({value:x.id,label:x.navn,content:t.jsx(Z,{slots:c,currentUser:l?{epost:l.email??""}:null,apenSlotTid:f,setApenSlotTid:k,onBook:h,onCancel:j,onDelete:i,isLoading:m})})),value:o,onValueChange:a})]})}export{ke as default};
