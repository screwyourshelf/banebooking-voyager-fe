import{j as e,r as c,i as V,w as K,c as X,l as B,k as G,y as Q}from"./shadcn-BW0HktFr.js";import{u as W}from"./useSlug-Dgkv8Wrt.js";import{P as J}from"./Page-D3HqBSgJ.js";import{P as Y}from"./PageSection-DNO2zFH9.js";import{S as Z}from"./SimpleTabsLazy-C44pBQN4.js";import{d as M,e as E,t as k,h as ee,L as D,I as te,B as P,g as ne,i as se,j as L}from"./index-BWn9U0qn.js";import{F as re}from"./FieldWrapper-EgKMkGRF.js";import{A as ae,a as ie,b as oe,c as le,d as ce,e as de,f as ue,g as me,h as ge}from"./alert-dialog-CW56PCs9.js";import{f as $}from"./datoUtils-CMdMNzgI.js";import{T as pe,a as he,b as R,c as C,d as ve,e as T}from"./table-DPxS8hfM.js";import{u as xe}from"./index-CVVkWozz.js";import"./react-RGnvvjkK.js";import"./lucide-D2dOsrR-.js";import"./index-CJjGIk76.js";function f({children:n,className:t=""}){return e.jsx("div",{className:`rounded-md border bg-background divide-y divide-border/60 ${t}`,children:n})}function v({title:n,description:t,right:s,children:a,className:i=""}){return e.jsxs("div",{className:`p-3 ${i}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("div",{className:"text-sm font-medium leading-5",children:n}),t?e.jsx("div",{className:"text-xs text-muted-foreground mt-1 leading-4",children:t}):null]}),s?e.jsx("div",{className:"shrink-0",children:s}):null]}),a?e.jsx("div",{className:"mt-2",children:a}):null]})}function _(n){const t=M(["meg",n],`/klubb/${n}/bruker/meg`,{requireAuth:!0,enabled:!!n,staleTime:6e4}),s=E("patch",`/klubb/${n}/bruker/meg`,{onSuccess:()=>{k.success("Visningsnavn oppdatert"),t.refetch()},onError:o=>{k.error(o.message??"Kunne ikke oppdatere visningsnavn")}}),a=E("delete",`/klubb/${n}/bruker/meg`,{onSuccess:()=>k.success("Brukeren er slettet"),onError:o=>k.error(o.message??"Kunne ikke slette bruker")}),i=async()=>{if(!n)return;const o=await ee.get(`/klubb/${n}/bruker/meg/egen-data`,{requireAuth:!0,responseType:"blob"}),r=o.data,d=o.headers?.["content-disposition"]?.match(/filename\*=UTF-8''([^;]+)|filename="?([^"]+)"?/i),p=decodeURIComponent(d?.[1]??d?.[2]??"")||`banebooking-data-${new Date().toISOString().slice(0,10)}.json`,u=URL.createObjectURL(r),g=document.createElement("a");g.href=u,g.download=p,document.body.appendChild(g),g.click(),g.remove(),URL.revokeObjectURL(u)};return{bruker:t.data,laster:t.isLoading,error:t.error,refetch:t.refetch,lastNedEgenData:i,oppdaterVisningsnavn:s,slettMeg:a}}function b({title:n,description:t,children:s}){return e.jsxs("section",{className:"rounded-lg bg-muted/40 p-3 space-y-3",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:n}),t&&e.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:t})]}),s]})}const w=50,ke=/^[\p{L}\d\s.@'_%+-]{2,}$/u;function fe({slug:n}){const{bruker:t,laster:s,oppdaterVisningsnavn:a}=_(n),{mutateAsync:i,isPending:o}=a,[r,l]=c.useState("epost"),[d,h]=c.useState(""),[p,u]=c.useState(null);c.useEffect(()=>{if(!t)return;const m=t.visningsnavn?.trim();!m||m===t.epost?(l("epost"),h("")):(l("navn"),h(m))},[t]);const g=c.useMemo(()=>t?r==="epost"?t.visningsnavn!==t.epost:d.trim()!==(t.visningsnavn??"").trim():!1,[t,r,d]),x=async()=>{if(!t)return;if(r==="epost"){u(null),await i({visningsnavn:t.epost});return}const m=d.trim();if(m.length===0)return u("Visningsnavn kan ikke være tomt.");if(m.length<3)return u("Visningsnavn må være minst 3 tegn.");if(!ke.test(m))return u("Visningsnavn inneholder ugyldige tegn.");if(m.length>w)return u(`Visningsnavn kan ikke være lengre enn ${w} tegn.`);u(null),await i({visningsnavn:m})};return s||!t?e.jsx(D,{}):e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{title:"Min profil",description:"Velg hva som vises som navnet ditt i appen.",children:e.jsxs(f,{children:[e.jsx(v,{title:"Visningsnavn",description:"Velg e-post eller et eget navn.",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer select-none",children:[e.jsx("input",{type:"radio",name:"visningsnavn-mode",checked:r==="epost",onChange:()=>{l("epost"),u(null),h("")}}),e.jsxs("span",{children:["E-post (",t.epost,")"]})]}),e.jsxs("label",{className:"flex items-center gap-2 text-sm cursor-pointer select-none",children:[e.jsx("input",{type:"radio",name:"visningsnavn-mode",checked:r==="navn",onChange:()=>{l("navn"),u(null)}}),e.jsx("span",{children:"Eget navn"})]})]})}),e.jsx(v,{title:"Eget navn",description:`Maks ${w} tegn.`,right:e.jsx(P,{type:"button",size:"sm",disabled:!g||o,onClick:()=>void x(),children:o?"Lagrer...":"Lagre"}),className:r==="navn"?"":"opacity-50",children:e.jsx(re,{id:"visningsnavn",label:"",error:p,className:"space-y-0",children:e.jsx(te,{id:"visningsnavn",value:r==="navn"?d:"",maxLength:w,placeholder:"f.eks. Ola Nordmann",onChange:m=>h(m.target.value),disabled:r!=="navn",className:p?"border-destructive":""})})})]})}),e.jsx(b,{title:"Konto",description:"Denne informasjonen kan bare endres av klubbadministrator.",children:e.jsxs(f,{children:[e.jsx(v,{title:"Brukernavn / ID",children:e.jsx("div",{className:"text-sm text-foreground",children:t.epost})}),e.jsx(v,{title:"Rolle (i klubben)",children:e.jsx("div",{className:"text-sm text-foreground",children:t.roller.join(", ")})})]})})]})}function be({slettMeg:n}){const{signOut:t}=ne(),[s,a]=c.useState(!1),i=async()=>{try{await n.mutateAsync(),a(!1),await t()}catch{}};return e.jsxs(ae,{open:s,onOpenChange:a,children:[e.jsx(ie,{asChild:!0,children:e.jsx(P,{variant:"destructive",disabled:n.isPending,children:n.isPending?"Sletter...":"Slett min bruker"})}),e.jsxs(oe,{children:[e.jsxs(le,{children:[e.jsx(ce,{children:"Er du sikker?"}),e.jsx(de,{children:"Dette vil slette din bruker og all tilknytning permanent. Denne handlingen kan ikke angres."})]}),e.jsxs(ue,{children:[e.jsx(me,{disabled:n.isPending,children:"Avbryt"}),e.jsx(ge,{variant:"destructive",onClick:i,disabled:n.isPending,children:n.isPending?"Sletter...":"Slett bruker"})]})]})]})}function je({slug:n}){const{bruker:t,laster:s,lastNedEgenData:a,slettMeg:i}=_(n),{isPending:o}=i;if(s||!t)return e.jsx(D,{});const r=t.vilkaarAkseptertDato?`Akseptert ${$(t.vilkaarAkseptertDato)}${t.vilkaarVersjon?` (versjon ${t.vilkaarVersjon})`:""}`:"Ikke registrert";return e.jsxs("div",{className:"space-y-4",children:[e.jsx(b,{title:"Persondata",description:"Her kan du se vilkår og laste ned egne data.",children:e.jsxs(f,{children:[e.jsxs(v,{title:"Vilkår",description:"Vilkårene aksepteres automatisk ved første innlogging.",children:[e.jsx("div",{className:"text-sm text-foreground",children:r}),e.jsx("div",{className:"mt-2",children:e.jsx(se,{to:`/${n}/vilkaar`,className:"text-sm underline text-primary hover:text-primary/80",target:"_blank",rel:"noopener noreferrer",children:"Les vilkårene"})})]}),e.jsx(v,{title:"Last ned dine data",description:"JSON med registrerte opplysninger og bookinger.",right:e.jsx(P,{onClick:a,size:"sm",variant:"outline",disabled:o,children:o?"Laster...":"Last ned"})})]})}),e.jsx(b,{title:"Slett bruker",description:"Sletter bruker og all tilknyttet data permanent.",children:e.jsx(f,{children:e.jsx(v,{title:"",description:"Dette kan ikke angres.",right:e.jsx(be,{slettMeg:i})})})})]})}function Ne(n,t=!1){const s=M(["mineBookinger",n,t],`/klubb/${n}/bookinger/mine${t?"?inkluderHistoriske=true":""}`,{requireAuth:!0,enabled:!!n,staleTime:6e4}),a=c.useRef(!1);return c.useEffect(()=>{if(!s.error){a.current=!1;return}a.current||(k.error(s.error.message??"Ukjent feil ved henting av bookinger"),a.current=!0)},[s.error]),s}var S="Switch",[we,ze]=X(S),[Se,ye]=we(S),H=c.forwardRef((n,t)=>{const{__scopeSwitch:s,name:a,checked:i,defaultChecked:o,required:r,disabled:l,value:d="on",onCheckedChange:h,form:p,...u}=n,[g,x]=c.useState(null),m=V(t,N=>x(N)),y=c.useRef(!1),A=g?p||!!g.closest("form"):!0,[j,q]=K({prop:i,defaultProp:o??!1,onChange:h,caller:S});return e.jsxs(Se,{scope:s,checked:j,disabled:l,children:[e.jsx(B.button,{type:"button",role:"switch","aria-checked":j,"aria-required":r,"data-state":F(j),"data-disabled":l?"":void 0,disabled:l,value:d,...u,ref:m,onClick:G(n.onClick,N=>{q(z=>!z),A&&(y.current=N.isPropagationStopped(),y.current||N.stopPropagation())})}),A&&e.jsx(U,{control:g,bubbles:!y.current,name:a,value:d,checked:j,required:r,disabled:l,form:p,style:{transform:"translateX(-100%)"}})]})});H.displayName=S;var I="SwitchThumb",O=c.forwardRef((n,t)=>{const{__scopeSwitch:s,...a}=n,i=ye(I,s);return e.jsx(B.span,{"data-state":F(i.checked),"data-disabled":i.disabled?"":void 0,...a,ref:t})});O.displayName=I;var Ce="SwitchBubbleInput",U=c.forwardRef(({__scopeSwitch:n,control:t,checked:s,bubbles:a=!0,...i},o)=>{const r=c.useRef(null),l=V(r,o),d=xe(s),h=Q(t);return c.useEffect(()=>{const p=r.current;if(!p)return;const u=window.HTMLInputElement.prototype,x=Object.getOwnPropertyDescriptor(u,"checked").set;if(d!==s&&x){const m=new Event("click",{bubbles:a});x.call(p,s),p.dispatchEvent(m)}},[d,s,a]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:s,...i,tabIndex:-1,ref:l,style:{...i.style,...h,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});U.displayName=Ce;function F(n){return n?"checked":"unchecked"}var Te=H,De=O;function Pe({className:n,...t}){return e.jsx(Te,{"data-slot":"switch",className:L("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",n),...t,children:e.jsx(De,{"data-slot":"switch-thumb",className:L("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}function Ae({slug:n}){const[t,s]=c.useState(!1),{data:a=[],isLoading:i}=Ne(n,t),o=[...a].sort((r,l)=>{const d=new Date(l.dato).getTime()-new Date(r.dato).getTime();return d!==0?d:l.startTid.localeCompare(r.startTid)});return i?e.jsx(D,{}):e.jsx("div",{className:"space-y-4",children:e.jsx(b,{title:"Bookinger",description:"Se kommende bookinger og velg om du vil inkludere tidligere.",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx(f,{children:e.jsx(v,{title:"Vis også tidligere bookinger",description:"Inkluder bookinger som allerede er gjennomført.",right:e.jsx(Pe,{checked:t,onCheckedChange:s})})}),o.length===0?e.jsx("div",{className:"text-sm text-muted-foreground italic",children:t?"Du har ingen registrerte bookinger.":"Du har ingen kommende bookinger."}):e.jsx("div",{className:"overflow-x-auto rounded-md border bg-background",children:e.jsxs(pe,{className:"text-sm",children:[e.jsx(he,{children:e.jsxs(R,{children:[e.jsx(C,{className:"whitespace-nowrap",children:"Dato"}),e.jsx(C,{className:"whitespace-nowrap",children:"Tid"}),e.jsx(C,{className:"whitespace-nowrap",children:"Bane"})]})}),e.jsx(ve,{children:o.map((r,l)=>e.jsxs(R,{children:[e.jsx(T,{className:"whitespace-nowrap",children:$(r.dato)}),e.jsxs(T,{className:"whitespace-nowrap",children:[r.startTid,"–",r.sluttTid]}),e.jsx(T,{className:"min-w-[10rem]",children:r.baneNavn})]},l))})]})})]})})})}function Ke(){const[n,t]=c.useState("bookinger"),s=W();return e.jsx(J,{children:e.jsx(Y,{children:e.jsx(Z,{items:[{value:"bookinger",label:"Mine bookinger",content:e.jsx(Ae,{slug:s})},{value:"profil",label:"Min profil",content:e.jsx(fe,{slug:s})},{value:"persondata",label:"Persondata",content:e.jsx(je,{slug:s})}],value:n,onValueChange:t})})})}export{Ke as default};
