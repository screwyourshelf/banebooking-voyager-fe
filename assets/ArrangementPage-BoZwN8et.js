import{j as e,r as n}from"./shadcn-BWI-zYLE.js";import{u as w,e as ne,f as le,d as re,a as ie,b as de,t as V}from"./datoUtils-CMdMNzgI.js";import{u as oe,T as ce,a as ge,b as E,c as f,d as ue,e as j}from"./table-Bb-qkzJ9.js";import{f as z,L as me,i as O,h as xe,s as he,I as fe,B as g,t as u}from"./index-BatLQ3bG.js";import{C as S}from"./checkbox-_CVchsYD.js";import{D as R}from"./DatoVelger-DT_GcdWx.js";import{D as je,b as pe,c as ke,d as ve,f as be}from"./dialog-MZmcbdbd.js";import{S as Te,a as De,b as Ne,c as Ce,d as we}from"./select-DhYZMZCe.js";import"./react-RGnvvjkK.js";import"./useBaner-ClqJhM1L.js";import"./lucide-CrbeDRip.js";import"./index-BsNugM_4.js";import"./index-B4aqYbDD.js";function Se({className:r,...i}){return e.jsx("div",{"data-slot":"card",className:z("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",r),...i})}function Fe({className:r,...i}){return e.jsx("div",{"data-slot":"card-content",className:z("px-6",r),...i})}function $e(){const{baner:r,tilgjengeligeTidspunkter:i,forhandsvisning:c,forhandsvis:H,clearForhandsvisning:F,opprett:$,isLoading:M,isLoadingForhandsvisning:I}=oe(),[p,y]=n.useState([]),[k,B]=n.useState([]),[v,U]=n.useState([]),[d,P]=n.useState(new Date),[o,G]=n.useState(new Date),[m,q]=n.useState(!1),[x,J]=n.useState(!1),[h,Q]=n.useState(!1),[b,W]=n.useState("Annet"),[T,X]=n.useState(""),[Y,D]=n.useState(!1),N=n.useMemo(()=>{if(!d||!o)return w;const a=new Set,t=new Date(d),l=new Date(o);for(let s=new Date(t);s<=l;s.setDate(s.getDate()+1)){const se=s.getDay(),te=re[se],L=ne[te];L&&a.add(L)}return w.filter(s=>a.has(s))},[d,o]);n.useEffect(()=>{m&&y(r.map(a=>a.id)),x&&B(N),h&&U(i)},[m,x,h,r,N,i]);const C=(a,t)=>{t(l=>l.includes(a)?l.filter(s=>s!==a):[...l,a])};function A(){if(!d||!o)return u.warning("Du må velge start- og sluttdato"),null;if(p.length===0)return u.warning("Du må velge minst én bane"),null;if(v.length===0)return u.warning("Du må velge minst ett tidspunkt"),null;if(k.length===0)return u.warning("Du må velge minst én ukedag"),null;const a=ie(d,o),t=k.map(l=>de[l]).filter(l=>a.has(l));return t.length===0?(u.warning("Ingen av de valgte ukedagene finnes i datointervallet"),null):{tittel:b,beskrivelse:T,kategori:b,startDato:V(d),sluttDato:V(o),ukedager:t,tidspunkter:v,baneIder:p}}const K=n.useMemo(()=>[...c.ledige,...c.konflikter].sort((a,t)=>a.dato.localeCompare(t.dato)||a.startTid.localeCompare(t.startTid)||a.baneId.localeCompare(t.baneId)),[c]),Z=K.length>0,_=async()=>{const a=A();a&&(await $(a),F(),D(!1))},ee=async()=>{const a=A();a&&(D(!0),await H(a))},ae=["Trening","Turnering","Klubbmersterskap","Kurs","Lagkamp","Stigespill","Dugnad","Vedlikehold","Sosialt","Annet"];return M?e.jsx(me,{}):e.jsxs("div",{className:"max-w-screen-md mx-auto px-1 py-1",children:[e.jsx(Se,{children:e.jsxs(Fe,{className:"p-4 space-y-4",children:[e.jsxs(O,{children:[e.jsx(xe,{htmlFor:"kategori",children:"Kategori"}),e.jsxs(Te,{value:b,onValueChange:W,children:[e.jsx(De,{id:"kategori",children:e.jsx(Ne,{placeholder:"Velg kategori..."})}),e.jsx(Ce,{children:ae.map(a=>e.jsx(we,{value:a,children:a},a))})]})]}),e.jsxs(O,{children:[e.jsx(he,{htmlFor:"beskrivelse",children:"Beskrivelse"}),e.jsx(fe,{id:"beskrivelse",value:T,onChange:a=>X(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Fra"}),e.jsx(R,{value:d,onChange:P,visNavigering:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Til"}),e.jsx(R,{value:o,onChange:G,visNavigering:!0})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{id:"alleBaner",checked:m,onCheckedChange:a=>q(!!a)}),e.jsx("label",{htmlFor:"alleBaner",className:"text-sm",children:"Alle baner"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:r.map(a=>e.jsx(g,{variant:p.includes(a.id)?"default":"outline",size:"sm",onClick:()=>C(a.id,y),disabled:m,children:a.navn},a.id))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{id:"alleUkedager",checked:x,onCheckedChange:a=>J(!!a)}),e.jsx("label",{htmlFor:"alleUkedager",className:"text-sm",children:"Alle gyldige dager"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:w.map(a=>e.jsx(g,{variant:k.includes(a)?"default":"outline",size:"sm",onClick:t=>{t.preventDefault(),C(a,B)},disabled:x||!N.includes(a),children:a},a))})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{id:"alleTidspunkter",checked:h,onCheckedChange:a=>Q(!!a)}),e.jsx("label",{htmlFor:"alleTidspunkter",className:"text-sm",children:"Alle tidspunkter"})]}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:i.map(a=>e.jsx(g,{variant:v.includes(a)?"default":"outline",size:"sm",onClick:()=>C(a,U),disabled:h,children:a},a))})]}),e.jsx("div",{className:"flex justify-end pt-4",children:e.jsx(g,{type:"button",onClick:ee,children:"Forhåndsvis bookinger"})})]})}),e.jsx(je,{open:Y,onOpenChange:a=>{D(a),a||F()},children:e.jsxs(pe,{className:"max-w-3xl",children:[e.jsx(ke,{children:e.jsx(ve,{children:"Forhåndsvis bookingene"})}),I?e.jsx("p",{className:"text-muted-foreground italic",children:"Laster forhåndsvisning…"}):Z?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"overflow-auto max-h-[60vh] border rounded-md",children:e.jsxs(ce,{className:"text-sm",children:[e.jsx(ge,{children:e.jsxs(E,{children:[e.jsx(f,{children:"Dato"}),e.jsx(f,{children:"Klokkeslett"}),e.jsx(f,{children:"Bane"}),e.jsx(f,{children:"Beskrivelse"})]})}),e.jsx(ue,{children:K.map(a=>{const t=r.find(s=>s.id===a.baneId),l=c.konflikter.some(s=>s.baneId===a.baneId&&s.dato===a.dato&&s.startTid===a.startTid&&s.sluttTid===a.sluttTid);return e.jsxs(E,{className:l?"bg-yellow-100":"",children:[e.jsx(j,{children:le(a.dato)}),e.jsxs(j,{children:[a.startTid," – ",a.sluttTid]}),e.jsx(j,{children:t?.navn??"(ukjent bane)"}),e.jsxs(j,{children:[T,l&&e.jsx("span",{className:"ml-2 text-yellow-700 text-xs italic",children:"(Konflikt)"})]})]},`${a.dato}-${a.baneId}-${a.startTid}`)})})]})}),e.jsx(be,{className:"mt-3",children:e.jsxs(g,{type:"button",onClick:_,disabled:I,children:["Opprett ",c.ledige.length," bookinger"]})})]}):e.jsx("p",{className:"text-muted-foreground italic",children:"Ingen bookinger å vise."})]})})]})}export{$e as default};
