import{j as n,r as m}from"./shadcn-ciDZoPHa.js";import{P as B}from"./Page-DY-nzD88.js";import{T as U}from"./TabsLazyMount-D4WK3_Up.js";import{m as w,f as H,n as I,T as v,o as K,p as R,d as V,L as N}from"./index-DwBi739w.js";import{P as L,F as b}from"./FieldRow-CWaEdzBa.js";import{F as M,a as T}from"./FieldList-BQUYp8es.js";import{S as $}from"./SelectField-CTTPVZaf.js";import"./react-RGnvvjkK.js";import"./tabs-Bsc7dcri.js";import"./lucide-DUUYvuJp.js";import"./index-4Vwc2qQR.js";function G(e,i,l){return Math.min(l,Math.max(i,e))}function x({id:e,label:i,value:l,onChange:t,onValueChange:d,helpText:u,error:o,hideLabel:g=!1,min:r=0,max:a=10,step:s=1,disabled:k=!1,inputProps:f}){const y=[u&&!o?`${e}-help`:null,o?`${e}-error`:null].filter(Boolean).join(" ")||void 0;return n.jsx(w,{id:e,label:i,hideLabel:g,helpText:u,error:o,children:n.jsx("input",{id:e,type:"range",value:l,min:r,max:a,step:s,disabled:k,onChange:S=>{t?.(S);const p=Number(S.target.value),c=Number.isFinite(p)?G(p,r,a):l;d?.(c)},"aria-invalid":!!o,"aria-describedby":y,...f,className:H("w-full h-4","accent-primary","focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background",k&&"opacity-60",o&&"accent-destructive",f?.className)})})}function z({form:e,onChange:i,canSubmit:l,isSaving:t,onSubmit:d,touched:u,errors:o,onBlurField:g}){return n.jsxs(I,{onSubmit:r=>{r.preventDefault(),d()},children:[n.jsx(L,{title:"Grunninfo",description:"Informasjon som vises utad i Banebooking.",children:n.jsx(M,{children:n.jsxs(T,{children:[n.jsx(b,{title:"Klubbnavn",description:"Navnet på klubben slik det vises utad i Banebooking.",children:n.jsx(v,{id:"klubbnavn",label:"Klubbnavn",hideLabel:!0,value:e.navn,onValueChange:r=>i("navn",r),error:u.navn?o.navn:null,inputProps:{placeholder:"Ås tennisklubb",autoComplete:"organization",maxLength:60,onBlur:()=>g("navn")}})}),n.jsx(b,{title:"Kontakt-e-post",description:"Vises på klubbens infoside. Brukes til henvendelser fra medlemmer og gjester.",children:n.jsx(v,{id:"kontaktEpost",label:"Kontakt-e-post",hideLabel:!0,value:e.kontaktEpost,onValueChange:r=>i("kontaktEpost",r),error:u.kontaktEpost?o.kontaktEpost:null,inputProps:{placeholder:"post@klubb.no",type:"email",inputMode:"email",autoComplete:"email",onBlur:()=>g("kontaktEpost")}})})]})})}),n.jsx(L,{title:"Kart",description:"Valgfrie innstillinger for innhenting av værinformasjon.",children:n.jsx(M,{children:n.jsxs(T,{children:[n.jsx(b,{title:"Latitude (breddegrad)",children:n.jsx(v,{id:"latitude",label:"Latitude",hideLabel:!0,value:e.latitude,onValueChange:r=>i("latitude",r),inputProps:{placeholder:"f.eks. 59.6552",inputMode:"decimal"}})}),n.jsx(b,{title:"Longitude (lengdegrad)",children:n.jsx(v,{id:"longitude",label:"Longitude",hideLabel:!0,value:e.longitude,onValueChange:r=>i("longitude",r),inputProps:{placeholder:"f.eks. 10.7769",inputMode:"decimal"}})})]})})}),n.jsx(L,{title:"Feed",description:"Valgfrie innstillinger for innhenting av nyheter fra klubbens RSS-feed.",children:n.jsx(M,{children:n.jsxs(T,{children:[n.jsx(b,{title:"RSS-feed",description:"URL til klubbens RSS-feed. Hvis satt, hentes og vises de nyeste innleggene i appen.",children:n.jsx(v,{id:"feedUrl",label:"RSS-feed",hideLabel:!0,value:e.feedUrl,onValueChange:r=>i("feedUrl",r),inputProps:{placeholder:"https://www.aastk.no/?feed=rss2",inputMode:"url",type:"url"}})}),n.jsx(b,{title:"Aldergrense for feedinnslag (dager)",description:"Hvor mange dager gamle innslag som vises. Sett til 0 for å inkludere alle.",children:n.jsx(v,{id:"feedSynligAntallDager",label:"Aldergrense for feedinnslag (dager)",hideLabel:!0,value:e.feedSynligAntallDager,onValueChange:r=>i("feedSynligAntallDager",r),inputProps:{type:"number",inputMode:"numeric",min:0,step:1}})})]})})}),n.jsx(K,{children:n.jsx(R,{isLoading:t,disabled:!l,loadingText:"Lagrer...",className:"w-full sm:w-auto",children:"Lagre endringer"})})]})}const P=60,X=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;function _(e){const i=e.trim();return i?i.length<2?"Klubbnavn må være minst 2 tegn.":i.length>P?`Klubbnavn kan ikke være lengre enn ${P} tegn.`:null:"Klubbnavn kan ikke være tomt."}function O(e){const i=e.trim();return i?X.test(i)?null:"Skriv inn en gyldig e-postadresse.":"Kontakt-e-post kan ikke være tom."}function D(e){const i=e.trim();if(!i)return;const l=Number(i.replace(",","."));return Number.isFinite(l)?l:void 0}function q(){const{data:e,isLoading:i,oppdaterKlubb:l}=V(),[t,d]=m.useState({navn:"",kontaktEpost:"",banereglement:"",latitude:"",longitude:"",feedUrl:"",feedSynligAntallDager:""}),[u,o]=m.useState({navn:!1,kontaktEpost:!1});m.useEffect(()=>{e&&(d({navn:e.navn??"",kontaktEpost:e.kontaktEpost??"",banereglement:e.banereglement??"",latitude:e.latitude?.toString()??"",longitude:e.longitude?.toString()??"",feedUrl:e.feedUrl??"",feedSynligAntallDager:(e.feedSynligAntallDager??50).toString()}),o({navn:!1,kontaktEpost:!1}))},[e]);const g=m.useMemo(()=>({navn:_(t.navn),kontaktEpost:O(t.kontaktEpost)}),[t.navn,t.kontaktEpost]),r=m.useMemo(()=>e?(t.navn??"")!==(e.navn??"")||(t.kontaktEpost??"")!==(e.kontaktEpost??"")||(t.banereglement??"")!==(e.banereglement??"")||(t.latitude??"")!==(e.latitude?.toString()??"")||(t.longitude??"")!==(e.longitude?.toString()??"")||(t.feedUrl??"")!==(e.feedUrl??"")||(t.feedSynligAntallDager??"")!==(e.feedSynligAntallDager??50).toString():!1,[e,t]),a=m.useMemo(()=>!g.navn&&!g.kontaktEpost,[g]),s=r&&a;if(i||!e)return n.jsx(N,{});const k=(p,c)=>{d(h=>({...h,[p]:c}))};function f(p){o(c=>c[p]?c:{...c,[p]:!0})}function y(p){o(c=>{let h=!1;const E={...c};for(const F of p)E[F]||(E[F]=!0,h=!0);return h?E:c})}const S=()=>{if(y(["navn","kontaktEpost"]),!a)return;const p=D(t.latitude),c=D(t.longitude),h=D(t.feedSynligAntallDager);l.mutate({...e,navn:t.navn.trim(),kontaktEpost:t.kontaktEpost.trim(),banereglement:t.banereglement,latitude:p??e.latitude??null,longitude:c??e.longitude??null,feedUrl:t.feedUrl,feedSynligAntallDager:h??e.feedSynligAntallDager??50})};return n.jsx(z,{form:t,onChange:k,canSubmit:s,isSaving:l.isPending,onSubmit:S,touched:u,errors:g,onBlurField:f})}function A(e){return`${String(e).padStart(2,"0")}:00`}function J({aapningHour:e,stengeHour:i,booking:l,onChangeAapningHour:t,onChangeStengeHour:d,onChangeMaksPerDag:u,onChangeMaksTotalt:o,onChangeDagerFremITid:g,onChangeSlotLengdeMinutter:r,canSubmit:a,isSaving:s,onSubmit:k}){return n.jsxs(I,{onSubmit:f=>{f.preventDefault(),k()},children:[n.jsx(L,{title:"Bookinginnstillinger",description:"Styr åpningstider og bookinggrenser.",children:n.jsx(M,{children:n.jsxs(T,{children:[n.jsx(b,{title:"Åpningstid",description:"Tidligste starttidspunkt.",right:n.jsx("div",{className:"text-sm font-medium tabular-nums",children:A(e)}),children:n.jsx(x,{id:"aapningstid",label:"Åpningstid",hideLabel:!0,value:e,min:6,max:23,step:1,onValueChange:t})}),n.jsx(b,{title:"Stengetid",description:"Seneste starttidspunkt.",right:n.jsx("div",{className:"text-sm font-medium tabular-nums",children:A(i)}),children:n.jsx(x,{id:"stengetid",label:"Stengetid",hideLabel:!0,value:i,min:6,max:23,step:1,onValueChange:d})}),n.jsx(b,{title:"Maks bookinger per dag",description:"Per bruker.",right:n.jsx("div",{className:"text-sm font-medium tabular-nums",children:l.maksPerDag}),children:n.jsx(x,{id:"maksPerDag",label:"Maks bookinger per dag",hideLabel:!0,value:l.maksPerDag,min:0,max:5,step:1,onValueChange:u})}),n.jsx(b,{title:"Maks aktive bookinger",description:"Per bruker (totalt).",right:n.jsx("div",{className:"text-sm font-medium tabular-nums",children:l.maksTotalt}),children:n.jsx(x,{id:"maksTotalt",label:"Maks aktive bookinger",hideLabel:!0,value:l.maksTotalt,min:0,max:10,step:1,onValueChange:o})}),n.jsx(b,{title:"Hvor langt frem du kan booke",description:"Antall dager frem i tid.",right:n.jsx("div",{className:"text-sm font-medium tabular-nums",children:l.dagerFremITid}),children:n.jsx(x,{id:"dagerFremITid",label:"Hvor langt frem du kan booke",hideLabel:!0,value:l.dagerFremITid,min:1,max:14,step:1,onValueChange:g})}),n.jsx(b,{title:"Slot-lengde",description:"Låst i denne versjonen.",children:n.jsx($,{id:"slotLengdeMinutter",label:"Slot-lengde",hideLabel:!0,value:l.slotLengdeMinutter.toString(),onChange:r,options:[{label:"30 minutter",value:"30"},{label:"45 minutter",value:"45"},{label:"60 minutter",value:"60"},{label:"90 minutter",value:"90"}],disabled:!0})})]})})}),n.jsx(K,{children:n.jsx(R,{isLoading:s,disabled:!a,loadingText:"Lagrer...",className:"w-full sm:w-auto",children:"Lagre endringer"})})]})}function C(e){const i=parseInt((e??"").split(":")[0]??"0",10);return Number.isFinite(i)?i:0}function j(e){return`${String(e).padStart(2,"0")}:00`}function Q(){const{data:e,isLoading:i,oppdaterKlubb:l}=V(),[t,d]=m.useState({maksPerDag:1,maksTotalt:2,dagerFremITid:7,slotLengdeMinutter:60,aapningstid:"07:00",stengetid:"22:00"});m.useEffect(()=>{e?.bookingRegel&&d({maksPerDag:e.bookingRegel.maksPerDag??1,maksTotalt:e.bookingRegel.maksTotalt??2,dagerFremITid:e.bookingRegel.dagerFremITid??7,slotLengdeMinutter:e.bookingRegel.slotLengdeMinutter??60,aapningstid:e.bookingRegel.aapningstid??"07:00",stengetid:e.bookingRegel.stengetid??"22:00"})},[e]);const u=m.useMemo(()=>C(t.aapningstid),[t.aapningstid]),o=m.useMemo(()=>C(t.stengetid),[t.stengetid]);m.useEffect(()=>{if(u>=o){const a=Math.min(23,u+1);d(s=>({...s,stengetid:j(a)}))}},[u,o]);const g=m.useMemo(()=>{if(!e?.bookingRegel)return!1;const a=e.bookingRegel;return t.maksPerDag!==(a.maksPerDag??1)||t.maksTotalt!==(a.maksTotalt??2)||t.dagerFremITid!==(a.dagerFremITid??7)||t.slotLengdeMinutter!==(a.slotLengdeMinutter??60)||t.aapningstid!==(a.aapningstid??"07:00")||t.stengetid!==(a.stengetid??"22:00")},[e,t]);if(i||!e)return n.jsx(N,{});const r=()=>{l.mutate({navn:e.navn??"",kontaktEpost:e.kontaktEpost??"",banereglement:e.banereglement??"",latitude:e.latitude??null,longitude:e.longitude??null,feedUrl:e.feedUrl??null,feedSynligAntallDager:e.feedSynligAntallDager??7,bookingRegel:t})};return n.jsx(J,{aapningHour:u,stengeHour:o,booking:{maksPerDag:t.maksPerDag,maksTotalt:t.maksTotalt,dagerFremITid:t.dagerFremITid,slotLengdeMinutter:t.slotLengdeMinutter},onChangeAapningHour:a=>{const s=a,k=Math.max(o,s+1);d(f=>({...f,aapningstid:j(s),stengetid:j(Math.min(23,k))}))},onChangeStengeHour:a=>{const s=a,k=Math.min(u,s-1);d(f=>({...f,aapningstid:j(Math.max(6,k)),stengetid:j(s)}))},onChangeMaksPerDag:a=>d(s=>({...s,maksPerDag:a})),onChangeMaksTotalt:a=>d(s=>({...s,maksTotalt:a})),onChangeDagerFremITid:a=>d(s=>({...s,dagerFremITid:a})),onChangeSlotLengdeMinutter:a=>d(s=>({...s,slotLengdeMinutter:parseInt(a,10)})),canSubmit:g,isSaving:l.isPending,onSubmit:r})}function oe(){const[e,i]=m.useState("info");return n.jsx(B,{children:n.jsx(U,{items:[{value:"info",label:"Klubbinnstillinger",content:n.jsx(q,{})},{value:"booking",label:"Bookinginnstillinger",content:n.jsx(Q,{})}],value:e,onValueChange:i})})}export{oe as default};
