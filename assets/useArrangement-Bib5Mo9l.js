import{r as a}from"./shadcn-DDUjAgUv.js";import{f as g,u as F,t as i}from"./index-DPErGzPN.js";import{u as j}from"./useBaner-D9y-A84v.js";async function E(t){return await(await g(`/api/klubb/${t}/arrangement/kommende`,{},!0)).json()}async function M(t,e){return await(await g(`/api/klubb/${t}/arrangement/${e}`,{method:"DELETE"},!0)).json()}async function D(t,e){return await(await g(`/api/klubb/${t}/arrangement/forhandsvis`,{method:"POST",body:JSON.stringify(e)},!0)).json()}async function K(t,e){return await(await g(`/api/klubb/${t}/arrangement`,{method:"POST",body:JSON.stringify(e)},!0)).json()}function h(t){const[e,n]=t.split(":").map(Number);return e*60+n}function O(t){const e=String(Math.floor(t/60)).padStart(2,"0"),n=String(t%60).padStart(2,"0");return`${e}:${n}`}function R(t,e,n){const f=h(t),m=h(e),u=[];for(let o=f;o+n<=m;o+=n)u.push(O(o));return u}function J(t){const{klubb:e,isLoading:n}=F(t),{baner:f,isLoading:m}=j(),[u,o]=a.useState(!1),[k,l]=a.useState(!1),[y,d]=a.useState({ledige:[],konflikter:[]}),[A,v]=a.useState([]),w=a.useMemo(()=>{if(!e?.bookingRegel)return[];const s=e.bookingRegel.aapningstid||"08:00",r=e.bookingRegel.stengetid||"22:00",p=e.bookingRegel.slotLengdeMinutter||60;return R(s,r,p)},[e]),c=a.useCallback(async()=>{if(t){o(!0);try{const r=(await E(t)).sort((p,L)=>p.startDato.localeCompare(L.startDato));v(r)}catch{i.error("Feil ved henting av arrangementer")}finally{o(!1)}}},[t]);a.useEffect(()=>{c()},[c]);const S=async s=>{if(t){l(!0);try{const r=await D(t,s);return d(r),{success:!0}}catch{return i.error("Feil ved forhåndsvisning"),{success:!1}}finally{l(!1)}}},$=async s=>{if(t){l(!0);try{const r=await K(t,s);return d({ledige:[],konflikter:[]}),i.success(`${r.opprettet.length} bookinger opprettet`),await c(),{success:!0,result:r}}catch{return i.error("Feil ved oppretting"),{success:!1}}finally{l(!1)}}},[T,b]=a.useState(null);return{klubb:e,baner:f,isLoading:n||m||u,isLoadingForhandsvisning:k,sletterArrangementId:T,tilgjengeligeTidspunkter:w,forhandsvisning:y,setForhandsvisning:d,forhandsvis:S,opprett:$,slettArrangement:async s=>{if(t){b(s);try{const r=await M(t,s);i.success(`Arrangementet ble avlyst – ${r.antallBookingerDeaktivert} bookinger fjernet`),await c()}catch{i.error("Kunne ikke slette arrangementet")}finally{b(null)}}},arrangementer:A,lastArrangementer:c}}export{J as u};
