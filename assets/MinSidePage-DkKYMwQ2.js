import{r as g,j as e,e as G,f as re,w as se,c as F,s as ie,l as N,i as L,I as ae,k as I,P as oe,y as le}from"./shadcn-nsGv8pGm.js";import{P as ce}from"./Page-Cvsn-K9O.js";import{T as de}from"./Tabs-D2g4H0RK.js";import{u as A,b as O,t as k,a as ue,c as E,f as w,L as M,e as ge,B as D,g as pe,F as me,h as ve,I as fe,i as he,j as ke,l as be,m as xe}from"./index-CEYMlDzC.js";import{R as j,P as y,a as R,b as S}from"./RowList-BUnu8tIY.js";import{S as je,L as _}from"./SwitchRow-Cx41t_iY.js";import{B as ye}from"./BookingSlotItem-DkIIke8B.js";import{f as P}from"./datoUtils-Bzity_GL.js";import{A as Re,a as Se,b as Ne,c as Ae,d as we,e as Ce,f as Ie,g as Ee,h as De}from"./alert-dialog-DMLbJCjB.js";import{u as Pe}from"./index-lSrDbPdF.js";import{b as Ve}from"./lucide-ByRD2J1s.js";import"./react-RGnvvjkK.js";import"./tabs-CqimfX6u.js";import"./switch-eeOa4_z8.js";import"./index-BEQRqDzz.js";function Te(n=!1){const t=A(),r=O(["mineBookinger",t,n],`/klubb/${t}/bookinger/mine${n?"?inkluderHistoriske=true":""}`,{requireAuth:!0,staleTime:6e4}),s=g.useRef(!1);return g.useEffect(()=>{if(!r.error){s.current=!1;return}s.current||(k.error(r.error.message??"Ukjent feil ved henting av bookinger"),s.current=!0)},[r.error]),r}function Le(){const n=A(),t=ue(),r=()=>{t.invalidateQueries({queryKey:["mineBookinger",n]}),t.invalidateQueries({queryKey:["bookinger",n]})},s=E("delete",`/klubb/${n}/bookinger`,{onError:a=>{k.error(a.message??"Kunne ikke avbestille.")},onSuccess:()=>{k.info("Bookingen er avbestilt.")},onSettled:()=>{r()}});return{avbestill:a=>{s.mutate(a)},avbestillAsync:async a=>s.mutateAsync(a),isPending:s.isPending}}function V({label:n,value:t,description:r,className:s,density:o="default"}){return e.jsx(j,{title:n,description:r,density:o,className:s,children:e.jsx("div",{className:w("text-sm text-muted-foreground break-words"),children:t})})}function Me({slot:n}){const t=typeof n.temperatur=="number",r=typeof n.vind=="number";return!!n.værSymbol||t||r?e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx("span",{children:P(n.dato)}),e.jsx("span",{className:"w-[18px] h-[18px] flex items-center justify-center",children:n.værSymbol?e.jsx("img",{src:`/banebooking-voyager-fe/weather-symbols/svg/${n.værSymbol}.svg`,alt:n.værSymbol,width:18,height:18,className:"select-none",draggable:!1}):e.jsx("span",{className:"invisible",children:"."})}),t||r?e.jsxs("span",{className:"text-[11px] text-muted-foreground",children:[t?`${n.temperatur}°`:null,t&&r?" · ":null,r?`${n.vind} m/s`:null]}):null]}):e.jsx("span",{className:"flex items-center gap-1",children:e.jsx("span",{children:P(n.dato)})})}function Be(n){return[...n].sort((t,r)=>{const s=new Date(r.dato).getTime()-new Date(t.dato).getTime();return s!==0?s:r.startTid.localeCompare(t.startTid)})}function _e(n){return`${n.baneId}-${n.dato}-${n.startTid}-${n.sluttTid}`}function $e({visHistoriske:n,onToggleVisHistoriske:t,bookinger:r,isPending:s,openKey:o,onToggleOpenKey:i,onAvbestill:a}){const c=r.length>0,u=n?"Du har ingen registrerte bookinger.":"Du har ingen kommende bookinger.";return e.jsxs(y,{title:"Bookinger",description:"Se kommende bookinger og velg om du vil inkludere tidligere.",children:[e.jsx(R,{children:e.jsxs(S,{children:[e.jsx(je,{title:"Vis også tidligere bookinger",description:"Inkluder bookinger som allerede er gjennomført.",checked:n,onCheckedChange:t}),c?null:e.jsx(j,{title:"Ingen bookinger",description:u})]})}),c?e.jsx("div",{className:s?"pointer-events-none opacity-60 mt-4":"mt-4",children:r.map(l=>{const d=_e(l),p=o===d,m=!!l.kanAvbestille&&!l.erPassert;return e.jsx(ye,{slot:l,currentUser:null,erInteraktivOverride:m,isOpen:p,onToggle:()=>{m&&i(p?null:d)},onCancel:()=>a(l),headerOverrideTitle:l.baneNavn,headerLeftPrefix:e.jsx(Me,{slot:l})},d)})}):null]})}function Ge(){const[n,t]=g.useState(!1),[r,s]=g.useState(null),{data:o=[],isLoading:i}=Te(n),{avbestillAsync:a,isPending:c}=Le(),u=g.useMemo(()=>Be(o),[o]);async function l(d){c||(await a({baneId:d.baneId,dato:d.dato,startTid:d.startTid,sluttTid:d.sluttTid}),s(null))}return i?e.jsx(M,{}):e.jsx($e,{visHistoriske:n,onToggleVisHistoriske:d=>{t(d),s(null)},bookinger:u,isPending:c,openKey:r,onToggleOpenKey:s,onAvbestill:l})}function Fe({slettMeg:n,fullWidth:t=!1,disabled:r=!1,className:s}){const{signOut:o}=ge(),[i,a]=g.useState(!1),c=n.isPending,u=async()=>{try{await n.mutateAsync(),a(!1),await o()}catch{}};return e.jsxs(Re,{open:i,onOpenChange:a,children:[e.jsx(Se,{asChild:!0,children:e.jsx(D,{variant:"destructive",disabled:r||c,className:w(t&&"w-full",s),children:c?"Sletter...":"Slett min bruker"})}),e.jsxs(Ne,{children:[e.jsxs(Ae,{children:[e.jsx(we,{children:"Er du sikker?"}),e.jsx(Ce,{children:"Dette vil slette din bruker og all tilknytning permanent. Denne handlingen kan ikke angres."})]}),e.jsxs(Ie,{children:[e.jsx(Ee,{disabled:c,children:"Avbryt"}),e.jsx(De,{asChild:!0,children:e.jsx(D,{variant:"destructive",onClick:u,disabled:c,children:c?"Sletter...":"Slett bruker"})})]})]})]})}function K(){const n=A(),t=O(["meg",n],`/klubb/${n}/bruker/meg`,{requireAuth:!0,staleTime:6e4}),r=E("patch",`/klubb/${n}/bruker/meg`,{onSuccess:()=>{k.success("Visningsnavn oppdatert"),t.refetch()},onError:i=>{k.error(i.message??"Kunne ikke oppdatere visningsnavn")}}),s=E("delete",`/klubb/${n}/bruker/meg`,{onSuccess:()=>k.success("Brukeren er slettet"),onError:i=>k.error(i.message??"Kunne ikke slette bruker")}),o=async()=>{try{const i=await pe.get(`/klubb/${n}/bruker/meg/egen-data`,{requireAuth:!0,responseType:"blob"}),a=i.data,u=i.headers?.["content-disposition"]?.match(/filename\*=UTF-8''([^;]+)|filename="?([^"]+)"?/i),d=decodeURIComponent(u?.[1]??u?.[2]??"")||`banebooking-data-${new Date().toISOString().slice(0,10)}.json`,p=URL.createObjectURL(a),v=document.createElement("a");v.href=p,v.download=d,document.body.appendChild(v),v.click(),v.remove(),URL.revokeObjectURL(p)}catch(i){const a=i instanceof Error?i.message:"Kunne ikke laste ned egen data";k.error(a)}};return{bruker:t.data,laster:t.isLoading,error:t.error,refetch:t.refetch,lastNedEgenData:o,oppdaterVisningsnavn:r,slettMeg:s}}var B="Radio",[Oe,q]=F(B),[Ke,qe]=Oe(B),U=g.forwardRef((n,t)=>{const{__scopeRadio:r,name:s,checked:o=!1,required:i,disabled:a,value:c="on",onCheck:u,form:l,...d}=n,[p,v]=g.useState(null),m=L(t,b=>v(b)),f=g.useRef(!1),h=p?l||!!p.closest("form"):!0;return e.jsxs(Ke,{scope:r,checked:o,disabled:a,children:[e.jsx(N.button,{type:"button",role:"radio","aria-checked":o,"data-state":X(o),"data-disabled":a?"":void 0,disabled:a,value:c,...d,ref:m,onClick:I(n.onClick,b=>{o||u?.(),h&&(f.current=b.isPropagationStopped(),f.current||b.stopPropagation())})}),h&&e.jsx(Q,{control:p,bubbles:!f.current,name:s,value:c,checked:o,required:i,disabled:a,form:l,style:{transform:"translateX(-100%)"}})]})});U.displayName=B;var H="RadioIndicator",z=g.forwardRef((n,t)=>{const{__scopeRadio:r,forceMount:s,...o}=n,i=qe(H,r);return e.jsx(oe,{present:s||i.checked,children:e.jsx(N.span,{"data-state":X(i.checked),"data-disabled":i.disabled?"":void 0,...o,ref:t})})});z.displayName=H;var Ue="RadioBubbleInput",Q=g.forwardRef(({__scopeRadio:n,control:t,checked:r,bubbles:s=!0,...o},i)=>{const a=g.useRef(null),c=L(a,i),u=Pe(r),l=le(t);return g.useEffect(()=>{const d=a.current;if(!d)return;const p=window.HTMLInputElement.prototype,m=Object.getOwnPropertyDescriptor(p,"checked").set;if(u!==r&&m){const f=new Event("click",{bubbles:s});m.call(d,r),d.dispatchEvent(f)}},[u,r,s]),e.jsx(N.input,{type:"radio","aria-hidden":!0,defaultChecked:r,...o,tabIndex:-1,ref:c,style:{...o.style,...l,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});Q.displayName=Ue;function X(n){return n?"checked":"unchecked"}var He=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],C="RadioGroup",[ze,yn]=F(C,[G,q]),W=G(),J=q(),[Qe,Xe]=ze(C),Y=g.forwardRef((n,t)=>{const{__scopeRadioGroup:r,name:s,defaultValue:o,value:i,required:a=!1,disabled:c=!1,orientation:u,dir:l,loop:d=!0,onValueChange:p,...v}=n,m=W(r),f=re(l),[h,b]=se({prop:i,defaultProp:o??null,onChange:p,caller:C});return e.jsx(Qe,{scope:r,name:s,required:a,disabled:c,value:h,onValueChange:b,children:e.jsx(ie,{asChild:!0,...m,orientation:u,dir:f,loop:d,children:e.jsx(N.div,{role:"radiogroup","aria-required":a,"aria-orientation":u,"data-disabled":c?"":void 0,dir:f,...v,ref:t})})})});Y.displayName=C;var Z="RadioGroupItem",ee=g.forwardRef((n,t)=>{const{__scopeRadioGroup:r,disabled:s,...o}=n,i=Xe(Z,r),a=i.disabled||s,c=W(r),u=J(r),l=g.useRef(null),d=L(t,l),p=i.value===o.value,v=g.useRef(!1);return g.useEffect(()=>{const m=h=>{He.includes(h.key)&&(v.current=!0)},f=()=>v.current=!1;return document.addEventListener("keydown",m),document.addEventListener("keyup",f),()=>{document.removeEventListener("keydown",m),document.removeEventListener("keyup",f)}},[]),e.jsx(ae,{asChild:!0,...c,focusable:!a,active:p,children:e.jsx(U,{disabled:a,required:i.required,checked:p,...u,...o,name:i.name,ref:d,onCheck:()=>i.onValueChange(o.value),onKeyDown:I(m=>{m.key==="Enter"&&m.preventDefault()}),onFocus:I(o.onFocus,()=>{v.current&&l.current?.click()})})})});ee.displayName=Z;var We="RadioGroupIndicator",ne=g.forwardRef((n,t)=>{const{__scopeRadioGroup:r,...s}=n,o=J(r);return e.jsx(z,{...o,...s,ref:t})});ne.displayName=We;var Je=Y,Ye=ee,Ze=ne;function en({className:n,...t}){return e.jsx(Je,{"data-slot":"radio-group",className:w("grid gap-3",n),...t})}function $({className:n,...t}){return e.jsx(Ye,{"data-slot":"radio-group-item",className:w("border-input text-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 aspect-square size-4 shrink-0 rounded-full border shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",n),...t,children:e.jsx(Ze,{"data-slot":"radio-group-indicator",className:"relative flex items-center justify-center",children:e.jsx(Ve,{className:"fill-primary absolute top-1/2 left-1/2 size-2 -translate-x-1/2 -translate-y-1/2"})})})}function nn({epost:n,rollerText:t,mode:r,onSetMode:s,visningsnavn:o,onChangeVisningsnavn:i,maxLength:a,canSubmit:c,isSaving:u,error:l,onSubmit:d,deleteAction:p,isDeleteDisabled:v=!1}){return e.jsxs(me,{density:"default",onSubmit:m=>{m.preventDefault(),d()},children:[e.jsxs(y,{title:"Innstillinger",description:"Velg hva som vises som navnet ditt i appen.",children:[e.jsx(R,{children:e.jsxs(S,{children:[e.jsx(j,{title:"Visningsnavn",description:"Velg e-post eller et eget navn.",children:e.jsxs(en,{value:r,onValueChange:m=>s(m==="epost"?"epost":"navn"),className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{value:"epost",id:"visningsnavn-epost"}),e.jsxs(_,{htmlFor:"visningsnavn-epost",children:["E-post (",n,")"]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx($,{value:"navn",id:"visningsnavn-navn"}),e.jsx(_,{htmlFor:"visningsnavn-navn",children:"Eget navn"})]})]})}),r==="navn"?e.jsx(j,{children:e.jsxs(ve,{"data-invalid":!!l,children:[e.jsx(fe,{id:"visningsnavn",value:o,onChange:m=>i(m.target.value),placeholder:`F.eks. Ola Nordmann (maks ${a} tegn)`,maxLength:a,autoComplete:"name","aria-invalid":!!l}),l?e.jsx(he,{children:l}):null]})}):null]})}),e.jsx(ke,{align:"left",spaced:!1,className:"w-full mt-4",children:e.jsx(be,{isLoading:u,disabled:!c,fullWidth:!0,children:"Lagre endringer"})})]}),e.jsx(y,{title:"Konto",description:"Kontoinformasjon og tilgang. Enkelte opplysninger administreres av klubben.",children:e.jsx(R,{children:e.jsxs(S,{children:[e.jsx(V,{label:"Brukernavn / ID",value:n}),e.jsx(V,{label:"Tilgang",value:t}),e.jsx(j,{title:"Slett min bruker",description:"Sletter bruker og all tilknyttet data permanent.",right:e.jsx("div",{className:v?"pointer-events-none opacity-60":"",children:p})})]})})})]})}const T=50,tn=/^[\p{L}\d\s.@'_%+-]{3,}$/u;function rn(n){const t=n.trim();return t.length===0?"Visningsnavn kan ikke være tomt.":t.length<3?"Visningsnavn må være minst 3 tegn.":tn.test(t)?t.length>T?`Visningsnavn kan ikke være lengre enn ${T} tegn.`:null:"Visningsnavn inneholder ugyldige tegn."}function sn(){const{bruker:n,laster:t,oppdaterVisningsnavn:r,slettMeg:s}=K(),{mutateAsync:o,isPending:i}=r,[a,c]=g.useState("epost"),[u,l]=g.useState(""),[d,p]=g.useState(null);if(g.useEffect(()=>{if(!n)return;const x=n.visningsnavn?.trim();!x||x===n.epost?(c("epost"),l("")):(c("navn"),l(x)),p(null)},[n]),t||!n)return e.jsx(M,{});const v=a==="epost"?n.epost:u.trim(),m=(n.visningsnavn??"").trim(),f=v,h=a==="navn"?rn(u):null,b=f.length>0&&f!==m&&(a==="epost"||!h);async function te(){p(h),!h&&await o({visningsnavn:v})}return e.jsx(nn,{epost:n.epost,rollerText:n.roller.join(", "),mode:a,onSetMode:x=>{c(x),p(null)},visningsnavn:u,onChangeVisningsnavn:x=>{l(x),d&&p(null)},maxLength:T,error:d,canSubmit:b,isSaving:i,onSubmit:()=>void te(),deleteAction:e.jsx(Fe,{slettMeg:s}),isDeleteDisabled:i})}function an(){const n=A(),{bruker:t,laster:r,lastNedEgenData:s,slettMeg:o}=K(),[i,a]=g.useState(!1);if(r||!t)return e.jsx(M,{});const c=t.vilkaarAkseptertDato?`Akseptert ${P(t.vilkaarAkseptertDato)}${t.vilkaarVersjon?` (versjon ${t.vilkaarVersjon})`:""}`:"Ikke registrert",u=async()=>{if(!i)try{a(!0),await s()}catch(l){const d=l instanceof Error?l.message:"Kunne ikke laste ned egen data";k.error(d)}finally{a(!1)}};return e.jsx("div",{children:e.jsx(y,{title:"Persondata",description:"Her kan du se vilkår og laste ned egne data.",children:e.jsx(R,{children:e.jsxs(S,{children:[e.jsx(V,{label:"Vilkår",description:"Vilkårene aksepteres automatisk ved første innlogging.",value:c}),e.jsx(j,{title:"Les vilkårene",description:"Åpnes i ny fane.",right:e.jsx(xe,{to:`/${n}/vilkaar`,className:"text-sm underline text-primary hover:text-primary/80",target:"_blank",rel:"noopener noreferrer",children:"Åpne"})}),e.jsx(j,{title:"Last ned dine data",description:"JSON med registrerte opplysninger og bookinger.",right:e.jsx(D,{onClick:u,size:"sm",variant:"outline",disabled:i||o.isPending,children:i?"Laster...":"Last ned"})})]})})})})}function Rn(){return e.jsx(ce,{children:e.jsx(de,{defaultValue:"bookinger",items:[{value:"bookinger",label:"Mine bookinger",content:e.jsx(Ge,{})},{value:"profil",label:"Min profil",content:e.jsx(sn,{})},{value:"persondata",label:"Persondata",content:e.jsx(an,{})}]})})}export{Rn as default};
