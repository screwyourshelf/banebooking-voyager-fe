import{r as o,j as e}from"./shadcn-nsGv8pGm.js";import{u as q,a as F,b as P,c as Q,t as N,v as I,L as U,B as m,h as C,I as S,f as V}from"./index-CEYMlDzC.js";import{P as z,a as L,b as w,R as v}from"./RowList-BUnu8tIY.js";import{S as $}from"./switch-eeOa4_z8.js";import{D as O,b as T,c as H,d as W,f as _}from"./dialog-FwmrfKZx.js";import"./react-RGnvvjkK.js";import"./lucide-ByRD2J1s.js";import"./index-lSrDbPdF.js";import"./index-BEQRqDzz.js";function G(){const r=q(),k=F(),d=["admin-brukere",r],i=P(d,`/klubb/${r}/bruker/admin/bruker`,{requireAuth:!0,staleTime:3e4}),x=Q("put",({brukerId:l})=>`/klubb/${r}/bruker/admin/bruker/${l}`,{onSuccess:async()=>{N.success("Bruker oppdatert"),await k.invalidateQueries({queryKey:d})},onError:l=>N.error(l.message??"Kunne ikke oppdatere bruker"),retry:!1}),u=async(l,a)=>{await x.mutateAsync({brukerId:l,rolle:a.rolle,visningsnavn:a.visningsnavn})};return{brukere:i.data??[],laster:i.isLoading,oppdaterLaster:x.isPending,oppdater:u,hentBrukere:i.refetch,error:i.error?.message??null}}const J=["Medlem","Utvidet","KlubbAdmin"];function R(r){return r?r.toLowerCase().startsWith("slettet_"):!1}function ie(){const{bruker:r,laster:k}=I(),{brukere:d,laster:i,oppdater:x,oppdaterLaster:u}=G(),l=r?.roller.includes("KlubbAdmin"),[a,B]=o.useState(""),[j,M]=o.useState(!1),[c,b]=o.useState([]),[p,g]=o.useState(null),[h,f]=o.useState({rolle:"Medlem",visningsnavn:""}),y=o.useMemo(()=>{const s=a.toLowerCase().trim();return d.filter(t=>!(!j&&R(t.epost))).filter(t=>{if(c.length===0)return!0;const n=t.roller?.[0]??"Medlem";return c.includes(n)}).filter(t=>s?t.epost?.toLowerCase().includes(s)||t.visningsnavn?.toLowerCase().includes(s):!0)},[d,a,j,c]),A=s=>{g(s),f({rolle:s.roller?.[0]??"Medlem"??"Medlem",visningsnavn:s.visningsnavn??""})},K=async()=>{p&&(await x(p.id,{rolle:h.rolle,visningsnavn:h.visningsnavn}),g(null))};function D(s){b(t=>t.includes(s)?t.filter(n=>n!==s):[...t,s])}return k?e.jsx(U,{}):l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(z,{title:"Brukere",description:"Søk etter brukere og endre rolle eller visningsnavn.",children:[e.jsx(L,{children:e.jsxs(w,{children:[e.jsxs(v,{title:"Filter på rolle",description:"",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:J.map(s=>{const t=c.includes(s);return e.jsx(m,{type:"button",size:"sm",variant:t?"default":"outline",onClick:()=>D(s),className:"h-8 px-3",children:s},s)})}),c.length>0?e.jsx("div",{className:"mt-2",children:e.jsx(m,{type:"button",size:"sm",variant:"ghost",onClick:()=>b([]),className:"h-8 px-2 text-muted-foreground",children:"Nullstill filter"})}):null]}),e.jsx(v,{title:"Vis slettede brukere",description:"Inkluder brukere som er anonymisert eller slettet.",right:e.jsx($,{checked:j,onCheckedChange:M})}),e.jsx(v,{title:"Søk",description:"",children:e.jsx(C,{children:e.jsx(S,{id:"brukersok",value:a,onChange:s=>B(s.target.value),placeholder:"Søk på e-post eller visningsnavn…",inputMode:"search",className:"bg-background"})})})]})}),e.jsx("div",{className:"mt-4",children:i?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Laster brukere…"}):y.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ingen brukere funnet."}):e.jsx(L,{children:e.jsx(w,{children:y.map(s=>{const t=s.id===r?.id,n=R(s.epost),E=s.roller?.[0]??"Medlem";return e.jsx(v,{title:s.epost??"Ukjent bruker",description:s.visningsnavn||(n?"Slettet/anonymisert":""),right:!t&&!n?e.jsx(m,{type:"button",size:"sm",variant:"outline",onClick:()=>A(s),children:"Rediger"}):null,className:V(n&&"opacity-70"),children:e.jsxs("div",{className:"text-sm text-foreground",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rolle: "}),E,n?e.jsx("span",{className:"text-muted-foreground",children:" (slettet)"}):null]})},s.id)})})})})]}),p?e.jsx(O,{open:!0,onOpenChange:s=>{s||g(null)},children:e.jsxs(T,{children:[e.jsx(H,{children:e.jsx(W,{children:"Rediger bruker"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Bruker"}),e.jsx("div",{className:"text-sm font-medium break-words",children:p.epost})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Visningsnavn"}),e.jsx(C,{children:e.jsx(S,{id:"visningsnavn",value:h.visningsnavn,onChange:s=>f(t=>({...t,visningsnavn:s.target.value})),placeholder:"Valgfritt",className:"bg-background"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Rolle"}),e.jsxs("select",{className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:h.rolle,onChange:s=>f(t=>({...t,rolle:s.target.value})),children:[e.jsx("option",{value:"Medlem",children:"Medlem"}),e.jsx("option",{value:"Utvidet",children:"Utvidet"}),e.jsx("option",{value:"KlubbAdmin",children:"KlubbAdmin"})]})]})]}),e.jsxs(_,{children:[e.jsx(m,{variant:"ghost",onClick:()=>g(null),disabled:u,children:"Avbryt"}),e.jsx(m,{onClick:K,disabled:u,children:u?"Lagrer...":"Lagre"})]})]})}):null]}):e.jsx("p",{className:"text-sm text-destructive px-2 py-2 text-center",children:"Du har ikke tilgang til denne siden."})}export{ie as default};
