import{r as i,c as X,y as Pe,w as Me,j as e,x as O,i as y,l as C,k,P as V,h as Ie,m as $e,p as Fe,q as Le,o as Ve,F as Be,D as We,z as Ge}from"./shadcn-C7L97JSy.js";import{t as h,f as B,d as v,e as J,u as He,B as Z,g as Ke,S as ze,L as P}from"./index-CLcGcOOg.js";import{b as qe}from"./booking-CPUZoGRJ.js";import{u as Ue,f as A,T as q,a as U,b as w,c as j,d as Y,e as b}from"./datoUtils-CMXRwgbA.js";import{T as Ye,a as Xe,b as M,c as I}from"./useBaner-ChMZrMEa.js";import{C as $,a as F,F as T}from"./FieldWrapper-BGJI4bnr.js";import{F as Je}from"./FormField-B7mu1GwO.js";import"./react-D5d5vywP.js";import"./lucide-CAh2A4Ey.js";function Ze(t){const[r,a]=i.useState([]),[s,n]=i.useState(!0),[o,l]=i.useState(null),d=i.useCallback(async()=>{if(t)try{n(!0),l(null);const u=await qe(t);a(u)}catch(u){const g=u instanceof Error?u.message:"Ukjent feil ved henting";l(g),h.error(g)}finally{n(!1)}},[t]);return i.useEffect(()=>{d()},[d]),{bookinger:r,laster:s,error:o,refetch:d}}async function Qe(t){const r=await B(`/api/klubb/${t}/bruker/meg`,{method:"GET"},!0);if(!r.ok){const a=await r.text();throw new Error(a||"Kunne ikke hente meg")}return await r.json()}async function et(t,r){const a=await B(`/api/klubb/${t}/bruker/meg`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},!0);if(!a.ok){const s=await a.text();throw new Error(s||"Kunne ikke oppdatere visningsnavn")}}async function tt(t){const r=await B(`/api/klubb/${t}/bruker/meg`,{method:"DELETE"},!0);if(!r.ok){const a=await r.text();throw new Error(a||"Kunne ikke slette brukeren")}}function rt(t){const[r,a]=i.useState(null),[s,n]=i.useState(!0),[o,l]=i.useState(null),d=i.useCallback(async()=>{if(t){n(!0);try{const f=await Qe(t);a(f),l(null)}catch(f){const p=f instanceof Error?f.message:"Ukjent feil ved henting";l(p),h.error(p),a(null)}finally{n(!1)}}},[t]),u=i.useCallback(async f=>{if(!(!r||!t))try{await et(t,{visningsnavn:f}),a({...r,visningsnavn:f}),h.success("Visningsnavn lagret")}catch(p){const E=p instanceof Error?p.message:"Kunne ikke lagre visningsnavn";h.error(E)}},[t,r]),g=i.useCallback(async()=>{if(t)try{await tt(t),a(null),h.success("Brukeren er slettet")}catch(f){const p=f instanceof Error?f.message:"Kunne ikke slette bruker";h.error(p)}},[t]);return i.useEffect(()=>{d()},[d]),{bruker:r,laster:s,feil:o,oppdaterVisningsnavn:u,refetch:d,slettMeg:g}}var R="Dialog",[Q,ee]=X(R),[at,m]=Q(R),te=t=>{const{__scopeDialog:r,children:a,open:s,defaultOpen:n,onOpenChange:o,modal:l=!0}=t,d=i.useRef(null),u=i.useRef(null),[g,f]=Me({prop:s,defaultProp:n??!1,onChange:o,caller:R});return e.jsx(at,{scope:r,triggerRef:d,contentRef:u,contentId:O(),titleId:O(),descriptionId:O(),open:g,onOpenChange:f,onOpenToggle:i.useCallback(()=>f(p=>!p),[f]),modal:l,children:a})};te.displayName=R;var re="DialogTrigger",ae=i.forwardRef((t,r)=>{const{__scopeDialog:a,...s}=t,n=m(re,a),o=y(r,n.triggerRef);return e.jsx(C.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":H(n.open),...s,ref:o,onClick:k(t.onClick,n.onOpenToggle)})});ae.displayName=re;var W="DialogPortal",[nt,ne]=Q(W,{forceMount:void 0}),se=t=>{const{__scopeDialog:r,forceMount:a,children:s,container:n}=t,o=m(W,r);return e.jsx(nt,{scope:r,forceMount:a,children:i.Children.map(s,l=>e.jsx(V,{present:a||o.open,children:e.jsx(Ie,{asChild:!0,container:n,children:l})}))})};se.displayName=W;var _="DialogOverlay",oe=i.forwardRef((t,r)=>{const a=ne(_,t.__scopeDialog),{forceMount:s=a.forceMount,...n}=t,o=m(_,t.__scopeDialog);return o.modal?e.jsx(V,{present:s||o.open,children:e.jsx(ot,{...n,ref:r})}):null});oe.displayName=_;var st=Le("DialogOverlay.RemoveScroll"),ot=i.forwardRef((t,r)=>{const{__scopeDialog:a,...s}=t,n=m(_,a);return e.jsx(Fe,{as:st,allowPinchZoom:!0,shards:[n.contentRef],children:e.jsx(C.div,{"data-state":H(n.open),...s,ref:r,style:{pointerEvents:"auto",...s.style}})})}),D="DialogContent",ie=i.forwardRef((t,r)=>{const a=ne(D,t.__scopeDialog),{forceMount:s=a.forceMount,...n}=t,o=m(D,t.__scopeDialog);return e.jsx(V,{present:s||o.open,children:o.modal?e.jsx(it,{...n,ref:r}):e.jsx(lt,{...n,ref:r})})});ie.displayName=D;var it=i.forwardRef((t,r)=>{const a=m(D,t.__scopeDialog),s=i.useRef(null),n=y(r,a.contentRef,s);return i.useEffect(()=>{const o=s.current;if(o)return $e(o)},[]),e.jsx(le,{...t,ref:n,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:k(t.onCloseAutoFocus,o=>{var l;o.preventDefault(),(l=a.triggerRef.current)==null||l.focus()}),onPointerDownOutside:k(t.onPointerDownOutside,o=>{const l=o.detail.originalEvent,d=l.button===0&&l.ctrlKey===!0;(l.button===2||d)&&o.preventDefault()}),onFocusOutside:k(t.onFocusOutside,o=>o.preventDefault())})}),lt=i.forwardRef((t,r)=>{const a=m(D,t.__scopeDialog),s=i.useRef(!1),n=i.useRef(!1);return e.jsx(le,{...t,ref:r,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var l,d;(l=t.onCloseAutoFocus)==null||l.call(t,o),o.defaultPrevented||(s.current||(d=a.triggerRef.current)==null||d.focus(),o.preventDefault()),s.current=!1,n.current=!1},onInteractOutside:o=>{var u,g;(u=t.onInteractOutside)==null||u.call(t,o),o.defaultPrevented||(s.current=!0,o.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const l=o.target;((g=a.triggerRef.current)==null?void 0:g.contains(l))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&n.current&&o.preventDefault()}})}),le=i.forwardRef((t,r)=>{const{__scopeDialog:a,trapFocus:s,onOpenAutoFocus:n,onCloseAutoFocus:o,...l}=t,d=m(D,a),u=i.useRef(null),g=y(r,u);return Ve(),e.jsxs(e.Fragment,{children:[e.jsx(Be,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:n,onUnmountAutoFocus:o,children:e.jsx(We,{role:"dialog",id:d.contentId,"aria-describedby":d.descriptionId,"aria-labelledby":d.titleId,"data-state":H(d.open),...l,ref:g,onDismiss:()=>d.onOpenChange(!1)})}),e.jsxs(e.Fragment,{children:[e.jsx(dt,{titleId:d.titleId}),e.jsx(gt,{contentRef:u,descriptionId:d.descriptionId})]})]})}),G="DialogTitle",ce=i.forwardRef((t,r)=>{const{__scopeDialog:a,...s}=t,n=m(G,a);return e.jsx(C.h2,{id:n.titleId,...s,ref:r})});ce.displayName=G;var de="DialogDescription",ue=i.forwardRef((t,r)=>{const{__scopeDialog:a,...s}=t,n=m(de,a);return e.jsx(C.p,{id:n.descriptionId,...s,ref:r})});ue.displayName=de;var ge="DialogClose",fe=i.forwardRef((t,r)=>{const{__scopeDialog:a,...s}=t,n=m(ge,a);return e.jsx(C.button,{type:"button",...s,ref:r,onClick:k(t.onClick,()=>n.onOpenChange(!1))})});fe.displayName=ge;function H(t){return t?"open":"closed"}var pe="DialogTitleWarning",[ct,me]=Pe(pe,{contentName:D,titleName:G,docsSlug:"dialog"}),dt=({titleId:t})=>{const r=me(pe),a=`\`${r.contentName}\` requires a \`${r.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${r.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${r.docsSlug}`;return i.useEffect(()=>{t&&(document.getElementById(t)||console.error(a))},[a,t]),null},ut="DialogDescriptionWarning",gt=({contentRef:t,descriptionId:r})=>{const s=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${me(ut).contentName}}.`;return i.useEffect(()=>{var o;const n=(o=t.current)==null?void 0:o.getAttribute("aria-describedby");r&&n&&(document.getElementById(r)||console.warn(s))},[s,t,r]),null},ft=te,pt=ae,mt=se,xt=oe,ht=ie,vt=ce,Dt=ue,xe=fe,he="AlertDialog",[jt,or]=X(he,[ee]),x=ee(),ve=t=>{const{__scopeAlertDialog:r,...a}=t,s=x(r);return e.jsx(ft,{...s,...a,modal:!0})};ve.displayName=he;var bt="AlertDialogTrigger",De=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...s}=t,n=x(a);return e.jsx(pt,{...n,...s,ref:r})});De.displayName=bt;var kt="AlertDialogPortal",je=t=>{const{__scopeAlertDialog:r,...a}=t,s=x(r);return e.jsx(mt,{...s,...a})};je.displayName=kt;var Nt="AlertDialogOverlay",be=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...s}=t,n=x(a);return e.jsx(xt,{...n,...s,ref:r})});be.displayName=Nt;var N="AlertDialogContent",[At,yt]=jt(N),Ct=Ge("AlertDialogContent"),ke=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,children:s,...n}=t,o=x(a),l=i.useRef(null),d=y(r,l),u=i.useRef(null);return e.jsx(ct,{contentName:N,titleName:Ne,docsSlug:"alert-dialog",children:e.jsx(At,{scope:a,cancelRef:u,children:e.jsxs(ht,{role:"alertdialog",...o,...n,ref:d,onOpenAutoFocus:k(n.onOpenAutoFocus,g=>{var f;g.preventDefault(),(f=u.current)==null||f.focus({preventScroll:!0})}),onPointerDownOutside:g=>g.preventDefault(),onInteractOutside:g=>g.preventDefault(),children:[e.jsx(Ct,{children:s}),e.jsx(wt,{contentRef:l})]})})})});ke.displayName=N;var Ne="AlertDialogTitle",Ae=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...s}=t,n=x(a);return e.jsx(vt,{...n,...s,ref:r})});Ae.displayName=Ne;var ye="AlertDialogDescription",Ce=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...s}=t,n=x(a);return e.jsx(Dt,{...n,...s,ref:r})});Ce.displayName=ye;var Et="AlertDialogAction",Ee=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...s}=t,n=x(a);return e.jsx(xe,{...n,...s,ref:r})});Ee.displayName=Et;var we="AlertDialogCancel",Te=i.forwardRef((t,r)=>{const{__scopeAlertDialog:a,...s}=t,{cancelRef:n}=yt(we,a),o=x(a),l=y(r,n);return e.jsx(xe,{...o,...s,ref:l})});Te.displayName=we;var wt=({contentRef:t})=>{const r=`\`${N}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${N}\` by passing a \`${ye}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${N}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return i.useEffect(()=>{var s;document.getElementById((s=t.current)==null?void 0:s.getAttribute("aria-describedby"))||console.warn(r)},[r,t]),null},Tt=ve,_t=De,Rt=je,St=be,Ot=ke,Pt=Ee,Mt=Te,It=Ae,$t=Ce;function Ft({...t}){return e.jsx(Tt,{"data-slot":"alert-dialog",...t})}function Lt({...t}){return e.jsx(_t,{"data-slot":"alert-dialog-trigger",...t})}function Vt({...t}){return e.jsx(Rt,{"data-slot":"alert-dialog-portal",...t})}function Bt({className:t,...r}){return e.jsx(St,{"data-slot":"alert-dialog-overlay",className:v("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",t),...r})}function Wt({className:t,...r}){return e.jsxs(Vt,{children:[e.jsx(Bt,{}),e.jsx(Ot,{"data-slot":"alert-dialog-content",className:v("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",t),...r})]})}function Gt({className:t,...r}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:v("flex flex-col gap-2 text-center sm:text-left",t),...r})}function Ht({className:t,...r}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:v("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",t),...r})}function Kt({className:t,...r}){return e.jsx(It,{"data-slot":"alert-dialog-title",className:v("text-lg font-semibold",t),...r})}function zt({className:t,...r}){return e.jsx($t,{"data-slot":"alert-dialog-description",className:v("text-muted-foreground text-sm",t),...r})}function qt({className:t,...r}){return e.jsx(Pt,{className:v(J(),t),...r})}function Ut({className:t,...r}){return e.jsx(Mt,{className:v(J({variant:"outline"}),t),...r})}function Yt({slettMeg:t}){const{signOut:r}=He(),[a,s]=i.useState(!1),[n,o]=i.useState(!1),l=async()=>{o(!0);try{await t(),h.success("Brukeren er slettet"),s(!1),await r()}catch{h.error("Noe gikk galt ved sletting")}finally{o(!1)}};return e.jsxs(Ft,{open:a,onOpenChange:s,children:[e.jsx(Lt,{asChild:!0,children:e.jsx(Z,{variant:"destructive",children:"Slett min bruker"})}),e.jsxs(Wt,{children:[e.jsxs(Gt,{children:[e.jsx(Kt,{children:"Er du sikker?"}),e.jsx(zt,{children:"Dette vil slette din bruker og all tilknytning permanent. Denne handlingen kan ikke angres."})]}),e.jsxs(Ht,{children:[e.jsx(Ut,{disabled:n,children:"Avbryt"}),e.jsx(qt,{className:"bg-red-600 hover:bg-red-700 focus:ring-red-600",onClick:l,disabled:n,children:n?"Sletter...":"Slett bruker"})]})]})]})}const L=50,Xt=/^[\p{L}\d\s.@'_%+-]{2,}$/u;function ir(){const{slug:t}=Ke(),r=i.useContext(ze)??t,[a,s]=i.useState("profil"),{bruker:n,laster:o,oppdaterVisningsnavn:l,slettMeg:d}=rt(r),[u,g]=i.useState(""),[f,p]=i.useState(null),{bookinger:E,laster:_e}=Ze(r),{arrangementer:K,isLoading:Re}=Ue(r);i.useEffect(()=>{var c;n&&g(((c=n.visningsnavn)==null?void 0:c.trim())||n.epost)},[n]);const Se=()=>{const c=u.trim();if(c.length===0){p("Visningsnavn kan ikke være tomt.");return}if(c.length<3){p("Visningsnavn må være minst 3 tegn.");return}if(!Xt.test(c)){p("Visningsnavn inneholder ugyldige tegn.");return}if(c.length>L){p(`Visningsnavn kan ikke være lengre enn ${L} tegn.`);return}p(null),l(c)};return e.jsx("div",{className:"max-w-screen-md mx-auto px-2 py-4",children:e.jsxs(Ye,{value:a,onValueChange:s,children:[e.jsxs(Xe,{className:"mb-4",children:[e.jsx(M,{value:"profil",children:"Min profil"}),e.jsx(M,{value:"bookinger",children:"Mine bookinger"}),e.jsx(M,{value:"arrangementer",children:"Arrangementer"})]}),e.jsx(I,{value:"profil",children:e.jsx($,{children:e.jsx(F,{className:"p-4 space-y-6",children:o||!n?e.jsx(P,{}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"space-y-4",onSubmit:c=>{c.preventDefault(),Se()},children:[e.jsx(Je,{id:"visningsnavn",label:"Visningsnavn",value:u,maxLength:L,placeholder:"f.eks. Ola Nordmann",onChange:c=>g(c.target.value),error:f,helpText:"Navnet vises i grensesnittet, og settes automatisk til e-post ved første innlogging. Du kan endre det her. Navnet må være saklig og respektfullt – støtende navn kan føre til at profilen blir sperret."}),e.jsx(Z,{type:"submit",size:"sm",children:"Lagre"})]}),e.jsxs("div",{className:"pt-4 border-t mt-4 space-y-4",children:[e.jsx(T,{id:"epost",label:"Brukernavn / ID",children:e.jsx("p",{className:"text-sm text-foreground",children:n.epost})}),e.jsx(T,{id:"rolle",label:"Rolle (i klubben)",helpText:"Roller tildeles av klubbens administrator og kan ikke endres manuelt.",children:e.jsx("p",{className:"text-sm text-foreground",children:n.roller.join(", ")})}),e.jsxs(T,{id:"vilkaar",label:"Vilkår for bruk",helpText:"Du aksepterer vilkårene automatisk ved første innlogging.",children:[n.vilkaarAkseptertDato?e.jsxs("p",{className:"text-sm text-foreground",children:["Akseptert ",A(n.vilkaarAkseptertDato)," ",n.vilkaarVersjon&&`(versjon ${n.vilkaarVersjon})`]}):e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ikke registrert"}),e.jsx("p",{className:"text-sm mt-1",children:e.jsx("a",{href:`/banebooking-voyager-fe/${r}/vilkaar`,className:"underline text-primary hover:text-primary/80",children:"Les vilkårene"})})]})]}),e.jsxs("div",{className:"pt-4 border-t mt-4 space-y-4",children:[e.jsx(T,{id:"slett-bruker",label:"Slett bruker",helpText:"Dette sletter brukeren din og all tilknyttet data permanent. Dette kan ikke angres.",children:e.jsx(Yt,{slettMeg:d})}),e.jsx("p",{className:"text-sm text-muted-foreground italic mt-2",children:"Mulighet for å laste ned dine data kommer senere."})]})]})})})}),e.jsx(I,{value:"bookinger",children:e.jsx($,{children:e.jsx(F,{className:"p-4 space-y-4",children:_e?e.jsx(P,{}):E.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Du har ingen kommende bookinger."}):e.jsx("div",{className:"overflow-auto max-h-[60vh] border-b border-x rounded-b-md",children:e.jsxs(q,{className:"text-sm",children:[e.jsx(U,{children:e.jsxs(w,{children:[e.jsx(j,{children:"Dato"}),e.jsx(j,{children:"Tid"}),e.jsx(j,{children:"Bane"})]})}),e.jsx(Y,{children:E.map((c,S)=>e.jsxs(w,{children:[e.jsx(b,{children:A(c.dato)}),e.jsxs(b,{children:[c.startTid,"–",c.sluttTid]}),e.jsx(b,{children:c.baneNavn})]},S))})]})})})})}),e.jsx(I,{value:"arrangementer",children:e.jsx($,{children:e.jsx(F,{className:"p-4 space-y-4",children:Re?e.jsx(P,{}):K.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ingen arrangementer registrert."}):e.jsx("div",{className:"overflow-auto max-h-[60vh] border-b border-x rounded-b-md",children:e.jsxs(q,{className:"text-sm",children:[e.jsx(U,{children:e.jsxs(w,{children:[e.jsx(j,{className:"w-1/3",children:"Hva"}),e.jsx(j,{className:"w-1/3",children:"Når"}),e.jsx(j,{className:"w-1/3",children:"Om"})]})}),e.jsx(Y,{children:K.map(c=>{const S=new Date(c.startDato),Oe=new Date,z=Math.max(0,Math.ceil((S.getTime()-Oe.getTime())/(1e3*60*60*24)));return e.jsxs(w,{children:[e.jsxs(b,{className:"whitespace-normal break-words",children:[e.jsx("div",{className:"font-medium",children:c.tittel}),c.beskrivelse&&e.jsx("div",{className:"text-muted-foreground text-xs whitespace-normal break-words",children:c.beskrivelse})]}),e.jsx(b,{className:"whitespace-normal break-words text-sm",children:c.startDato===c.sluttDato?A(c.startDato):`${A(c.startDato)} - ${A(c.sluttDato)}`}),e.jsxs(b,{className:"whitespace-nowrap",children:[z," ",z===1?"dag":"dager"]})]},c.id)})})]})})})})})]})})}export{ir as default};
