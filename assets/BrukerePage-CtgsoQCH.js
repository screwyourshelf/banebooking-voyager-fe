import{j as e,r as x}from"./shadcn-CGWS6Fka.js";import{P as E}from"./Page-DHRv0mUi.js";import{u as K,a as P,b as F,c as Q,t as C,B as v,i as R,I as B,f as V,v as q,L as I}from"./index-CCQsaDNR.js";import{P as U,a as S,b as L,R as k}from"./RowList-B2EtPD-K.js";import{S as $}from"./switch-BWBxAhKk.js";import{D as z,b as T,c as O,d as W,f as _}from"./dialog-FaEPS2ZE.js";import"./react-RGnvvjkK.js";import"./lucide-C5rSQBgG.js";import"./index-DnnwNeRP.js";import"./index-2r_zrsQA.js";function H(){const r=K(),m=P(),a=["admin-brukere",r],i=F(a,`/klubb/${r}/bruker/admin/bruker`,{requireAuth:!0,staleTime:3e4}),o=Q("put",({brukerId:s})=>`/klubb/${r}/bruker/admin/bruker/${s}`,{onSuccess:async()=>{C.success("Bruker oppdatert"),await m.invalidateQueries({queryKey:a})},onError:s=>C.error(s.message??"Kunne ikke oppdatere bruker"),retry:!1}),u=async(s,d)=>{await o.mutateAsync({brukerId:s,rolle:d.rolle,visningsnavn:d.visningsnavn})};return{brukere:i.data??[],laster:i.isLoading,oppdaterLaster:o.isPending,oppdater:u,hentBrukere:i.refetch,error:i.error?.message??null}}const G=["Medlem","Utvidet","KlubbAdmin"];function J(r){return r?r.toLowerCase().startsWith("slettet_"):!1}function X({query:r,onQueryChange:m,visSlettede:a,onVisSlettedeChange:i,rolleFilter:o,onToggleRolle:u,onNullstillRolleFilter:s,filtrerteBrukere:d,lasterListe:j,currentBrukerId:p,onRedigerBruker:f}){return e.jsx("div",{className:"space-y-4",children:e.jsxs(U,{title:"Brukere",description:"Søk etter brukere og endre rolle eller visningsnavn.",children:[e.jsx(S,{children:e.jsxs(L,{children:[e.jsxs(k,{title:"Filter på rolle",description:"",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:G.map(t=>{const g=o.includes(t);return e.jsx(v,{type:"button",size:"sm",variant:g?"default":"outline",onClick:()=>u(t),className:"h-8 px-3",children:t},t)})}),o.length>0?e.jsx("div",{className:"mt-2",children:e.jsx(v,{type:"button",size:"sm",variant:"ghost",onClick:s,className:"h-8 px-2 text-muted-foreground",children:"Nullstill filter"})}):null]}),e.jsx(k,{title:"Vis slettede brukere",description:"Inkluder brukere som er anonymisert eller slettet.",right:e.jsx($,{checked:a,onCheckedChange:i})}),e.jsx(k,{title:"Søk",description:"",children:e.jsx(R,{children:e.jsx(B,{id:"brukersok",value:r,onChange:t=>m(t.target.value),placeholder:"Søk på e-post eller visningsnavn…",inputMode:"search",className:"bg-background"})})})]})}),e.jsx("div",{className:"mt-4",children:j?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Laster brukere…"}):d.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ingen brukere funnet."}):e.jsx(S,{children:e.jsx(L,{children:d.map(t=>{const g=t.id===p,c=J(t.epost),h=t.roller?.[0]??"Medlem";return e.jsx(k,{title:t.epost??"Ukjent bruker",description:t.visningsnavn||(c?"Slettet/anonymisert":""),right:!g&&!c?e.jsx(v,{type:"button",size:"sm",variant:"outline",onClick:()=>f(t),children:"Rediger"}):null,className:V(c&&"opacity-70"),children:e.jsxs("div",{className:"text-sm text-foreground",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rolle: "}),h,c?e.jsx("span",{className:"text-muted-foreground",children:" (slettet)"}):null]})},t.id)})})})})]})})}function Y({aktivBruker:r,edit:m,onEditChange:a,onClose:i,onSave:o,isSaving:u}){return e.jsx(z,{open:!0,onOpenChange:s=>{s||i()},children:e.jsxs(T,{children:[e.jsx(O,{children:e.jsx(W,{children:"Rediger bruker"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Bruker"}),e.jsx("div",{className:"text-sm font-medium break-words",children:r.epost})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Visningsnavn"}),e.jsx(R,{children:e.jsx(B,{id:"visningsnavn",value:m.visningsnavn,onChange:s=>a({visningsnavn:s.target.value}),placeholder:"Valgfritt",className:"bg-background"})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Rolle"}),e.jsxs("select",{className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:m.rolle,onChange:s=>a({rolle:s.target.value}),children:[e.jsx("option",{value:"Medlem",children:"Medlem"}),e.jsx("option",{value:"Utvidet",children:"Utvidet"}),e.jsx("option",{value:"KlubbAdmin",children:"KlubbAdmin"})]})]})]}),e.jsxs(_,{children:[e.jsx(v,{variant:"ghost",onClick:i,disabled:u,children:"Avbryt"}),e.jsx(v,{onClick:o,disabled:u,children:u?"Lagrer...":"Lagre"})]})]})})}function Z(r){return r?r.toLowerCase().startsWith("slettet_"):!1}function ee(){const{bruker:r,laster:m}=q(),{brukere:a,laster:i,oppdater:o,oppdaterLaster:u}=H(),s=r?.roller.includes("KlubbAdmin"),[d,j]=x.useState(""),[p,f]=x.useState(!1),[t,g]=x.useState([]),[c,h]=x.useState(null),[b,N]=x.useState({rolle:"Medlem",visningsnavn:""}),w=x.useMemo(()=>{const n=d.toLowerCase().trim();return a.filter(l=>!(!p&&Z(l.epost))).filter(l=>{if(t.length===0)return!0;const y=l.roller?.[0]??"Medlem";return t.includes(y)}).filter(l=>n?l.epost?.toLowerCase().includes(n)||l.visningsnavn?.toLowerCase().includes(n):!0)},[a,d,p,t]),M=n=>{h(n),N({rolle:n.roller?.[0]??"Medlem"??"Medlem",visningsnavn:n.visningsnavn??""})},A=async()=>{c&&(await o(c.id,{rolle:b.rolle,visningsnavn:b.visningsnavn}),h(null))};function D(n){g(l=>l.includes(n)?l.filter(y=>y!==n):[...l,n])}return m?e.jsx(I,{}):s?e.jsxs(e.Fragment,{children:[e.jsx(X,{query:d,onQueryChange:j,visSlettede:p,onVisSlettedeChange:f,rolleFilter:t,onToggleRolle:D,onNullstillRolleFilter:()=>g([]),filtrerteBrukere:w,lasterListe:i,currentBrukerId:r?.id,onRedigerBruker:M}),c?e.jsx(Y,{aktivBruker:c,edit:b,onEditChange:n=>N(l=>({...l,...n})),onClose:()=>h(null),onSave:A,isSaving:u}):null]}):e.jsx("p",{className:"text-sm text-destructive px-2 py-2 text-center",children:"Du har ikke tilgang til denne siden."})}function ce(){return e.jsx(E,{children:e.jsx(ee,{})})}export{ce as default};
