import{r as a,j as e}from"./shadcn-BfUXmlP3.js";import{t as j,f as A,d as R,S as I,L as b,B as K}from"./index-CZ7yxNIj.js";import{b as O}from"./booking-BzyimBsT.js";import{u as P,f as p,T as V,a as L,b as f,c as h,d as M,e as x}from"./datoUtils-Cf88NydY.js";import{T as G,a as _,b as N,c as w}from"./useBaner-BRpSQ6Fy.js";import{C as y,a as T,F as D}from"./FieldWrapper--7bcjA_e.js";import{F as U}from"./FormField-BuG9kLHv.js";import"./react-D5d5vywP.js";import"./lucide-CZTSiasK.js";function W(r){const[t,i]=a.useState([]),[m,n]=a.useState(!0),[g,u]=a.useState(null),c=a.useCallback(async()=>{if(r)try{n(!0),u(null);const d=await O(r);i(d)}catch(d){const l=d instanceof Error?d.message:"Ukjent feil ved henting";u(l),j.error(l)}finally{n(!1)}},[r]);return a.useEffect(()=>{c()},[c]),{bookinger:t,laster:m,error:g,refetch:c}}async function X(r){const t=await A(`/api/klubb/${r}/bruker/meg`,{method:"GET"},!0);if(!t.ok){const i=await t.text();throw new Error(i||"Kunne ikke hente meg")}return await t.json()}async function z(r,t){const i=await A(`/api/klubb/${r}/bruker/meg`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)},!0);if(!i.ok){const m=await i.text();throw new Error(m||"Kunne ikke oppdatere visningsnavn")}}function J(r){const[t,i]=a.useState(null),[m,n]=a.useState(!0),[g,u]=a.useState(null),c=a.useCallback(async()=>{if(r){n(!0);try{const l=await X(r);i(l),u(null)}catch(l){const o=l instanceof Error?l.message:"Ukjent feil ved henting";u(o),j.error(o),i(null)}finally{n(!1)}}},[r]),d=a.useCallback(async l=>{if(!(!t||!r))try{await z(r,{visningsnavn:l}),i({...t,visningsnavn:l}),j.success("Visningsnavn lagret")}catch(o){const k=o instanceof Error?o.message:"Kunne ikke lagre visningsnavn";j.error(k)}},[r,t]);return a.useEffect(()=>{c()},[c]),{bruker:t,laster:m,feil:g,oppdaterVisningsnavn:d,refetch:c}}const C=50,q=/^[\p{L}\d\s.@'_%+-]{2,}$/u;function ie(){const{slug:r}=R(),t=a.useContext(I)??r,[i,m]=a.useState("profil"),{bruker:n,laster:g,oppdaterVisningsnavn:u}=J(t),[c,d]=a.useState(""),[l,o]=a.useState(null),{bookinger:k,laster:B}=W(t),{arrangementer:E,isLoading:F}=P(t);a.useEffect(()=>{var s;n&&d(((s=n.visningsnavn)==null?void 0:s.trim())||n.epost)},[n]);const $=()=>{const s=c.trim();if(s.length===0){o("Visningsnavn kan ikke være tomt.");return}if(s.length<3){o("Visningsnavn må være minst 3 tegn.");return}if(!q.test(s)){o("Visningsnavn inneholder ugyldige tegn.");return}if(s.length>C){o(`Visningsnavn kan ikke være lengre enn ${C} tegn.`);return}o(null),u(s)};return e.jsx("div",{className:"max-w-screen-md mx-auto px-2 py-4",children:e.jsxs(G,{value:i,onValueChange:m,children:[e.jsxs(_,{className:"mb-4",children:[e.jsx(N,{value:"profil",children:"Min profil"}),e.jsx(N,{value:"bookinger",children:"Mine bookinger"}),e.jsx(N,{value:"arrangementer",children:"Arrangementer"})]}),e.jsx(w,{value:"profil",children:e.jsx(y,{children:e.jsx(T,{className:"p-4 space-y-6",children:g||!n?e.jsx(b,{}):e.jsxs(e.Fragment,{children:[e.jsxs("form",{className:"space-y-4",onSubmit:s=>{s.preventDefault(),$()},children:[e.jsx(U,{id:"visningsnavn",label:"Visningsnavn",value:c,maxLength:C,placeholder:"f.eks. Ola Nordmann",onChange:s=>d(s.target.value),error:l,helpText:"Navnet vises i grensesnittet, og settes automatisk til e-post ved første innlogging. Du kan endre det her. Navnet må være saklig og respektfullt – støtende navn kan føre til at profilen blir sperret."}),e.jsx(K,{type:"submit",size:"sm",children:"Lagre"})]}),e.jsxs("div",{className:"pt-4 border-t mt-4 space-y-4",children:[e.jsx(D,{id:"epost",label:"Brukernavn / ID",children:e.jsx("p",{className:"text-sm text-foreground",children:n.epost})}),e.jsx(D,{id:"rolle",label:"Rolle (i klubben)",helpText:"Roller tildeles av klubbens administrator og kan ikke endres manuelt.",children:e.jsx("p",{className:"text-sm text-foreground",children:n.roller.join(", ")})})]}),e.jsx("div",{className:"pt-4 border-t mt-4 space-y-4",children:e.jsxs(D,{id:"vilkaar",label:"Vilkår for bruk",helpText:"Du aksepterer vilkårene automatisk ved første innlogging.",children:[n.vilkaarAkseptertDato?e.jsxs("p",{className:"text-sm text-foreground",children:["Akseptert ",p(n.vilkaarAkseptertDato)," ",n.vilkaarVersjon&&`(versjon ${n.vilkaarVersjon})`]}):e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ikke registrert"}),e.jsx("p",{className:"text-sm mt-1",children:e.jsx("a",{href:`/banebooking-voyager-fe/${t}/vilkaar`,className:"underline text-primary hover:text-primary/80",children:"Les vilkårene"})})]})})]})})})}),e.jsx(w,{value:"bookinger",children:e.jsx(y,{children:e.jsx(T,{className:"p-4 space-y-4",children:B?e.jsx(b,{}):k.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Du har ingen kommende bookinger."}):e.jsx("div",{className:"overflow-auto max-h-[60vh] border-b border-x rounded-b-md",children:e.jsxs(V,{className:"text-sm",children:[e.jsx(L,{children:e.jsxs(f,{children:[e.jsx(h,{children:"Dato"}),e.jsx(h,{children:"Tid"}),e.jsx(h,{children:"Bane"})]})}),e.jsx(M,{children:k.map((s,v)=>e.jsxs(f,{children:[e.jsx(x,{children:p(s.dato)}),e.jsxs(x,{children:[s.startTid,"–",s.sluttTid]}),e.jsx(x,{children:s.baneNavn})]},v))})]})})})})}),e.jsx(w,{value:"arrangementer",children:e.jsx(y,{children:e.jsx(T,{className:"p-4 space-y-4",children:F?e.jsx(b,{}):E.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ingen arrangementer registrert."}):e.jsx("div",{className:"overflow-auto max-h-[60vh] border-b border-x rounded-b-md",children:e.jsxs(V,{className:"text-sm",children:[e.jsx(L,{children:e.jsxs(f,{children:[e.jsx(h,{className:"w-1/3",children:"Hva"}),e.jsx(h,{className:"w-1/3",children:"Når"}),e.jsx(h,{className:"w-1/3",children:"Om"})]})}),e.jsx(M,{children:E.map(s=>{const v=new Date(s.startDato),H=new Date,S=Math.max(0,Math.ceil((v.getTime()-H.getTime())/(1e3*60*60*24)));return e.jsxs(f,{children:[e.jsxs(x,{className:"whitespace-normal break-words",children:[e.jsx("div",{className:"font-medium",children:s.tittel}),s.beskrivelse&&e.jsx("div",{className:"text-muted-foreground text-xs whitespace-normal break-words",children:s.beskrivelse})]}),e.jsx(x,{className:"whitespace-normal break-words text-sm",children:s.startDato===s.sluttDato?p(s.startDato):`${p(s.startDato)} - ${p(s.sluttDato)}`}),e.jsxs(x,{className:"whitespace-nowrap",children:[S," ",S===1?"dag":"dager"]})]},s.id)})})]})})})})})]})})}export{ie as default};
