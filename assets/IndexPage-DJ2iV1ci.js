import{j as t,r as x}from"./shadcn-V64FgQuT.js";import{T as B,a as w,b as N}from"./tabs-DT31W5DZ.js";import{C as S,f as T,D as C}from"./checkbox-BeqC9_1J.js";import{F as E,B as p,a as $,b as L,c as D,L as y,t as b,u as A,S as I}from"./index-BpRXuvrW.js";import{u as F}from"./useBaner-DTdEVHmg.js";import{h as P,s as z,a as K,o as _}from"./booking-BbJTKGHV.js";import"./react-D5d5vywP.js";import"./lucide-VYBZz5NY.js";import"./index-uoXEFuNP.js";function M({baner:e,valgtBaneId:n,onVelgBane:s}){return t.jsx(B,{value:n,onValueChange:s,children:t.jsx(w,{className:"flex flex-wrap gap-2 mb-2",children:e.map(o=>t.jsx(N,{value:o.id,children:o.navn},o.id))})})}function V(){const[e,n]=x.useState(!1);return{erBekreftet:e,setErBekreftet:n,reset:()=>n(!1)}}function H({slot:e,isOpen:n,erInteraktiv:s,currentUser:o}){const r=`${e.startTid.slice(0,2)}-${e.sluttTid.slice(0,2)}`,d=!!e.arrangementTittel,[i,u]=x.useState(!1);x.useEffect(()=>{const f=()=>u(window.innerWidth<640);return f(),window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)},[]);const l=40,c=e.arrangementBeskrivelse&&i&&e.arrangementBeskrivelse.length>l?e.arrangementBeskrivelse.slice(0,l)+"...":e.arrangementBeskrivelse;return t.jsx("div",{className:"flex items-center",children:t.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[t.jsx("div",{className:"whitespace-nowrap font-semibold text-sm text-right pr-1",children:r}),t.jsx("div",{className:"w-[18px] h-[18px] flex items-center justify-center",children:e.værSymbol?t.jsx("img",{src:`/banebooking-voyager-fe/weather-symbols/svg/${e.værSymbol}.svg`,alt:e.værSymbol,width:18,height:18,className:"select-none",draggable:!1}):t.jsx("span",{className:"invisible"})}),t.jsx("div",{className:"flex-grow text-sm p-1",children:d?t.jsxs("div",{children:[t.jsx("div",{className:"font-medium",children:e.arrangementTittel}),c&&t.jsx("div",{className:"text-xs text-gray-600",children:c})]}):t.jsx("div",{children:e.booketAv?o?e.booketAv:J(e.booketAv):"Ledig"})}),s&&t.jsx("div",{className:"p-1",children:t.jsx(E,{size:12,style:{transform:n?"rotate(180deg)":"rotate(0deg)",transition:"transform 0.2s"},"aria-hidden":"true"})})]})})}function J(e){const[n,s]=e.split("@");return!n||!s?e:`${n[0]}***@${s}`}function O({slot:e,onBook:n=()=>{},onCancel:s=()=>{},onDelete:o=()=>{},time:r,erBekreftet:d,setErBekreftet:i,reset:u=()=>{}}){return t.jsxs("div",{className:"flex flex-col items-end w-full",children:[e.kanBookes&&d!==void 0&&i&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center space-x-1 mb-2 text-sm",children:[t.jsx(S,{id:`book-${r}`,checked:d,onCheckedChange:l=>i(!!l)}),t.jsxs("label",{htmlFor:`book-${r}`,className:"cursor-pointer select-none",children:["Jeg (og de jeg spiller sammen med) har betalt medlemskap for ",new Date().getFullYear()]})]}),t.jsxs(p,{variant:"outline",size:"sm",disabled:!d,onClick:()=>{n(e),u()},className:"flex items-center gap-2 text-sm",children:[t.jsx($,{}),"Book"]})]}),e.kanAvbestille&&t.jsxs(p,{variant:"outline",size:"sm",onClick:()=>{s(e),u()},className:"flex items-center gap-2 text-sm",children:[t.jsx(L,{}),"Avbestill"]}),e.kanSlette&&t.jsxs(p,{variant:"destructive",size:"sm",onClick:()=>{o(e),u()},className:"flex items-center gap-2 text-sm",children:[t.jsx(D,{}),"Slett"]})]})}function W({slot:e,time:n,erBekreftet:s,setErBekreftet:o,onBook:r,onCancel:d,onDelete:i,reset:u}){return t.jsx("div",{className:"mt-1",children:t.jsx("div",{className:"bg-inherit",children:t.jsx(O,{slot:e,time:n,erBekreftet:s,setErBekreftet:o,onBook:r,onCancel:d,onDelete:i,reset:u})})})}function Y({slot:e,currentUser:n,isOpen:s=!1,onToggle:o,onBook:r=()=>{},onCancel:d=()=>{},onDelete:i=()=>{}}){const{erBekreftet:u,setErBekreftet:l,reset:c}=V(),f=`${e.startTid.slice(0,2)}-${e.sluttTid.slice(0,2)}`,k=e.kanBookes||e.kanAvbestille||e.kanSlette,h=!!n&&k&&!e.erPassert,v=!!e.arrangementTittel,a=e.erEier===!0,m=["border rounded shadow-sm p-2 mb-2","transition-colors duration-300 ease-in-out",e.erPassert?"bg-gray-100 text-gray-400":"",!e.erPassert&&v?"bg-gradient-to-r from-blue-0 via-blue-50 to-blue-200 border-blue-200":"",!e.erPassert&&!v?"bg-white text-gray-900":"",n&&a&&!v?"animate__animated animate__headShake animate__slow":""].join(" "),g=()=>{h&&o&&(o(),l(!1))};return t.jsxs("div",{className:m,style:{cursor:h?"pointer":"default",opacity:e.erPassert?.5:1},onClick:j=>{j.target.closest("button, input, label")||g()},role:h?"button":void 0,tabIndex:h?0:void 0,onKeyDown:j=>{(j.key==="Enter"||j.key===" ")&&(j.preventDefault(),g())},children:[t.jsx(H,{slot:e,isOpen:s,erInteraktiv:h,currentUser:n}),s&&!e.erPassert&&t.jsx(W,{slot:e,time:f,erBekreftet:u,setErBekreftet:l,onBook:r,onCancel:d,onDelete:i,reset:c})]})}function q({slots:e,currentUser:n,onBook:s,onCancel:o,onDelete:r,apenSlotTid:d,setApenSlotTid:i,isLoading:u=!1}){return u?t.jsx(y,{}):e.length===0?t.jsx("div",{className:"text-muted text-sm italic py-4 text-center",children:"Ingen bookinger eller slots � vise."}):t.jsx("div",{className:"space-y-2",children:e.map(l=>{const c=`${l.dato}-${l.startTid}-${l.baneId}`;return t.jsx(Y,{slot:l,currentUser:n,onBook:s,onCancel:o,onDelete:r,isOpen:d===c,onToggle:()=>i==null?void 0:i(d===c?null:c)},c)})})}function G(e,n,s){const[o,r]=x.useState([]),[d,i]=x.useState(null),[u,l]=x.useState(!0),c=x.useCallback(async()=>{if(!(!e||!s)){l(!0);try{const a=await P(e,s,n);r(a)}catch{r([]),b.error("Kunne ikke hente bookinger.")}finally{l(!1)}}},[e,n,s]);x.useEffect(()=>{c()},[c]);const f=a=>{r(m=>m.filter(g=>!(g.baneId===a.baneId&&g.dato===a.dato&&g.startTid===a.startTid&&g.sluttTid===a.sluttTid)))};return{slots:o,apenSlotTid:d,setApenSlotTid:i,onBook:async a=>{if(!(!e||!s))try{await _(e,s,n,a.startTid,a.sluttTid);const m=`${a.startTid.slice(0,2)}-${a.sluttTid.slice(0,2)}`;b.success(`Booket ${m}`),await c()}catch(m){b.error(m instanceof Error?m.message:"Kunne ikke booke.")}},onCancel:async a=>{if(!(!e||!s))try{await K(e,s,n,a.startTid,a.sluttTid),f(a),b.info("Bookingen er avbestilt."),await c()}catch(m){b.error(m instanceof Error?m.message:"Kunne ikke avbestille.")}},onDelete:async a=>{if(e)try{await z(e,a.baneId,a.dato,a.startTid,a.sluttTid),f(a),b.success("Booking slettet"),i(null),await c()}catch(m){b.error(m instanceof Error?m.message:"Kunne ikke slette booking.")}},hentBookinger:c,isLoading:u}}function re(){const{baner:e,isLoading:n}=F(),[s,o]=x.useState(""),[r,d]=x.useState(new Date),{currentUser:i}=A(),u=x.useContext(I),l=r?T(r,"yyyy-MM-dd"):"",{slots:c,apenSlotTid:f,setApenSlotTid:k,onBook:h,onCancel:v,onDelete:a,isLoading:m}=G(u,l,s);return x.useEffect(()=>{!s&&e.length>0&&o(e[0].id)},[e,s]),x.useEffect(()=>{k(null)},[r,s,k]),x.useEffect(()=>{i||k(null)},[i,k]),x.useEffect(()=>{r&&localStorage.setItem("valgtDato",r.toISOString())},[r]),n||!s?t.jsx(y,{}):t.jsxs("div",{className:"max-w-screen-sm mx-auto px-1 py-1",children:[t.jsx("div",{className:"mb-2",children:t.jsx(C,{value:r,onChange:g=>d(g??null),visNavigering:!0})}),t.jsx("div",{className:"mb-0",children:t.jsx(M,{baner:e,valgtBaneId:s,onVelgBane:o})}),t.jsx(q,{slots:c,currentUser:i?{epost:i.email??""}:null,apenSlotTid:f,setApenSlotTid:k,onBook:h,onCancel:v,onDelete:a,isLoading:m})]})}export{re as default};
