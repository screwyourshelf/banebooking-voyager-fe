import{r as o,j as e}from"./shadcn-mOdBhBu9.js";import{L as D}from"./LoaderSkeleton-C1mMO82w.js";import{S as E}from"./SettingsSection-B8R6RJjb.js";import{a as N,S as v}from"./SettingsRow-SsVQpD69.js";import{S}from"./SettingsInput-0PdANPZe.js";import{u as q,a as Q,b as F,c as U,t as C,o as V,B as m,k as z}from"./index-D3zhjIn3.js";import{S as I}from"./switch-QTThKCD1.js";import{D as $,b as O,c as P,d as T,f as H}from"./dialog-DOfRA9v0.js";import"./react-RGnvvjkK.js";import"./lucide-ByENZzyU.js";import"./index-Bb2dXpgu.js";import"./index-BRMy6Ggk.js";function W(){const r=q(),k=Q(),u=["admin-brukere",r],i=F(u,`/klubb/${r}/bruker/admin/bruker`,{requireAuth:!0,staleTime:3e4}),p=U("put",({brukerId:l})=>`/klubb/${r}/bruker/admin/bruker/${l}`,{onSuccess:async()=>{C.success("Bruker oppdatert"),await k.invalidateQueries({queryKey:u})},onError:l=>C.error(l.message??"Kunne ikke oppdatere bruker"),retry:!1}),d=async(l,a)=>{await p.mutateAsync({brukerId:l,rolle:a.rolle,visningsnavn:a.visningsnavn})};return{brukere:i.data??[],laster:i.isLoading,oppdaterLaster:p.isPending,oppdater:d,hentBrukere:i.refetch,error:i.error?.message??null}}const _=["Medlem","Utvidet","KlubbAdmin"];function L(r){return r?r.toLowerCase().startsWith("slettet_"):!1}function ae(){const{bruker:r,laster:k}=V(),{brukere:u,laster:i,oppdater:p,oppdaterLaster:d}=W(),l=r?.roller.includes("KlubbAdmin"),[a,B]=o.useState(""),[f,M]=o.useState(!1),[c,b]=o.useState([]),[x,g]=o.useState(null),[h,j]=o.useState({rolle:"Medlem",visningsnavn:""}),y=o.useMemo(()=>{const t=a.toLowerCase().trim();return u.filter(s=>!(!f&&L(s.epost))).filter(s=>{if(c.length===0)return!0;const n=s.roller?.[0]??"Medlem";return c.includes(n)}).filter(s=>t?s.epost?.toLowerCase().includes(t)||s.visningsnavn?.toLowerCase().includes(t):!0)},[u,a,f,c]),w=t=>{g(t),j({rolle:t.roller?.[0]??"Medlem"??"Medlem",visningsnavn:t.visningsnavn??""})},A=async()=>{x&&(await p(x.id,{rolle:h.rolle,visningsnavn:h.visningsnavn}),g(null))};function R(t){b(s=>s.includes(t)?s.filter(n=>n!==t):[...s,t])}return k?e.jsx(D,{}):l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs(E,{title:"Brukere",description:"Søk etter brukere og endre rolle eller visningsnavn.",children:[e.jsxs(N,{children:[e.jsxs(v,{title:"Filter på rolle",description:"",children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:_.map(t=>{const s=c.includes(t);return e.jsx(m,{type:"button",size:"sm",variant:s?"default":"outline",onClick:()=>R(t),className:"h-8 px-3",children:t},t)})}),c.length>0?e.jsx("div",{className:"mt-2",children:e.jsx(m,{type:"button",size:"sm",variant:"ghost",onClick:()=>b([]),className:"h-8 px-2 text-muted-foreground",children:"Nullstill filter"})}):null]}),e.jsx(v,{title:"Vis slettede brukere",description:"Inkluder brukere som er anonymisert eller slettet.",right:e.jsx("div",{className:"pt-0.5",children:e.jsx(I,{checked:f,onCheckedChange:M})})}),e.jsx(v,{title:"Søk",description:"",children:e.jsx(S,{value:a,onChange:B,placeholder:"Søk på e-post eller visningsnavn…",inputMode:"search",className:"bg-background"})})]}),e.jsx("div",{className:"mt-4",children:i?e.jsx("p",{className:"text-sm text-muted-foreground",children:"Laster brukere…"}):y.length===0?e.jsx("p",{className:"text-sm text-muted-foreground italic",children:"Ingen brukere funnet."}):e.jsx(N,{children:y.map(t=>{const s=t.id===r?.id,n=L(t.epost),K=t.roller?.[0]??"Medlem";return e.jsx(v,{title:t.epost??"Ukjent bruker",description:t.visningsnavn||(n?"Slettet/anonymisert":""),right:!s&&!n?e.jsx(m,{type:"button",size:"sm",variant:"outline",onClick:()=>w(t),children:"Rediger"}):null,className:z(n&&"opacity-70"),children:e.jsxs("div",{className:"text-sm text-foreground",children:[e.jsx("span",{className:"text-muted-foreground",children:"Rolle: "}),K,n?e.jsx("span",{className:"text-muted-foreground",children:" (slettet)"}):null]})},t.id)})})})]}),x?e.jsx($,{open:!0,onOpenChange:t=>{t||g(null)},children:e.jsxs(O,{children:[e.jsx(P,{children:e.jsx(T,{children:"Rediger bruker"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Bruker"}),e.jsx("div",{className:"text-sm font-medium break-words",children:x.epost})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Visningsnavn"}),e.jsx(S,{value:h.visningsnavn,onChange:t=>j(s=>({...s,visningsnavn:t})),placeholder:"Valgfritt",className:"bg-background"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"text-sm font-medium",children:"Rolle"}),e.jsxs("select",{className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:h.rolle,onChange:t=>j(s=>({...s,rolle:t.target.value})),children:[e.jsx("option",{value:"Medlem",children:"Medlem"}),e.jsx("option",{value:"Utvidet",children:"Utvidet"}),e.jsx("option",{value:"KlubbAdmin",children:"KlubbAdmin"})]})]})]}),e.jsxs(H,{children:[e.jsx(m,{variant:"ghost",onClick:()=>g(null),disabled:d,children:"Avbryt"}),e.jsx(m,{onClick:A,disabled:d,children:d?"Lagrer...":"Lagre"})]})]})}):null]}):e.jsx("p",{className:"text-sm text-destructive px-2 py-2 text-center",children:"Du har ikke tilgang til denne siden."})}export{ae as default};
