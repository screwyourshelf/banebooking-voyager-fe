import{r as l,j as a}from"./shadcn-DPSgmxN6.js";import{u as L}from"./useBaner-eSVDoHg_.js";import{B as v,t as r}from"./index-BYC8jElZ.js";import{C as b,a as h}from"./card-Bt8C29rJ.js";import{T as z,a as R,b as j,c as y}from"./tabs-BeMiRqZx.js";import{F as u}from"./FormField-rCnNSN9O.js";import{S as V}from"./SelectField-BxiLzjVq.js";import"./react-RGnvvjkK.js";import"./lucide-Uxrg_z7G.js";import"./FieldWrapper-DqorA9eC.js";import"./index-DUAXFcx0.js";const B="rediger.valgtBaneId";function Q(){const{baner:t,isLoading:C,oppdaterBane:N,opprettBane:E,deaktiverBane:S,aktiverBane:T}=L(!0),[f,p]=l.useState({}),[d,g]=l.useState({navn:"",beskrivelse:""}),[s,m]=l.useState(()=>{const e=sessionStorage.getItem(B);return e&&e!=="null"?e:null}),n=t.find(e=>e.id===s)??null,c=s?f[s]??null:null;l.useEffect(()=>{sessionStorage.setItem(B,s??"null")},[s]),l.useEffect(()=>{s&&!t.some(e=>e.id===s)&&m(null)},[t,s]),l.useEffect(()=>{!s&&t.length>0&&m(t[0].id)},[t,s]);function x(e,i,k){p(o=>({...o,[e]:{...o[e]??t.find(K=>K.id===e),[i]:k}}))}async function w(e){const i=f[e];if(i)try{await N(e,i),r.success("Endringer lagret"),p(k=>{const o={...k};return delete o[e],o})}catch{r.error("Kunne ikke lagre bane")}}async function F(){if(!d.navn.trim()){r.error("Navn er pÃ¥krevd");return}try{await E(d),r.success("Bane lagt til"),g({navn:"",beskrivelse:""})}catch{r.error("Kunne ikke legge til bane")}}async function D(e){try{await S(e),r.success("Bane deaktivert")}catch{r.error("Kunne ikke deaktivere bane")}}async function I(e){try{await T(e),r.success("Bane aktivert")}catch{r.error("Kunne ikke aktivere bane")}}return a.jsx("div",{className:"max-w-screen-sm mx-auto px-2 py-2",children:a.jsxs(z,{defaultValue:"rediger",className:"space-y-4",children:[a.jsxs(R,{className:"mb-2",children:[a.jsx(j,{value:"rediger",children:"Rediger bane"}),a.jsx(j,{value:"ny",children:"Ny bane"})]}),a.jsx(y,{value:"rediger",children:C?a.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Laster..."}):a.jsx(b,{children:a.jsxs(h,{className:"p-4 space-y-4",children:[a.jsx(V,{id:"velg-bane",label:"Velg bane",value:s??"",onChange:e=>m(e||null),options:t.map(e=>({label:`${e.navn} ${e.aktiv?"":"(inaktiv)"}`,value:e.id}))}),n&&a.jsxs(a.Fragment,{children:[a.jsx(u,{id:"navn",label:"Navn",value:c?.navn??n.navn,onChange:e=>x(n.id,"navn",e.target.value),readOnly:!n.aktiv}),a.jsx(u,{id:"beskrivelse",label:"Beskrivelse",value:c?.beskrivelse??n.beskrivelse,onChange:e=>x(n.id,"beskrivelse",e.target.value),readOnly:!n.aktiv}),a.jsx("div",{className:"flex justify-between",children:n.aktiv?a.jsxs(a.Fragment,{children:[a.jsx(v,{size:"sm",onClick:e=>{e.preventDefault(),w(n.id)},disabled:!c||c.navn===n.navn&&c.beskrivelse===n.beskrivelse,children:"Lagre"}),a.jsx(v,{variant:"destructive",size:"sm",onClick:e=>{e.preventDefault(),D(n.id)},children:"Deaktiver"})]}):a.jsx(v,{variant:"outline",size:"sm",onClick:e=>{e.preventDefault(),I(n.id)},children:"Aktiver"})})]})]})})}),a.jsx(y,{value:"ny",children:a.jsx(b,{children:a.jsxs(h,{className:"p-4 space-y-3",children:[a.jsx(u,{id:"ny-navn",label:"Navn",value:d.navn,onChange:e=>g(i=>({...i,navn:e.target.value}))}),a.jsx(u,{id:"ny-beskrivelse",label:"Beskrivelse",value:d.beskrivelse,onChange:e=>g(i=>({...i,beskrivelse:e.target.value}))}),a.jsx(v,{size:"sm",onClick:e=>{e.preventDefault(),F()},children:"Legg til"})]})})})]})})}export{Q as default};
